[
    {
        "id": "0c8e0c86799d088c",
        "type": "tab",
        "label": "openAPI red",
        "disabled": false,
        "info": ""
    },
    {
        "id": "a527806fb52a0bc0",
        "type": "tab",
        "label": "Thermostat Dashboard",
        "disabled": false,
        "info": ""
    },
    {
        "id": "d68460b3bb47684e",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a7f4785e36cba6a2",
        "type": "tab",
        "label": "Thermostats Demo",
        "disabled": false,
        "info": ""
    },
    {
        "id": "b0c6f1e3d4fc18a3",
        "type": "tab",
        "label": "Flow 3",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "smarthome_flow",
        "type": "tab",
        "label": "SmartHome+",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9d0b8d8486bf692d",
        "type": "tab",
        "label": "SmartHome+",
        "disabled": false,
        "info": ""
    },
    {
        "id": "db6486d1d2cd59d6",
        "type": "tab",
        "label": "SmartHome+",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4f4855f52107b72b",
        "type": "tab",
        "label": "SmartHome+",
        "disabled": false,
        "info": ""
    },
    {
        "id": "878f967ba70ceb42",
        "type": "tab",
        "label": "Flow 2",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "tab_neighborhood",
        "type": "tab",
        "label": "Neighborhood",
        "disabled": false,
        "info": ""
    },
    {
        "id": "240e9c78e5c49674",
        "type": "tab",
        "label": "ALL IN",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5c2420afdd74920f",
        "type": "tab",
        "label": "Flow 5",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2a4e2856b37c3f19",
        "type": "tab",
        "label": "SMARTHOOD",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "438d596005491859",
        "type": "tab",
        "label": "smart plug test",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a1c0e100f11a4f9b",
        "type": "tab",
        "label": "Smart Plug Webhook",
        "disabled": false,
        "info": ""
    },
    {
        "id": "eeca424b18026ca1",
        "type": "subflow",
        "name": "Subflow 1",
        "info": "",
        "in": [],
        "out": []
    },
    {
        "id": "043c9b21da5cbba8",
        "type": "subflow",
        "name": "Subflow 2",
        "info": "",
        "in": [],
        "out": []
    },
    {
        "id": "subflow-thermostat-logic",
        "type": "subflow",
        "name": "Thermostat Logic",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "f1b4a93aa4e5e122"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 440,
                "y": 80,
                "wires": [
                    {
                        "id": "f1b4a93aa4e5e122",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "subflow_smarthome",
        "type": "subflow",
        "name": "SmartHome",
        "info": "Simulates one smart home with environment, devices and total energy.",
        "category": "smarthome",
        "in": [],
        "out": [],
        "env": [
            {
                "name": "homeId",
                "type": "num",
                "value": 1
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7ecc82fdd5fcacdb",
        "type": "subflow",
        "name": "Smarthome subflow",
        "info": "",
        "category": "",
        "in": [],
        "out": [
            {
                "x": 2500,
                "y": 1040,
                "wires": [
                    {
                        "id": "c73637d98e05e80e",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "2785aa7402e0c422",
        "type": "group",
        "z": "0c8e0c86799d088c",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "bfb6d9bfe0c540fc",
            "743761d0ea53bc31",
            "7292a72a4b6230c9",
            "d7f5f6ed015725be",
            "8708fbbaf99494f4",
            "eb7c8264bfd927b1",
            "fb837ec50d0e5ff5",
            "e590371eec36462b",
            "b6a518cae0ed236e",
            "d148bc258eb112ca",
            "a8b3b1803a943f5d",
            "2e21f69b42218552",
            "714e3635c401250f",
            "f86103930fc1fd85",
            "3323c6018c67090b",
            "7cdf47e943d3721a",
            "67e82cdae3014568",
            "60072a460f71141f"
        ],
        "x": 1094,
        "y": 579,
        "w": 832,
        "h": 442
    },
    {
        "id": "01c6034556accf3a",
        "type": "group",
        "z": "0c8e0c86799d088c",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "fb0068a4371ff253",
            "2810755f89def0ab",
            "9d2350b1eee037db",
            "75126d56d71e3c3c",
            "facfb133068f19c4",
            "cfb1e29cc9832121",
            "12d7924ce265af7b",
            "8c42edd3ad8f483f",
            "11c835bfe0e324a3",
            "84f43a190c420cc0",
            "9f53aae319aea21a",
            "e70c041c9abdaf24",
            "032cdf22b09cbf50",
            "fae3ae2c4e4f2543",
            "12e3afafe385aec5",
            "14862242a91c03b1",
            "18797dbc244535cc",
            "9810d92794505360",
            "7f3d299d1ec31a66"
        ],
        "x": 1094,
        "y": 59,
        "w": 772,
        "h": 482
    },
    {
        "id": "efb7a27e4dfae1f6",
        "type": "group",
        "z": "0c8e0c86799d088c",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a683470f9f9d2be2",
            "fd241870fe8e402a",
            "a88e075f0ee05109",
            "f13e6ce1a71fb95e",
            "e5fe633619ed6e0a",
            "d2c25c70ca021b0e",
            "d9b0d7fcf676d77f",
            "ea87fde3734d5f09",
            "4a34670d715fd56d",
            "21f13b66e154f470",
            "852ef3b902872cf8",
            "6d87958f749b4d65",
            "c8b83ed3e66303c2",
            "1b52e6c758aacb10",
            "54ce4caefeb8ba12",
            "c6e69660fab90ac4",
            "17b0e03a9286c258",
            "deee4299c301b4a8",
            "5e6a3d87843af348",
            "9571f83d9ff1cfb7",
            "a7a87e65a43ce895",
            "4a87ce22e00f3efa",
            "16ff18397b551163",
            "c2a567a74171bc92",
            "a2798a84ebf29821",
            "8045a1d812f80bfb",
            "3a9e9aaa25a5c025",
            "2acfae3a3b04e41f",
            "6d04430b35be0819",
            "fe01a9e33899abda",
            "5be937fe9b529fc1",
            "1d6d17c456d6e266",
            "1d205353151b266e",
            "8d63e9e4de8cbe37",
            "f7e22af6d625591e",
            "c897adafa788de00",
            "65110c919e408b85",
            "8a432c1017ac312e",
            "d81d9db98b14b421",
            "ad8ebbbf4fad2678",
            "751bd26d424cc321"
        ],
        "x": 54,
        "y": 59,
        "w": 872,
        "h": 1024.5
    },
    {
        "id": "50a045551ea38743",
        "type": "group",
        "z": "a527806fb52a0bc0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d4f8c637ba287db1",
            "69ded1d17cbec561",
            "9a05b0be9bfe3225",
            "1d06a67200a8e66e",
            "d9d04269593328c3",
            "1eb2f1ad87e9df5c",
            "09f2f1cdc17cf192",
            "5fd815fb2caf5aba",
            "ba5dc6718d645637",
            "27b270e5d78bc103",
            "8081e1c458fe1e4b"
        ],
        "x": 94,
        "y": 79,
        "w": 1362,
        "h": 242
    },
    {
        "id": "a0bc03072058d078",
        "type": "group",
        "z": "a527806fb52a0bc0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4c2bce897c0d2007",
            "652fef5d99c41776",
            "98def4b9de0bd9e0",
            "977bf35655af95ea",
            "325004b4427897ea",
            "4ffc7d206027f2ef",
            "180cc2c38f2b7ec2",
            "6f5c1f35a0395420",
            "c90d975ea0894abd",
            "e5f04a5e61c95926",
            "87c71e9f1e18a5cb",
            "a11a61d05abb0fd9",
            "97a42e312b36f637",
            "96ab1cc712be6574",
            "3cdc3eae3c728601"
        ],
        "x": 94,
        "y": 359,
        "w": 1412,
        "h": 282
    },
    {
        "id": "6996a7f421765b1a",
        "type": "group",
        "z": "a527806fb52a0bc0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1616e8d0253bffbf",
            "29a719f9730293ac",
            "b58e5041e4c9741b",
            "d83a4d77d7f049bf",
            "84eae99cd8fb8148",
            "9b07cf1424fb44b6",
            "499267adb5adb442",
            "02494731b443fa30",
            "4229373250208f05",
            "dba1b26fa3a4b0a8",
            "c0f6b3899961c14c",
            "ae9ed5515183f125",
            "bdacb97c9c98471c",
            "f42d0e7a987f22d0"
        ],
        "x": 94,
        "y": 679,
        "w": 1742,
        "h": 382
    },
    {
        "id": "38af56c2be0e770c",
        "type": "group",
        "z": "a527806fb52a0bc0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "2f8c3fe9e3a364d1",
            "aec069bf440e39e4",
            "601a43db7ca6fa0a",
            "47886e634365fb88",
            "f324d4a123376c63",
            "f6b18e5f375f811d",
            "6aa34857a3f76ef9"
        ],
        "x": 94,
        "y": 1099,
        "w": 1332,
        "h": 162
    },
    {
        "id": "d6d6813509f8a19b",
        "type": "group",
        "z": "a527806fb52a0bc0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d4868acaa6b1056b",
            "format_coffee",
            "join_coffee",
            "debug_coffee",
            "b972287969dd1e02",
            "ui_size",
            "ui_strength",
            "ui_coffee_status"
        ],
        "x": 94,
        "y": 1319,
        "w": 1272,
        "h": 222
    },
    {
        "id": "9d8fc96b503dd8a9",
        "type": "group",
        "z": "043c9b21da5cbba8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "2c2826fa3fc78558",
            "f034a42a7690f2b6",
            "5d88956b6c0935c0",
            "386c2541306d379c",
            "c9dd5b14b31c8ac4",
            "80a07121563fc510",
            "5838340eeabc7fc3",
            "a9a704cd8fe91875",
            "f5b57f8f9931df1d",
            "da3a80e17247daa5"
        ],
        "x": 134,
        "y": 19,
        "w": 1362,
        "h": 282
    },
    {
        "id": "9d700ddc16539c15",
        "type": "group",
        "z": "043c9b21da5cbba8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4f9b9aad403a7716",
            "37bc8c54b51e0544",
            "238dc90f83e202b5",
            "47a8e2a4a04033b2",
            "19c76ec98c6c6f9e",
            "d91d138267780e70",
            "871fbf285c97ad32",
            "58cc42a80fabb538",
            "428fababd41468e5",
            "a2be1e487fc29763",
            "d402ccc398ad8e11",
            "f80d0cef913ac3b6",
            "7dad711be4a117f7",
            "b7bddd515b8a9da3",
            "9cc41c71b7e8e277"
        ],
        "x": 134,
        "y": 339,
        "w": 1412,
        "h": 282
    },
    {
        "id": "a2a5c6556a04c7ed",
        "type": "group",
        "z": "043c9b21da5cbba8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "2611be0f7bfa29c3",
            "641a94a8fde2acc3",
            "bc1ec909440f8c22",
            "bd9cca5d85c07dd4",
            "60cd23ec6f422ac1",
            "59f210ba6791d0a1",
            "9f318a7151cc5d6d",
            "56bd1f17c275a653",
            "4077b1f7c25ba23c",
            "d543fbc9eaaeb755",
            "326076c19834796f",
            "6cf09c18f6619610",
            "b73d117192e42809",
            "db70af4f273bfc97"
        ],
        "x": 134,
        "y": 659,
        "w": 1742,
        "h": 382
    },
    {
        "id": "e49647927e3b9d1e",
        "type": "group",
        "z": "043c9b21da5cbba8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d9daa6e7df2953bb",
            "a87e8394d9f25e8c",
            "fb30e09493d3f725",
            "83982045fbc9296b",
            "0fb2875d235f6c99",
            "b6b89773a30b7a33",
            "f50a98b0aabb9eac"
        ],
        "x": 134,
        "y": 1079,
        "w": 1332,
        "h": 162
    },
    {
        "id": "1a95f1f2d410aea3",
        "type": "group",
        "z": "043c9b21da5cbba8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "efee14a4a88be124",
            "c12f4c5b3b6032a4",
            "1855218a50989a4b",
            "9b2e7830db9edc47",
            "a8097aa9ba390408",
            "cd4279d372ca3068",
            "921bcc21c54deadc",
            "9e910b904fa61a23"
        ],
        "x": 134,
        "y": 1299,
        "w": 1272,
        "h": 222
    },
    {
        "id": "6fbdbe15acb6baf1",
        "type": "group",
        "z": "b0c6f1e3d4fc18a3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "inject_temp",
            "gen_temp",
            "decide_mode",
            "thermostat_asyncapi",
            "thermostat_debug",
            "thermostat_ui",
            "7a5f61a9eaff8de0"
        ],
        "x": 114,
        "y": 159,
        "w": 1332,
        "h": 202
    },
    {
        "id": "thermostat_group",
        "type": "group",
        "z": "smarthome_flow",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "inject_thermostat",
            "func_thermostat",
            "asyncapi_thermostat",
            "debug_thermostat",
            "ui_thermostat",
            "comment_thermostat"
        ],
        "x": 124,
        "y": 89,
        "w": 1122,
        "h": 172
    },
    {
        "id": "60aadd304320ab68",
        "type": "group",
        "z": "9d0b8d8486bf692d",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ec8567273d2eeee4",
            "4f76589d9ce93708",
            "3c02180f43d76483",
            "52372a1a90bed450",
            "08eba1a39da3c211",
            "d34fbeffad5f26c3"
        ],
        "x": 54,
        "y": 9,
        "w": 982,
        "h": 172
    },
    {
        "id": "7495cd4d423a5333",
        "type": "group",
        "z": "9d0b8d8486bf692d",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b2ace2b50a3cffc6",
            "5767fb305640ce22",
            "320f5263b6a058cb",
            "6c79919ed6d57634",
            "d61ec178a3c22e54",
            "29acb7a9e4ad24bf"
        ],
        "x": 74,
        "y": 259,
        "w": 942,
        "h": 172
    },
    {
        "id": "5b08965eee815217",
        "type": "group",
        "z": "db6486d1d2cd59d6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "565b754961e5b93e",
            "230fec0f35cc4133",
            "55079425775637d9",
            "559b9f04cf93c275",
            "512fb36647226d10"
        ],
        "x": 84,
        "y": 39,
        "w": 952,
        "h": 142
    },
    {
        "id": "4575d7c456ea2458",
        "type": "group",
        "z": "db6486d1d2cd59d6",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "01573af29b531a78",
            "4d738e0fc0f1352c",
            "a946ef667e501665",
            "0ab73cc9fa9c5c90",
            "91288be2c27b7ea4"
        ],
        "x": 74,
        "y": 289,
        "w": 942,
        "h": 142
    },
    {
        "id": "876a8dac7a94efab",
        "type": "group",
        "z": "4f4855f52107b72b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "94935853959483b3",
            "d7982dd2528420ba",
            "c99ee48a54796f90",
            "lights_group",
            "fridge_group",
            "launder_group",
            "dehumidifier_group",
            "cooker_group",
            "19609f77c4ba5897",
            "dbcecb9927394929",
            "881db607590cd279",
            "e2e99964236f8675",
            "6578bf7b191c43b7",
            "45e26e30f704ad47",
            "9c58429dd67aded0",
            "d72e67c06e6e6132"
        ],
        "x": 114,
        "y": 79,
        "w": 3612,
        "h": 1858
    },
    {
        "id": "e4a1e5e130e19d38",
        "type": "group",
        "z": "subflow_smarthome",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a9c603099da1e03f",
            "cda627aaa496a0a6",
            "895c7c19f3f0551f",
            "5a57beeed82dc92a",
            "4afe9ba8425f8677",
            "c22e79154c621f48",
            "f7cd6fc6dc26feb6",
            "f5fdf02df3e4db07",
            "4ac7585640aa85e7",
            "50ea0a25ce1a6cf2",
            "398f82e683f32eac",
            "e797385e830437c1",
            "b286887c3781c24d",
            "120aa6a9def4bbc7",
            "2e6836af4c8a6447",
            "99bfcadd3a7ad7f7",
            "2b7cb5b81308fd7d",
            "5392cb0f65e931be",
            "d57ddce80dd36ece",
            "b0adece6f42f3e45"
        ],
        "x": 14,
        "y": 99,
        "w": 2352,
        "h": 1488
    },
    {
        "id": "85b30d2997a48dee",
        "type": "group",
        "z": "7ecc82fdd5fcacdb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c73637d98e05e80e",
            "cbee460370ecb3f8",
            "30df11e17a49e28b",
            "11d91ae28562cdca",
            "3cd4dba2d47ed535",
            "e3185234fdbed879",
            "37227888554b698a",
            "12a36cdccd5ed9f8",
            "7d5c52aa5ac682d2",
            "a81d83c8e5e451b8",
            "3c917e3eeb92eecf",
            "a1714f7d84f7249a",
            "761fbf79bc5a0b6a",
            "8a7ff196473cf82f",
            "eee9708f5b5b3d60",
            "e5aad1750982bf58",
            "f8b4241ac415ab1f",
            "8ec75af908428eac",
            "3842878445c54be5",
            "db540a36c0cf8246"
        ],
        "x": 294,
        "y": 119,
        "w": 2352,
        "h": 1488
    },
    {
        "id": "1fa49e80804ba4e9",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a333501da61f1a20",
            "36419d94851ffc79",
            "eee7e011301bcbf4",
            "26b88c19ed42739c",
            "3e55092870925e77",
            "097d89aa59629f73",
            "0cf32fc590938082",
            "bdfb3a1e88b25177",
            "7db00f702c02067a",
            "8fc2037f9b700b26",
            "c31b2c9b810c7117",
            "002094cb10cdbc6f",
            "a55d2f0cd76a1492"
        ],
        "x": 1174,
        "y": 179,
        "w": 1812,
        "h": 1448
    },
    {
        "id": "79db7029138e3991",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "9535a63863ea686d",
            "a504b794e919ec6d",
            "ac2f13c2c3e301ab",
            "3d515a5aae85406d",
            "32437cd10b7bd0da",
            "082a42bca6946324",
            "880c6ae6fea682e1",
            "31ec45d1fb751eb3",
            "b3493c382db8b25f",
            "812c83bc679f15c2",
            "846382baf4b09b40",
            "05d8c5165e8b442d",
            "61b7f3f101e7e154"
        ],
        "x": 1174,
        "y": 1759,
        "w": 1832,
        "h": 1468
    },
    {
        "id": "cc269adf6e1ba45b",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1681804901a381b0",
            "578c52f835943667",
            "6ce0f618029e7642",
            "3c5d3892f9c9f62b",
            "922d1f1672d20315",
            "849497dbf1e186d2",
            "e4b3ec069e277d2c",
            "3cb00bc451a203fd",
            "65b3fbe9a3140f5c",
            "516213cc26f07d35",
            "0cb8a893cf72feb4",
            "3c64695a52caf9aa",
            "144944a855089db2"
        ],
        "x": 1174,
        "y": 3479,
        "w": 1832,
        "h": 1448
    },
    {
        "id": "1c4ecb18566c5e16",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "fab067ed35ac5296",
            "cd35ce574ffbb7cf",
            "e9f6b0a8c2b5862a",
            "1caac1c1e09790f8",
            "f1b862118a532714",
            "e4f2b3e6e6fcc8e6",
            "d429d4b0b2c99a27",
            "3ffb0f9cf0efe378",
            "3fbe6fc9eceb3834",
            "3024c8c2b2d68e28",
            "46407e9ca663ecdc",
            "a9dbe535eb7af705",
            "ae3ff85c06a7f1c5"
        ],
        "x": 1174,
        "y": 5099,
        "w": 1832,
        "h": 1448
    },
    {
        "id": "476064ef6b868dcb",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "97f1c3c79d186707",
            "415491f56995be24",
            "f4dcd5c5e7f6d210",
            "a1dda5463abe78d7",
            "458efb9d8bca6613",
            "3fd9bcb960b68688",
            "db8fdfd522e52070",
            "5ce92f73a77643dc",
            "24be558fbaa900c1",
            "3e914227798322aa",
            "7c318acebf4239bf",
            "0ee13980dcec1636",
            "9d60ed3188d1cfbe"
        ],
        "x": 3614,
        "y": 159,
        "w": 1732,
        "h": 1448
    },
    {
        "id": "1304969aadebd79a",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ad96f8a53eaca621",
            "d2361f27cfae6a45",
            "b6354af38600854d",
            "b536857a542d3e5a",
            "4062807e01f61076",
            "074f8abeede051d8",
            "139dc5f6ea2ba69f",
            "b1cb30e4b9d7ad5b",
            "f3b23842e98bd52a",
            "6ceb4f0284f028fd",
            "991b79fba54dd530",
            "c2c1b26c18e7d430",
            "01c9bbfdb259f9a9"
        ],
        "x": 3614,
        "y": 1759,
        "w": 1732,
        "h": 1468
    },
    {
        "id": "0e9437d90d297cb3",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "dfd8a7fd6e69c461",
            "4df98a23dc305fd9",
            "ea7c5f2f5b3aabf6",
            "2c0779ed8316824f",
            "458704ca8ab19d67",
            "4c656af60f49ba91",
            "a24ba65ac3a50d74",
            "fd4c21bd62c0bd0b",
            "9fbf388851f74602",
            "99416f52ef62612d",
            "e84ec87274df2ab4",
            "525dd032994486a2",
            "a9b11364d1d88e37"
        ],
        "x": 3634,
        "y": 3479,
        "w": 1712,
        "h": 1448
    },
    {
        "id": "0b55e8532164a7d0",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "7f9c5448391e2292",
            "a7070e2d6b982f5c",
            "64c546f8982846d9",
            "8aa8306c04403ab7",
            "ef8250ec88c42c1d",
            "bb478d62121a3402",
            "c5220e32833dbbf1",
            "86fd8e011843ed5e",
            "ec0d24c794e69dae",
            "d8a069cca5d5dc85",
            "e7cbb140fa8a4f60",
            "9e29310b33fbe444",
            "e936466af33466bc"
        ],
        "x": 3614,
        "y": 5099,
        "w": 1692,
        "h": 1448
    },
    {
        "id": "90d155064c160075",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b8d520884debc901",
            "9312e5d3654db867",
            "f31afbe78a2d9456",
            "ec0996a7a1172bf5",
            "777c9b53a48c2aa0",
            "c59f503f1475e555",
            "cb41cc528a414b41",
            "f16731579128fd4d"
        ],
        "x": 154,
        "y": 3159,
        "w": 692,
        "h": 702
    },
    {
        "id": "399c3e8574bf37c6",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "05cfc4cd6ea0ec69",
            "7af3daa6a12c4536",
            "d2ec12da30974627"
        ],
        "x": 6234,
        "y": 3239,
        "w": 452,
        "h": 162
    },
    {
        "id": "f3a7b992615fd6e7",
        "type": "group",
        "z": "438d596005491859",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "7f7a81c81fb18909",
            "3e5336b3c932e13c"
        ],
        "x": 528,
        "y": 233,
        "w": 814,
        "h": 374
    },
    {
        "id": "50d822b0af5cc61a",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "9be3feeb419a7b53",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "7beea3e98437718c",
            "4e8d16b83fa2b771",
            "0dc74f1972d85f33",
            "792d16844e582310"
        ],
        "x": 294,
        "y": 2139,
        "w": 762,
        "h": 142
    },
    {
        "id": "d2748fb7d73cced7",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "9be3feeb419a7b53",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ebcda5c59f9a16f1",
            "c4e7455fb216592d",
            "79b596b657bb6429",
            "1e8883acb1fd6cae"
        ],
        "x": 1134,
        "y": 2139,
        "w": 762,
        "h": 142
    },
    {
        "id": "7f7a81c81fb18909",
        "type": "group",
        "z": "438d596005491859",
        "g": "f3a7b992615fd6e7",
        "name": "Smart Plug ",
        "style": {
            "label": true
        },
        "nodes": [
            "0623d3f2732f194c",
            "474ac194c8bbc512",
            "dc0d300ba5c12af3",
            "a0774d5b5c031c59"
        ],
        "x": 594,
        "y": 259,
        "w": 672,
        "h": 142
    },
    {
        "id": "c99ee48a54796f90",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "07d92834eb8e47f5",
            "598f2008fafaa0f4",
            "fc5e972c26387247",
            "c966bb323b7cb3b5"
        ],
        "x": 2034,
        "y": 319,
        "w": 672,
        "h": 142
    },
    {
        "id": "lights_group",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "func_lights",
            "asyncapi_lights",
            "debug_lights",
            "750e70a11320f07b"
        ],
        "x": 2034,
        "y": 499,
        "w": 712,
        "h": 142
    },
    {
        "id": "fridge_group",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "func_fridge",
            "asyncapi_fridge",
            "debug_fridge",
            "047e02ede737fd4b"
        ],
        "x": 2034,
        "y": 679,
        "w": 752,
        "h": 162
    },
    {
        "id": "launder_group",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "asyncapi_launder",
            "debug_launder",
            "func_laundry_telemetry",
            "7acf5abf8245e211"
        ],
        "x": 2034,
        "y": 899,
        "w": 732,
        "h": 162
    },
    {
        "id": "dehumidifier_group",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "func_dehumidifier",
            "asyncapi_dehumidifier",
            "debug_dehumidifier",
            "f34984d5e6f1804a"
        ],
        "x": 2034,
        "y": 1099,
        "w": 832,
        "h": 142
    },
    {
        "id": "cooker_group",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "func_cooker",
            "asyncapi_cooker",
            "debug_cooker",
            "b8808b578daac992"
        ],
        "x": 2034,
        "y": 1299,
        "w": 832,
        "h": 142
    },
    {
        "id": "19609f77c4ba5897",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1915adae0ac41c37",
            "dbd082096676a420",
            "f8959e1f024fcb3c",
            "c4d08d0f89251bfb"
        ],
        "x": 2034,
        "y": 139,
        "w": 772,
        "h": 142
    },
    {
        "id": "895c7c19f3f0551f",
        "type": "group",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b52bab263572c522",
            "a7e703d573ec4166",
            "be13e5e3c979d9d4"
        ],
        "x": 714,
        "y": 479,
        "w": 712,
        "h": 102
    },
    {
        "id": "5a57beeed82dc92a",
        "type": "group",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c4556b999b1208b3",
            "8ec7e2a91468892d",
            "8fd588cc37f51938"
        ],
        "x": 714,
        "y": 679,
        "w": 712,
        "h": 82
    },
    {
        "id": "4afe9ba8425f8677",
        "type": "group",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "42d23aa09585e358",
            "7cafd92c117fdeb9",
            "f80ff6508ddb19de"
        ],
        "x": 714,
        "y": 879,
        "w": 752,
        "h": 82
    },
    {
        "id": "c22e79154c621f48",
        "type": "group",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "961faabd99242abd",
            "e35afa18d1e470d5",
            "262e6e90e095796a"
        ],
        "x": 734,
        "y": 1079,
        "w": 732,
        "h": 102
    },
    {
        "id": "f7cd6fc6dc26feb6",
        "type": "group",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "05dccd85d26e3e30",
            "bdc58d437bf02284",
            "46f0faaa609bbdbc"
        ],
        "x": 714,
        "y": 1279,
        "w": 832,
        "h": 102
    },
    {
        "id": "f5fdf02df3e4db07",
        "type": "group",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "628686b941d4090b",
            "013b60a3ce1b1613",
            "8c3c0e07bff92b9c"
        ],
        "x": 714,
        "y": 1479,
        "w": 752,
        "h": 82
    },
    {
        "id": "4ac7585640aa85e7",
        "type": "group",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "82413aa57e18a3ad",
            "19740f6dd834257d",
            "ab453755ab2ab8e2"
        ],
        "x": 714,
        "y": 259,
        "w": 892,
        "h": 102
    },
    {
        "id": "30df11e17a49e28b",
        "type": "group",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "9c27d852120b7dca",
            "d06e351e37ac7bb6",
            "1bc270fcb0f4a60e"
        ],
        "x": 994,
        "y": 499,
        "w": 712,
        "h": 102
    },
    {
        "id": "11d91ae28562cdca",
        "type": "group",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a77332e4e594898f",
            "7e3f0de7bd3f9c40",
            "fa9fa00ea88688f3"
        ],
        "x": 994,
        "y": 699,
        "w": 712,
        "h": 82
    },
    {
        "id": "3cd4dba2d47ed535",
        "type": "group",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6fc0b7f5e8f6f9f9",
            "c56ca9ce7a363f13",
            "8de414979fd14e22"
        ],
        "x": 994,
        "y": 899,
        "w": 752,
        "h": 82
    },
    {
        "id": "e3185234fdbed879",
        "type": "group",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "80fd24d3cd148573",
            "db7b0582888824c4",
            "49af89a3f9808103"
        ],
        "x": 1014,
        "y": 1099,
        "w": 732,
        "h": 102
    },
    {
        "id": "37227888554b698a",
        "type": "group",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "792098efbd9ededb",
            "8fc22c9d5addaedc",
            "5e5d6d6a1e0281a5"
        ],
        "x": 994,
        "y": 1299,
        "w": 832,
        "h": 102
    },
    {
        "id": "12a36cdccd5ed9f8",
        "type": "group",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "f6d2febb9468a103",
            "99b158b91d7bbe1d",
            "f2a482331f276baa"
        ],
        "x": 994,
        "y": 1499,
        "w": 752,
        "h": 82
    },
    {
        "id": "7d5c52aa5ac682d2",
        "type": "group",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e0db9ffe797a141e",
            "788d9c42c03be73c",
            "8c75489cbd6fbf08"
        ],
        "x": 994,
        "y": 279,
        "w": 892,
        "h": 102
    },
    {
        "id": "eee7e011301bcbf4",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4f02e55eef678fb0",
            "5d9d34e6bebf221b",
            "842a04c7b042a437"
        ],
        "x": 1314,
        "y": 559,
        "w": 712,
        "h": 102
    },
    {
        "id": "26b88c19ed42739c",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b5978c10396e9d4b",
            "8b68ed9d9c292207",
            "e5a2a869ee6c7f78"
        ],
        "x": 1314,
        "y": 719,
        "w": 712,
        "h": 82
    },
    {
        "id": "3e55092870925e77",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "33f212696921261a",
            "2b3702210cfd0fbf",
            "4d6947596cc265f4"
        ],
        "x": 1314,
        "y": 919,
        "w": 752,
        "h": 82
    },
    {
        "id": "097d89aa59629f73",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6f31a6c8c2513da5",
            "ee168de373833dc7",
            "9f3c7911a1fc7bca"
        ],
        "x": 1334,
        "y": 1119,
        "w": 732,
        "h": 102
    },
    {
        "id": "0cf32fc590938082",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "526f83f5d6fb5cc2",
            "a9d32f4ef81a7219",
            "dd2c8d449ee544d7"
        ],
        "x": 1314,
        "y": 1319,
        "w": 832,
        "h": 102
    },
    {
        "id": "bdfb3a1e88b25177",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b2f07029b50cd13e",
            "e26a96508f610791",
            "3aefce1db0f6306d"
        ],
        "x": 1314,
        "y": 1519,
        "w": 752,
        "h": 82
    },
    {
        "id": "7db00f702c02067a",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "291018ba1e012610",
            "3e675a13b663b200",
            "60f928be6b67b38b"
        ],
        "x": 1294,
        "y": 359,
        "w": 892,
        "h": 102
    },
    {
        "id": "ac2f13c2c3e301ab",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "53eb72be1698e319",
            "0ac5bf7ebab88a61",
            "84452318c5fa6f88"
        ],
        "x": 1294,
        "y": 2119,
        "w": 712,
        "h": 102
    },
    {
        "id": "3d515a5aae85406d",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "00a3e31d2ab3a53f",
            "d7e52fc62cc63298",
            "aade082b6a758113"
        ],
        "x": 1294,
        "y": 2319,
        "w": 712,
        "h": 82
    },
    {
        "id": "32437cd10b7bd0da",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a7df41d26f49ee99",
            "db3682ec501d1b29",
            "9ff8bcf82022fb2d"
        ],
        "x": 1294,
        "y": 2519,
        "w": 752,
        "h": 82
    },
    {
        "id": "082a42bca6946324",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "cd0e08a99563e93a",
            "57ee205d5681354e",
            "07681baecbc334e9"
        ],
        "x": 1314,
        "y": 2719,
        "w": 732,
        "h": 102
    },
    {
        "id": "880c6ae6fea682e1",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "3e577da3fb9e2779",
            "a1e81fcfdd236b29",
            "d2f3b72e4edd3e00"
        ],
        "x": 1294,
        "y": 2919,
        "w": 832,
        "h": 102
    },
    {
        "id": "31ec45d1fb751eb3",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "85e9cf0b3f60b71d",
            "d3f6f727425fffc3",
            "320adf65c4d6a3b6"
        ],
        "x": 1294,
        "y": 3119,
        "w": 752,
        "h": 82
    },
    {
        "id": "b3493c382db8b25f",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "84ee18b5ffb4b565",
            "48d27a913ca24a1f",
            "46a07f2f3646b1dc"
        ],
        "x": 1294,
        "y": 1899,
        "w": 892,
        "h": 102
    },
    {
        "id": "6ce0f618029e7642",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ee23f591e84f6803",
            "a3f7adc61781260e",
            "cb33cff4026dd43c"
        ],
        "x": 1274,
        "y": 3819,
        "w": 712,
        "h": 102
    },
    {
        "id": "3c5d3892f9c9f62b",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e86cb7437ca2e8bb",
            "161fef0711849fc1",
            "f82f61e4e9a5c1b4"
        ],
        "x": 1274,
        "y": 4019,
        "w": 712,
        "h": 82
    },
    {
        "id": "922d1f1672d20315",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "cfe5e04ab15f4758",
            "12c2b147261a1c1d",
            "65199cf0527220df"
        ],
        "x": 1274,
        "y": 4219,
        "w": 752,
        "h": 82
    },
    {
        "id": "849497dbf1e186d2",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b0ad22a7e58497a0",
            "9362a28e3923fd48",
            "692c360c42b0fd11"
        ],
        "x": 1294,
        "y": 4419,
        "w": 732,
        "h": 102
    },
    {
        "id": "e4b3ec069e277d2c",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "7a1b7c5d6c172e16",
            "41bdaebb2e9855e5",
            "9318458be405ec0f"
        ],
        "x": 1274,
        "y": 4619,
        "w": 832,
        "h": 102
    },
    {
        "id": "3cb00bc451a203fd",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e440d9774ed58920",
            "4a942e4bc7a5a1a8",
            "f9b4056d34ff6e79"
        ],
        "x": 1274,
        "y": 4819,
        "w": 752,
        "h": 82
    },
    {
        "id": "65b3fbe9a3140f5c",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "fb834d281616ef0d",
            "a8bc925b719ae023",
            "3ba185ed0e40da35"
        ],
        "x": 1274,
        "y": 3599,
        "w": 892,
        "h": 102
    },
    {
        "id": "e9f6b0a8c2b5862a",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "aedf1365b9d5bcbb",
            "ef2111baf49172bf",
            "eb5793bb3b236c0c"
        ],
        "x": 1274,
        "y": 5439,
        "w": 712,
        "h": 102
    },
    {
        "id": "1caac1c1e09790f8",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6e1e2973d32ab79f",
            "18348cd9cc858c69",
            "6f95c067896b64a7"
        ],
        "x": 1274,
        "y": 5639,
        "w": 712,
        "h": 82
    },
    {
        "id": "f1b862118a532714",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "25c6fb4e3336640a",
            "3523e3f2b625db79",
            "a6d6579ab8206e5e"
        ],
        "x": 1274,
        "y": 5839,
        "w": 752,
        "h": 82
    },
    {
        "id": "e4f2b3e6e6fcc8e6",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "53772252812fbcab",
            "59a566d47b36f65e",
            "5f0554b2b5db9155"
        ],
        "x": 1294,
        "y": 6039,
        "w": 732,
        "h": 102
    },
    {
        "id": "d429d4b0b2c99a27",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b719b1746d2ebc88",
            "0fd6f53989ffc648",
            "6fb7020373362d13"
        ],
        "x": 1274,
        "y": 6239,
        "w": 832,
        "h": 102
    },
    {
        "id": "3ffb0f9cf0efe378",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4d0a0e13f3aa0305",
            "ad4ce6803ae59aa4",
            "9061aded936a7acb"
        ],
        "x": 1274,
        "y": 6439,
        "w": 752,
        "h": 82
    },
    {
        "id": "3fbe6fc9eceb3834",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e0e9f45127be2564",
            "f096aaaa790496cf",
            "728426c6d9a7ff54"
        ],
        "x": 1274,
        "y": 5219,
        "w": 892,
        "h": 102
    },
    {
        "id": "f4dcd5c5e7f6d210",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "6c6335ecc06dfc1b",
            "95a68b78fc45cccb",
            "170a5f9a7f66fca0"
        ],
        "x": 3694,
        "y": 499,
        "w": 712,
        "h": 102
    },
    {
        "id": "a1dda5463abe78d7",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "9764435b19f67e4c",
            "1cc84ee986555227",
            "c5612a882ced3c16"
        ],
        "x": 3694,
        "y": 699,
        "w": 712,
        "h": 82
    },
    {
        "id": "458efb9d8bca6613",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b90a3bf6c51b0cc6",
            "5be61b5693fc9722",
            "c77f6df550f965eb"
        ],
        "x": 3694,
        "y": 899,
        "w": 752,
        "h": 82
    },
    {
        "id": "3fd9bcb960b68688",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "75ec20037659034e",
            "a8bfd7d6a275867b",
            "42e368e15af97dcd"
        ],
        "x": 3714,
        "y": 1099,
        "w": 732,
        "h": 102
    },
    {
        "id": "db8fdfd522e52070",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e4e918777412d058",
            "905d909648576db5",
            "29291f381788ae9c"
        ],
        "x": 3694,
        "y": 1299,
        "w": 832,
        "h": 102
    },
    {
        "id": "5ce92f73a77643dc",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b696d52e5412d4be",
            "0cddcae669ec4976",
            "b13024facfd019e7"
        ],
        "x": 3694,
        "y": 1499,
        "w": 752,
        "h": 82
    },
    {
        "id": "24be558fbaa900c1",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d2baeaca4a7d571d",
            "89bf4834bc84ee48",
            "7015e750817ef422"
        ],
        "x": 3674,
        "y": 259,
        "w": 952,
        "h": 102
    },
    {
        "id": "b6354af38600854d",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b03c5837abac29a0",
            "cb6ef4d3e30787f1",
            "0751796c713e767a"
        ],
        "x": 3734,
        "y": 2079,
        "w": 712,
        "h": 102
    },
    {
        "id": "b536857a542d3e5a",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "ba1aea899432865a",
            "e54c78d79e6b0fb6",
            "3aea3eb13373bd0f"
        ],
        "x": 3734,
        "y": 2279,
        "w": 712,
        "h": 82
    },
    {
        "id": "4062807e01f61076",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a9071186935d7c08",
            "d9aca3090a6222f3",
            "c00c7b59eca1392a"
        ],
        "x": 3734,
        "y": 2479,
        "w": 752,
        "h": 82
    },
    {
        "id": "074f8abeede051d8",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b84f5293acb12a87",
            "ffcb745d1a4e0e3e",
            "6404e6e05c8854b1"
        ],
        "x": 3754,
        "y": 2679,
        "w": 732,
        "h": 102
    },
    {
        "id": "139dc5f6ea2ba69f",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1d8f8a53c9eb4273",
            "d5b02b94111d0d74",
            "ec1be4becf001c3b"
        ],
        "x": 3734,
        "y": 2879,
        "w": 832,
        "h": 102
    },
    {
        "id": "b1cb30e4b9d7ad5b",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "f9d3021c446134cd",
            "9ad7656d0ed6b591",
            "d6bf2e866ebae2ea"
        ],
        "x": 3774,
        "y": 3119,
        "w": 752,
        "h": 82
    },
    {
        "id": "f3b23842e98bd52a",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "18d6289f541cde43",
            "65ecb36353a61463",
            "d225112b2619e8d4"
        ],
        "x": 3734,
        "y": 1859,
        "w": 892,
        "h": 102
    },
    {
        "id": "ea7c5f2f5b3aabf6",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "fcd0f3b7b57b5bca",
            "8fe9c415de272582",
            "2ecc63e5677ee090"
        ],
        "x": 3754,
        "y": 3859,
        "w": 712,
        "h": 102
    },
    {
        "id": "2c0779ed8316824f",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "be1bb0650a31a1aa",
            "d3f25665ce7cfcfe",
            "711d81536a1ec1eb"
        ],
        "x": 3754,
        "y": 4059,
        "w": 712,
        "h": 82
    },
    {
        "id": "458704ca8ab19d67",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "89840683aba16d92",
            "0d9fa60dc2296aad",
            "e18b0bfeb87c82f2"
        ],
        "x": 3754,
        "y": 4259,
        "w": 752,
        "h": 82
    },
    {
        "id": "4c656af60f49ba91",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d1a985180d5f8fcc",
            "f1433765f47226f9",
            "c3c9ac05b9510a42"
        ],
        "x": 3774,
        "y": 4459,
        "w": 732,
        "h": 102
    },
    {
        "id": "a24ba65ac3a50d74",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "85dd61feea2f242c",
            "eea349a527bc4116",
            "df03e6c3a6804f27"
        ],
        "x": 3754,
        "y": 4659,
        "w": 832,
        "h": 102
    },
    {
        "id": "fd4c21bd62c0bd0b",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "cae3f3494f39d28f",
            "7bf404de98463c2c",
            "558bb2fbadafa4e0"
        ],
        "x": 3674,
        "y": 4799,
        "w": 732,
        "h": 102
    },
    {
        "id": "9fbf388851f74602",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "419367a60f814a06",
            "51b8b10909086b0a",
            "5fd20c670685859f"
        ],
        "x": 3734,
        "y": 3619,
        "w": 892,
        "h": 102
    },
    {
        "id": "64c546f8982846d9",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d767c2a73547db9d",
            "5b46130ca6a26f0d",
            "9aa9c84c88d2802f"
        ],
        "x": 3654,
        "y": 5459,
        "w": 712,
        "h": 102
    },
    {
        "id": "8aa8306c04403ab7",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a994865b84aa0451",
            "7d7000d727b37a9c",
            "1379537f0b89f35e"
        ],
        "x": 3654,
        "y": 5659,
        "w": 712,
        "h": 82
    },
    {
        "id": "ef8250ec88c42c1d",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c72018496d42cd30",
            "3c9e54f68af0bbee",
            "9b6007085de4352e"
        ],
        "x": 3654,
        "y": 5859,
        "w": 752,
        "h": 82
    },
    {
        "id": "bb478d62121a3402",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "f1406c22b031651f",
            "3dbceb95792006a6",
            "9c46ddbd6587d60f"
        ],
        "x": 3674,
        "y": 6059,
        "w": 732,
        "h": 102
    },
    {
        "id": "c5220e32833dbbf1",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "0eb307de2a08f572",
            "b91580c4611b56f9",
            "09cdfd7705549c26"
        ],
        "x": 3654,
        "y": 6259,
        "w": 832,
        "h": 102
    },
    {
        "id": "86fd8e011843ed5e",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c996f1ef27b8efda",
            "a21d83268b8ddea1",
            "806df53aa1a6e276"
        ],
        "x": 3674,
        "y": 6439,
        "w": 752,
        "h": 82
    },
    {
        "id": "ec0d24c794e69dae",
        "type": "group",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "87df2992b512e6bf",
            "5bdb778de4b4af86",
            "a96c3ad9d927ff1f"
        ],
        "x": 3654,
        "y": 5239,
        "w": 892,
        "h": 102
    },
    {
        "id": "3e5336b3c932e13c",
        "type": "group",
        "z": "438d596005491859",
        "g": "f3a7b992615fd6e7",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1396224ee5de4b8d",
            "ac4c005192cf780a",
            "9e0c9391f9b4250a",
            "43333b017ce7e0ff"
        ],
        "x": 554,
        "y": 439,
        "w": 762,
        "h": 142
    },
    {
        "id": "881db607590cd279",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "name": "Smart Plug ",
        "style": {
            "label": true
        },
        "nodes": [
            "5e636eef5daa1b5f",
            "ddf88dd27e263bd5",
            "0776bc1099a8818c",
            "91dad80f577e2b9f",
            "57eefc9f63239b74",
            "d19baf00cf51bded"
        ],
        "x": 434,
        "y": 119,
        "w": 932,
        "h": 212
    },
    {
        "id": "e2e99964236f8675",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "name": "Smart Plug ",
        "style": {
            "label": true
        },
        "nodes": [
            "7b0894f417168af4",
            "a3255351da27c4c9",
            "f3aa31b745aa88b8",
            "43a4f2d07be30783",
            "58d6581bc5500dc9",
            "14fd1ecf6e17d3c3"
        ],
        "x": 434,
        "y": 1699,
        "w": 912,
        "h": 212
    },
    {
        "id": "6578bf7b191c43b7",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "577012c85e361b8b",
            "8084d0c60d963452",
            "f7310e18baa39bd1"
        ],
        "x": 594,
        "y": 859,
        "w": 612,
        "h": 142
    },
    {
        "id": "45e26e30f704ad47",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "name": "Smart Plug ",
        "style": {
            "label": true
        },
        "nodes": [
            "8a54f719f26ad8aa",
            "67c5da6c604320b8",
            "11e4fbb90c6f9d1a",
            "3474c5bf1ab29ecd",
            "f2a1daf9ebd965d6",
            "3c3f82bfebc2ba37"
        ],
        "x": 434,
        "y": 1419,
        "w": 912,
        "h": 212
    },
    {
        "id": "fe7c6d62782a61e9",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "9be3feeb419a7b53",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a3b4653f0cf6ae5d",
            "e94a1310f11d28ae",
            "c6af873c12f6835f",
            "7277ba557dca3273"
        ],
        "x": 1974,
        "y": 2139,
        "w": 812,
        "h": 142
    },
    {
        "id": "9be3feeb419a7b53",
        "type": "group",
        "z": "4f4855f52107b72b",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "d2748fb7d73cced7",
            "50d822b0af5cc61a",
            "fe7c6d62782a61e9",
            "6028a3ed46cca3d4",
            "abefde1276346b1c",
            "0d443770ff71eb54"
        ],
        "x": 268,
        "y": 2039,
        "w": 2544,
        "h": 488
    },
    {
        "id": "abefde1276346b1c",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "9be3feeb419a7b53",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "4003081ec19ca6d6",
            "670d73bf79ea2a0d",
            "4deeabc6a75aae45",
            "7cb36fb185a2217e"
        ],
        "x": 294,
        "y": 2359,
        "w": 812,
        "h": 142
    },
    {
        "id": "0d443770ff71eb54",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "9be3feeb419a7b53",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "8fe7947781d8abaa",
            "e4d27f662a46cc39",
            "883f36bae22e7492",
            "5fcd41c00a481bb9"
        ],
        "x": 1214,
        "y": 2359,
        "w": 832,
        "h": 142
    },
    {
        "id": "9c58429dd67aded0",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "name": "Smart Plug ",
        "style": {
            "label": true
        },
        "nodes": [
            "eed1f93db727e728",
            "638a5cf47e62722e",
            "8f8ef71dd8a15893",
            "e6fe9b42f4d79edf",
            "4434127a410944ad",
            "42a38b50701f7a16"
        ],
        "x": 434,
        "y": 1139,
        "w": 912,
        "h": 212
    },
    {
        "id": "d72e67c06e6e6132",
        "type": "group",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "name": "Smart Plug ",
        "style": {
            "label": true
        },
        "nodes": [
            "e6d51b72905c0448",
            "a7e74769d12738d5",
            "beea24a1850466d6",
            "a66a27203f3dea31",
            "4cc30fd54c279296",
            "df8beacd24a634c0"
        ],
        "x": 414,
        "y": 439,
        "w": 932,
        "h": 212
    },
    {
        "id": "4fc15b76b4d55d7d",
        "type": "openApi-red-url",
        "name": "petstore openApi (v3)",
        "url": "https://petstore3.swagger.io/api/v3/openapi.json",
        "urlType": "str",
        "server": "https://petstore3.swagger.io/api/v3",
        "serverType": "server",
        "devMode": false,
        "headers": [],
        "_version": "2.1.3"
    },
    {
        "id": "4e8e4d5957412be2",
        "type": "openApi-red-url",
        "name": "petstore swagger (v2)",
        "url": "https://petstore.swagger.io/v2/swagger.json",
        "urlType": "str",
        "server": "",
        "serverType": "custom",
        "devMode": false,
        "headers": [
            {
                "key": "HUND",
                "valueType": "str",
                "value": "Katze"
            },
            {
                "key": "Bearer",
                "valueType": "str",
                "value": ""
            }
        ],
        "_version": "2.1.3"
    },
    {
        "id": "ebcd5e7d922cbc68",
        "type": "openApi-red-url",
        "name": "",
        "url": "openapi.json",
        "urlType": "Files",
        "server": "http://172.16.1.1:5002/AirCondition_actuator",
        "serverType": "server",
        "devMode": "",
        "headers": [],
        "_version": "2.1.3"
    },
    {
        "id": "3551e0fac838662f",
        "type": "openApi-red-url",
        "name": "",
        "url": "openapi.json",
        "urlType": "Files",
        "server": "http://172.16.1.1:8080/AirCondition_actuator",
        "serverType": "server",
        "devMode": "",
        "headers": [],
        "_version": "2.1.3"
    },
    {
        "id": "51fce998cf99ca3b",
        "type": "mqtt-broker",
        "name": "",
        "broker": "mqtt://172.17.0.1:1883/",
        "port": 1883,
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "mqtt-broker",
        "type": "mqtt-broker",
        "name": "Local MQTT",
        "broker": "localhost",
        "port": "1883",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 15,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthQos": "0",
        "willQos": "0"
    },
    {
        "id": "4f0d8a914be2cfb6",
        "type": "mqtt-broker",
        "name": "Local MQTT",
        "broker": "172.17.0.1",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true
    },
    {
        "id": "mqtt_local_broker",
        "type": "mqtt-broker",
        "name": "Local MQTT",
        "broker": "172.17.0.1",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "3ff102b65ec67eb7",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "83c770877dc34b82",
        "type": "ui_tab",
        "name": "Smarthome+",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "8c896da163d208f1",
        "type": "ui_group",
        "name": "Default",
        "tab": "83c770877dc34b82",
        "order": 1,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "878fdd13b31382f1",
        "type": "ui_tab",
        "name": "Smarthome+",
        "icon": "dashboard",
        "order": 1
    },
    {
        "id": "50ee364d11f0bce8",
        "type": "ui_group",
        "name": "Default",
        "tab": "878fdd13b31382f1",
        "order": 1,
        "disp": true,
        "width": 6,
        "collapse": false
    },
    {
        "id": "dc836ed8a4522e30",
        "type": "ui_group",
        "name": "AC Device",
        "tab": "83c770877dc34b82",
        "order": 1,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "env_tab",
        "type": "ui_tab",
        "name": "Environment",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "env_group",
        "type": "ui_group",
        "name": "Room",
        "tab": "env_tab",
        "order": 1,
        "disp": true,
        "width": "12",
        "collapse": false
    },
    {
        "id": "ui_tab_dashboard",
        "type": "ui_tab",
        "name": "SmartHome+",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "ui_group_neighborhood",
        "type": "ui_group",
        "name": "Neighborhood",
        "tab": "ui_tab_dashboard",
        "order": 1,
        "disp": true,
        "width": 6,
        "collapse": false
    },
    {
        "id": "6d55c70992ff39a9",
        "type": "openApi-red-url",
        "name": "",
        "url": "smart-plug.json.yaml",
        "urlType": "Files",
        "server": "http://localhost:1880",
        "serverType": "server",
        "devMode": "",
        "headers": [],
        "_version": "2.1.3"
    },
    {
        "id": "92fb21b02d9a57e6",
        "type": "openApi-red-url",
        "name": "",
        "url": "smart-plug.json",
        "urlType": "Files",
        "server": "http://localhost:1880",
        "serverType": "server",
        "devMode": "",
        "headers": [],
        "_version": "2.1.3"
    },
    {
        "id": "742282c109ee77de",
        "type": "openApi-red-url",
        "name": "",
        "url": "smart-plug-cooker.json",
        "urlType": "Files",
        "server": "http://localhost:1880",
        "serverType": "server",
        "devMode": "",
        "headers": [],
        "_version": "2.1.3"
    },
    {
        "id": "6d897e1ac1cd195a",
        "type": "openApi-red-url",
        "name": "",
        "url": "smart-plug-laundry.json",
        "urlType": "Files",
        "server": "http://localhost:1880",
        "serverType": "server",
        "devMode": "",
        "headers": [],
        "_version": "2.1.3"
    },
    {
        "id": "f2d3a14b35277c31",
        "type": "openApi-red-url",
        "name": "",
        "url": "smart-plug-thermostat.json",
        "urlType": "Files",
        "server": "",
        "serverType": "custom",
        "devMode": "",
        "headers": [],
        "_version": "2.1.3"
    },
    {
        "id": "a33f75c91933dc08",
        "type": "openApi-red-url",
        "name": "",
        "url": "smart-plug-laundry.json",
        "urlType": "Files",
        "server": "http://localhost:1880",
        "serverType": "server",
        "devMode": "",
        "headers": []
    },
    {
        "id": "f63fb066d1c65936",
        "type": "openApi-red-url",
        "name": "",
        "url": "smart-plug-lights.json",
        "urlType": "Files",
        "server": "http://localhost:1880",
        "serverType": "server",
        "devMode": "",
        "headers": []
    },
    {
        "id": "360efb94946efef5",
        "type": "openApi-red-url",
        "name": "",
        "url": "",
        "urlType": "str",
        "server": "",
        "serverType": "custom",
        "devMode": "",
        "headers": []
    },
    {
        "id": "2c2826fa3fc78558",
        "type": "inject",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Inject Current Temp",
        "props": [],
        "repeat": "300",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 300,
        "y": 180,
        "wires": [
            [
                "f5b57f8f9931df1d"
            ]
        ]
    },
    {
        "id": "f034a42a7690f2b6",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Compare and Decide",
        "func": "const desired = flow.get('desired_temp') || 22;\nconst current = msg.payload.current;\nlet state = \"IDLE\";\nif (current < desired - 1) state = \"HEATING\";\nelse if (current > desired + 1) state = \"COOLING\";\nmsg.payload = { temperature: desired, unit: \"C\", current, state };\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 140,
        "wires": [
            [
                "386c2541306d379c"
            ]
        ]
    },
    {
        "id": "5d88956b6c0935c0",
        "type": "ui_text",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Status Display",
        "label": "Thermostat Status",
        "format": "{{msg.payload.state}} | Current: {{msg.payload.current}}C | Target: {{msg.payload.temperature}}C",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1370,
        "y": 240,
        "wires": []
    },
    {
        "id": "386c2541306d379c",
        "type": "async-api-red",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Send to Thermostat Device",
        "x": 1050,
        "y": 180,
        "wires": [
            [
                "c9dd5b14b31c8ac4",
                "5d88956b6c0935c0"
            ]
        ]
    },
    {
        "id": "c9dd5b14b31c8ac4",
        "type": "debug",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Debug Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 160,
        "wires": []
    },
    {
        "id": "80a07121563fc510",
        "type": "comment",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Thermostat simulation",
        "info": "",
        "x": 260,
        "y": 60,
        "wires": []
    },
    {
        "id": "5838340eeabc7fc3",
        "type": "ui_slider",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Desired Temp",
        "label": "Set Desired Temp",
        "tooltip": "",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "topicType": "str",
        "min": 15,
        "max": 30,
        "step": 1,
        "className": "",
        "x": 280,
        "y": 260,
        "wires": [
            [
                "a9a704cd8fe91875"
            ]
        ]
    },
    {
        "id": "a9a704cd8fe91875",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Store Desired Temp",
        "func": "flow.set('desired_temp', msg.payload);\nreturn null;",
        "outputs": 1,
        "x": 510,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "f5b57f8f9931df1d",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Generate Current Temp",
        "func": "msg.payload = { current: Math.floor(15 + Math.random() * 15) };\nreturn msg;",
        "outputs": 1,
        "x": 530,
        "y": 180,
        "wires": [
            [
                "f034a42a7690f2b6",
                "da3a80e17247daa5"
            ]
        ]
    },
    {
        "id": "da3a80e17247daa5",
        "type": "ui_gauge",
        "z": "043c9b21da5cbba8",
        "g": "9d8fc96b503dd8a9",
        "name": "Current Temp",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Current Temperature",
        "label": "C",
        "format": "{{msg.payload.current}}",
        "min": "10",
        "max": "35",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 770,
        "y": 240,
        "wires": []
    },
    {
        "id": "4f9b9aad403a7716",
        "type": "comment",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "AC simulation",
        "info": "",
        "x": 230,
        "y": 400,
        "wires": []
    },
    {
        "id": "37bc8c54b51e0544",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Check AC State",
        "func": "const currentTemp = msg.payload.temperature;\nconst desiredTemp = flow.get(\"desired_temp\") || 24;\nmsg.payload = {\n    temperature: currentTemp,\n    desired: desiredTemp,\n    unit: 'C',\n    state: currentTemp > desiredTemp ? \"ON\" : \"OFF\"\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 440,
        "wires": [
            [
                "238dc90f83e202b5",
                "9cc41c71b7e8e277"
            ]
        ]
    },
    {
        "id": "238dc90f83e202b5",
        "type": "async-api-red",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "AC Controller Node",
        "x": 1080,
        "y": 440,
        "wires": [
            [
                "47a8e2a4a04033b2",
                "19c76ec98c6c6f9e",
                "58cc42a80fabb538"
            ]
        ]
    },
    {
        "id": "47a8e2a4a04033b2",
        "type": "debug",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Debug AC Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1410,
        "y": 400,
        "wires": []
    },
    {
        "id": "19c76ec98c6c6f9e",
        "type": "ui_text",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "AC State",
        "label": "AC State",
        "format": "AC is {{msg.payload.state}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1440,
        "y": 480,
        "wires": []
    },
    {
        "id": "d91d138267780e70",
        "type": "ui_slider",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Desired Temp",
        "label": "Set Desired Temp",
        "tooltip": "",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "topicType": "str",
        "min": 15,
        "max": 30,
        "step": 1,
        "className": "",
        "x": 340,
        "y": 520,
        "wires": [
            [
                "871fbf285c97ad32"
            ]
        ]
    },
    {
        "id": "871fbf285c97ad32",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Store Desired Temp",
        "func": "flow.set('desired_temp', msg.payload);\nreturn null;",
        "outputs": 1,
        "x": 610,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "58cc42a80fabb538",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Track Energy",
        "func": "// Constants\nconst power_kW = 1.5; // Power usage of the AC in kW\n\n// Get previous state and timestamp\nconst prevState = flow.get(\"ac_last_state\") || \"OFF\";\nconst lastChange = flow.get(\"ac_last_change\") || Date.now();\nconst energy = flow.get(\"energy_consumed\") || 0;\n\nconst now = Date.now();\nlet newEnergy = energy;\n\nif (prevState === \"ON\" && msg.payload.state === \"OFF\") {\n    const durationHrs = (now - lastChange) / (1000 * 60 * 60);\n    newEnergy += durationHrs * power_kW;\n    flow.set(\"energy_consumed\", newEnergy);\n}\n\n// Update flow context\nflow.set(\"ac_last_state\", msg.payload.state);\nflow.set(\"ac_last_change\", now);\n\nmsg.energy = newEnergy.toFixed(3);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 520,
        "wires": [
            [
                "428fababd41468e5"
            ]
        ]
    },
    {
        "id": "428fababd41468e5",
        "type": "ui_text",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Energy Display",
        "label": "Total Energy (kWh)",
        "format": "{{msg.energy}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1440,
        "y": 560,
        "wires": []
    },
    {
        "id": "a2be1e487fc29763",
        "type": "ui_button",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Reset Energy",
        "label": "Reset Energy",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "refresh",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 340,
        "y": 580,
        "wires": [
            [
                "d402ccc398ad8e11"
            ]
        ]
    },
    {
        "id": "d402ccc398ad8e11",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Reset Energy Values",
        "func": "flow.set(\"energy_consumed\", 0);\nflow.set(\"ac_last_change\", Date.now());\nreturn null;",
        "outputs": 0,
        "x": 610,
        "y": 580,
        "wires": []
    },
    {
        "id": "f80d0cef913ac3b6",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Generate Current Temp",
        "func": "msg.payload = { temperature: Math.floor(15 + Math.random() * 15) };\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 440,
        "wires": [
            [
                "b7bddd515b8a9da3",
                "37bc8c54b51e0544"
            ]
        ]
    },
    {
        "id": "7dad711be4a117f7",
        "type": "inject",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Inject Current Temp",
        "props": [],
        "repeat": "5",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 340,
        "y": 440,
        "wires": [
            [
                "f80d0cef913ac3b6"
            ]
        ]
    },
    {
        "id": "b7bddd515b8a9da3",
        "type": "ui_gauge",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "Current Temp",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Current Temperature",
        "label": "C",
        "format": "{{msg.payload.temperature}}",
        "min": "10",
        "max": "35",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 830,
        "y": 500,
        "wires": []
    },
    {
        "id": "9cc41c71b7e8e277",
        "type": "debug",
        "z": "043c9b21da5cbba8",
        "g": "9d700ddc16539c15",
        "name": "input ac",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 960,
        "y": 380,
        "wires": []
    },
    {
        "id": "2611be0f7bfa29c3",
        "type": "inject",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Inject Random Brightness",
        "props": [],
        "repeat": "5",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 300,
        "y": 840,
        "wires": [
            [
                "641a94a8fde2acc3"
            ]
        ]
    },
    {
        "id": "641a94a8fde2acc3",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Generate Brightness",
        "func": "const brightness = Math.floor(Math.random() * 101);\nmsg.payload = { brightness };\nreturn msg;",
        "outputs": 1,
        "x": 560,
        "y": 780,
        "wires": [
            [
                "bc1ec909440f8c22",
                "bd9cca5d85c07dd4"
            ]
        ]
    },
    {
        "id": "bc1ec909440f8c22",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Check Brightness",
        "func": "const brightness = msg.payload.brightness;\nmsg.payload = {\n    state: brightness >= 80 ? \"on\" : \"off\",\n    brightness\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 780,
        "wires": [
            [
                "d543fbc9eaaeb755"
            ]
        ]
    },
    {
        "id": "bd9cca5d85c07dd4",
        "type": "ui_chart",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Brightness Chart",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "Brightness Over Time",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "Waiting...",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 750,
        "y": 900,
        "wires": [
            []
        ]
    },
    {
        "id": "60cd23ec6f422ac1",
        "type": "switch",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Light ON or OFF?",
        "property": "payload.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1270,
        "y": 720,
        "wires": [
            [
                "59f210ba6791d0a1"
            ],
            [
                "9f318a7151cc5d6d"
            ]
        ]
    },
    {
        "id": "59f210ba6791d0a1",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Count ON",
        "func": "let count = context.get('on') || 0;\ncount += 1;\ncontext.set('on', count);\nmsg.payload = count;\nreturn msg;",
        "outputs": 1,
        "x": 1560,
        "y": 700,
        "wires": [
            [
                "56bd1f17c275a653"
            ]
        ]
    },
    {
        "id": "9f318a7151cc5d6d",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Count OFF",
        "func": "let count = context.get('off') || 0;\ncount += 1;\ncontext.set('off', count);\nmsg.payload = count;\nreturn msg;",
        "outputs": 1,
        "x": 1560,
        "y": 740,
        "wires": [
            [
                "4077b1f7c25ba23c"
            ]
        ]
    },
    {
        "id": "56bd1f17c275a653",
        "type": "ui_text",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "group": "",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "Times ON",
        "label": "Light ON Count",
        "format": "{{msg.payload}} times",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1780,
        "y": 700,
        "wires": []
    },
    {
        "id": "4077b1f7c25ba23c",
        "type": "ui_text",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "group": "",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "Times OFF",
        "label": "Light OFF Count",
        "format": "{{msg.payload}} times",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1780,
        "y": 740,
        "wires": []
    },
    {
        "id": "d543fbc9eaaeb755",
        "type": "async-api-red",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Send to Light Device",
        "x": 1040,
        "y": 840,
        "wires": [
            [
                "60cd23ec6f422ac1",
                "326076c19834796f",
                "6cf09c18f6619610",
                "b73d117192e42809"
            ]
        ]
    },
    {
        "id": "326076c19834796f",
        "type": "ui_gauge",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "Brightness",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Brightness",
        "label": "%",
        "format": "{{msg.payload.brightness}}",
        "min": 0,
        "max": 100,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": 60,
        "seg2": 80,
        "diff": false,
        "className": "",
        "x": 1290,
        "y": 820,
        "wires": []
    },
    {
        "id": "6cf09c18f6619610",
        "type": "ui_text",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Light State",
        "label": "Light State",
        "format": "{{msg.payload.state}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1290,
        "y": 920,
        "wires": []
    },
    {
        "id": "b73d117192e42809",
        "type": "debug",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 1000,
        "wires": []
    },
    {
        "id": "db70af4f273bfc97",
        "type": "comment",
        "z": "043c9b21da5cbba8",
        "g": "a2a5c6556a04c7ed",
        "name": "smartlights simulation",
        "info": "",
        "x": 260,
        "y": 700,
        "wires": []
    },
    {
        "id": "d9daa6e7df2953bb",
        "type": "ui_switch",
        "z": "043c9b21da5cbba8",
        "g": "e49647927e3b9d1e",
        "name": "Door Lock Switch",
        "label": "Lock Door",
        "tooltip": "",
        "group": "",
        "order": 1,
        "width": 3,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 250,
        "y": 1180,
        "wires": [
            [
                "a87e8394d9f25e8c"
            ]
        ]
    },
    {
        "id": "a87e8394d9f25e8c",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "e49647927e3b9d1e",
        "name": "Format DoorLock Payload",
        "func": "msg.payload = { locked: msg.payload };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1180,
        "wires": [
            [
                "fb30e09493d3f725"
            ]
        ]
    },
    {
        "id": "fb30e09493d3f725",
        "type": "async-api-red",
        "z": "043c9b21da5cbba8",
        "g": "e49647927e3b9d1e",
        "name": "SmartDoor Lock ",
        "x": 760,
        "y": 1120,
        "wires": [
            [
                "b6b89773a30b7a33",
                "83982045fbc9296b"
            ]
        ]
    },
    {
        "id": "83982045fbc9296b",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "e49647927e3b9d1e",
        "name": "Update Dashboard Status",
        "func": "msg.payload = msg.payload.locked ? \"Locked\" : \"Unlocked\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1070,
        "y": 1200,
        "wires": [
            [
                "0fb2875d235f6c99"
            ]
        ]
    },
    {
        "id": "0fb2875d235f6c99",
        "type": "ui_text",
        "z": "043c9b21da5cbba8",
        "g": "e49647927e3b9d1e",
        "group": "",
        "order": 2,
        "width": 3,
        "height": 1,
        "name": "Lock Status Text",
        "label": "Door Status",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 1360,
        "y": 1200,
        "wires": []
    },
    {
        "id": "b6b89773a30b7a33",
        "type": "debug",
        "z": "043c9b21da5cbba8",
        "g": "e49647927e3b9d1e",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1180,
        "y": 1120,
        "wires": []
    },
    {
        "id": "f50a98b0aabb9eac",
        "type": "comment",
        "z": "043c9b21da5cbba8",
        "g": "e49647927e3b9d1e",
        "name": "Smartdoor",
        "info": "",
        "x": 220,
        "y": 1120,
        "wires": []
    },
    {
        "id": "efee14a4a88be124",
        "type": "comment",
        "z": "043c9b21da5cbba8",
        "g": "1a95f1f2d410aea3",
        "name": "cofee machine simulator",
        "info": "",
        "x": 270,
        "y": 1340,
        "wires": []
    },
    {
        "id": "c12f4c5b3b6032a4",
        "type": "function",
        "z": "043c9b21da5cbba8",
        "g": "1a95f1f2d410aea3",
        "name": "Format Coffee Payload",
        "func": "msg.payload = {\n  strength: msg.payload.strength,\n  size: msg.payload.size\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 810,
        "y": 1440,
        "wires": [
            [
                "a8097aa9ba390408"
            ]
        ]
    },
    {
        "id": "1855218a50989a4b",
        "type": "join",
        "z": "043c9b21da5cbba8",
        "g": "1a95f1f2d410aea3",
        "name": "Join Strength & Size",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": true,
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 520,
        "y": 1440,
        "wires": [
            [
                "c12f4c5b3b6032a4"
            ]
        ]
    },
    {
        "id": "9b2e7830db9edc47",
        "type": "debug",
        "z": "043c9b21da5cbba8",
        "g": "1a95f1f2d410aea3",
        "name": "Debug Coffee Payload",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 1260,
        "y": 1380,
        "wires": []
    },
    {
        "id": "a8097aa9ba390408",
        "type": "async-api-red",
        "z": "043c9b21da5cbba8",
        "g": "1a95f1f2d410aea3",
        "name": "SmartDoor Lock ",
        "x": 1040,
        "y": 1440,
        "wires": [
            [
                "9b2e7830db9edc47",
                "9e910b904fa61a23"
            ]
        ]
    },
    {
        "id": "cd4279d372ca3068",
        "type": "ui_dropdown",
        "z": "043c9b21da5cbba8",
        "g": "1a95f1f2d410aea3",
        "name": "Select Size",
        "label": "Coffee Size",
        "tooltip": "",
        "place": "",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Small",
                "value": "small",
                "type": "str"
            },
            {
                "label": "Medium",
                "value": "medium",
                "type": "str"
            },
            {
                "label": "Large",
                "value": "large",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "size",
        "topicType": "str",
        "className": "",
        "x": 270,
        "y": 1480,
        "wires": [
            [
                "1855218a50989a4b"
            ]
        ]
    },
    {
        "id": "921bcc21c54deadc",
        "type": "ui_dropdown",
        "z": "043c9b21da5cbba8",
        "g": "1a95f1f2d410aea3",
        "name": "Select Strength",
        "label": "Coffee Strength",
        "tooltip": "",
        "place": "",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Light",
                "value": "light",
                "type": "str"
            },
            {
                "label": "Medium",
                "value": "medium",
                "type": "str"
            },
            {
                "label": "Strong",
                "value": "strong",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "strength",
        "topicType": "str",
        "className": "",
        "x": 260,
        "y": 1420,
        "wires": [
            [
                "1855218a50989a4b"
            ]
        ]
    },
    {
        "id": "9e910b904fa61a23",
        "type": "ui_text",
        "z": "043c9b21da5cbba8",
        "g": "1a95f1f2d410aea3",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "Order Status",
        "label": "Coffee Order",
        "format": "{{msg.payload.strength}} / {{msg.payload.size}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1270,
        "y": 1460,
        "wires": []
    },
    {
        "id": "f1b4a93aa4e5e122",
        "type": "function",
        "z": "subflow-thermostat-logic",
        "name": "Compare Temps",
        "func": "const desired = msg.desired || 22;\nconst current = msg.payload.current;\nlet state = \"IDLE\";\n\nif (current < desired - 1) state = \"HEATING\";\nelse if (current > desired + 1) state = \"COOLING\";\n\nmsg.payload = {\n    current,\n    desired,\n    state\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "a9c603099da1e03f",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1990,
        "y": 980,
        "wires": [
            [
                "cda627aaa496a0a6"
            ]
        ]
    },
    {
        "id": "cda627aaa496a0a6",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Total Energy Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2230,
        "y": 920,
        "wires": []
    },
    {
        "id": "b52bab263572c522",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "895c7c19f3f0551f",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 520,
        "wires": [
            [
                "a7e703d573ec4166"
            ]
        ]
    },
    {
        "id": "a7e703d573ec4166",
        "type": "async-api-red",
        "z": "subflow_smarthome",
        "g": "895c7c19f3f0551f",
        "name": "AC AsyncAPI",
        "x": 1070,
        "y": 520,
        "wires": [
            [
                "be13e5e3c979d9d4",
                "a9c603099da1e03f",
                "120aa6a9def4bbc7"
            ]
        ]
    },
    {
        "id": "be13e5e3c979d9d4",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "895c7c19f3f0551f",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1310,
        "y": 540,
        "wires": []
    },
    {
        "id": "c4556b999b1208b3",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "5a57beeed82dc92a",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 720,
        "wires": [
            [
                "8ec7e2a91468892d"
            ]
        ]
    },
    {
        "id": "8ec7e2a91468892d",
        "type": "async-api-red",
        "z": "subflow_smarthome",
        "g": "5a57beeed82dc92a",
        "name": "Lights AsyncAPI",
        "x": 1080,
        "y": 720,
        "wires": [
            [
                "8fd588cc37f51938",
                "a9c603099da1e03f",
                "120aa6a9def4bbc7"
            ]
        ]
    },
    {
        "id": "8fd588cc37f51938",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "5a57beeed82dc92a",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1310,
        "y": 720,
        "wires": []
    },
    {
        "id": "42d23aa09585e358",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "4afe9ba8425f8677",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 920,
        "wires": [
            [
                "7cafd92c117fdeb9"
            ]
        ]
    },
    {
        "id": "7cafd92c117fdeb9",
        "type": "async-api-red",
        "z": "subflow_smarthome",
        "g": "4afe9ba8425f8677",
        "name": "Fridge AsyncAPI",
        "x": 1080,
        "y": 920,
        "wires": [
            [
                "f80ff6508ddb19de",
                "a9c603099da1e03f",
                "120aa6a9def4bbc7"
            ]
        ]
    },
    {
        "id": "f80ff6508ddb19de",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "4afe9ba8425f8677",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1340,
        "y": 920,
        "wires": []
    },
    {
        "id": "961faabd99242abd",
        "type": "async-api-red",
        "z": "subflow_smarthome",
        "g": "c22e79154c621f48",
        "name": "Launder AsyncAPI",
        "x": 1070,
        "y": 1120,
        "wires": [
            [
                "e35afa18d1e470d5",
                "a9c603099da1e03f",
                "120aa6a9def4bbc7"
            ]
        ]
    },
    {
        "id": "e35afa18d1e470d5",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "c22e79154c621f48",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1340,
        "y": 1140,
        "wires": []
    },
    {
        "id": "262e6e90e095796a",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "c22e79154c621f48",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 1120,
        "wires": [
            [
                "961faabd99242abd"
            ]
        ]
    },
    {
        "id": "05dccd85d26e3e30",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "f7cd6fc6dc26feb6",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 1340,
        "wires": [
            [
                "bdc58d437bf02284"
            ]
        ]
    },
    {
        "id": "bdc58d437bf02284",
        "type": "async-api-red",
        "z": "subflow_smarthome",
        "g": "f7cd6fc6dc26feb6",
        "name": "Dehumidifier AsyncAPI",
        "x": 1090,
        "y": 1340,
        "wires": [
            [
                "46f0faaa609bbdbc",
                "a9c603099da1e03f",
                "120aa6a9def4bbc7"
            ]
        ]
    },
    {
        "id": "46f0faaa609bbdbc",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "f7cd6fc6dc26feb6",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1400,
        "y": 1320,
        "wires": []
    },
    {
        "id": "628686b941d4090b",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "f5fdf02df3e4db07",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1520,
        "wires": [
            [
                "013b60a3ce1b1613"
            ]
        ]
    },
    {
        "id": "013b60a3ce1b1613",
        "type": "async-api-red",
        "z": "subflow_smarthome",
        "g": "f5fdf02df3e4db07",
        "name": "Cooker AsyncAPI",
        "x": 1080,
        "y": 1520,
        "wires": [
            [
                "8c3c0e07bff92b9c",
                "a9c603099da1e03f",
                "120aa6a9def4bbc7"
            ]
        ]
    },
    {
        "id": "8c3c0e07bff92b9c",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "f5fdf02df3e4db07",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1340,
        "y": 1520,
        "wires": []
    },
    {
        "id": "82413aa57e18a3ad",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "4ac7585640aa85e7",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1470,
        "y": 300,
        "wires": []
    },
    {
        "id": "19740f6dd834257d",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "4ac7585640aa85e7",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = 24;\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 320,
        "wires": [
            [
                "ab453755ab2ab8e2"
            ]
        ]
    },
    {
        "id": "ab453755ab2ab8e2",
        "type": "async-api-red",
        "z": "subflow_smarthome",
        "g": "4ac7585640aa85e7",
        "name": " Thermostat AsyncAPI",
        "x": 1180,
        "y": 320,
        "wires": [
            [
                "82413aa57e18a3ad",
                "a9c603099da1e03f",
                "120aa6a9def4bbc7"
            ]
        ]
    },
    {
        "id": "50ea0a25ce1a6cf2",
        "type": "comment",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "SMARTHOME",
        "info": "",
        "x": 140,
        "y": 140,
        "wires": []
    },
    {
        "id": "398f82e683f32eac",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Environment Generator",
        "func": "// --- Simulation Scale ---\n// Only set once (if not already set)\nif (!global.get(\"simulationScale\")) {\n    global.set(\"simulationScale\", 60);\n    // 1s = 1 minute\n    // change to 3600 for 1s = 1 hour\n}\n\n// --- Environment State ---\nconst desired = flow.get('desired_temp') || 22;\nlet current = flow.get('current_temp') || (desired + (Math.random() * 4 - 2));\n\n// Random drift\ncurrent += (Math.random() * 1 - 0.5);\n\n// Calculate humidity\nlet humidity = 40 + Math.floor(Math.random() * 20);\n\n// Simulate room light intensity (0 = dark, 100 = very bright)\nlet lightIntensity = Math.floor(Math.random() * 101);\n\n// Save globally for all devices\nflow.set('env.temperature', current);\nflow.set('env.humidity', humidity);\nflow.set('env.lightIntensity', lightIntensity);\nflow.set('current_temp', current);\n\n// Output payload\nmsg.payload = {\n    environment: true,\n    temperature: current.toFixed(1),\n    humidity: humidity,\n    lightIntensity: lightIntensity,\n    unit: \"C\",\n    simulationScale: global.get(\"simulationScale\") // include scale for visibility\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 640,
        "wires": [
            [
                "19740f6dd834257d",
                "b52bab263572c522",
                "c4556b999b1208b3",
                "42d23aa09585e358",
                "262e6e90e095796a",
                "05dccd85d26e3e30",
                "628686b941d4090b",
                "99bfcadd3a7ad7f7"
            ]
        ]
    },
    {
        "id": "e797385e830437c1",
        "type": "inject",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Sim Clock Trigger",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": "0.1",
        "topic": "",
        "x": 150,
        "y": 680,
        "wires": [
            [
                "398f82e683f32eac"
            ]
        ]
    },
    {
        "id": "b286887c3781c24d",
        "type": "ui_template",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 2120,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "120aa6a9def4bbc7",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1970,
        "y": 600,
        "wires": [
            [
                "b286887c3781c24d",
                "2e6836af4c8a6447"
            ]
        ]
    },
    {
        "id": "2e6836af4c8a6447",
        "type": "debug",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Merged payloads",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2150,
        "y": 500,
        "wires": []
    },
    {
        "id": "99bfcadd3a7ad7f7",
        "type": "function",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Route Env Data",
        "func": "// Split Environment Generator data\nconst out = [];\n\nif (msg.payload.environment) {\n    out.push({ topic: \"temperature\", payload: Number(msg.payload.temperature) });\n    out.push({ topic: \"humidity\", payload: Number(msg.payload.humidity) });\n    out.push({ topic: \"light\", payload: Number(msg.payload.lightIntensity) });\n}\n\nreturn [out];",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 900,
        "wires": [
            [
                "2b7cb5b81308fd7d",
                "5392cb0f65e931be",
                "d57ddce80dd36ece",
                "b0adece6f42f3e45"
            ]
        ]
    },
    {
        "id": "2b7cb5b81308fd7d",
        "type": "ui_chart",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Temperature Chart",
        "group": "8c896da163d208f1",
        "order": 1,
        "width": "6",
        "height": 4,
        "label": "Temperature (C)",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "Waiting for data...",
        "dot": false,
        "ymin": "15",
        "ymax": "35",
        "removeOlder": "1",
        "removeOlderPoints": "100",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#ff7f0e",
            "#1f77b4",
            "#2ca02c",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 490,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "5392cb0f65e931be",
        "type": "ui_gauge",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Temperature Gauge",
        "group": "env_group",
        "order": 2,
        "width": 6,
        "height": 4,
        "gtype": "gage",
        "title": "Temperature",
        "label": "C",
        "format": "{{value}}",
        "min": "0",
        "max": "40",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 500,
        "y": 900,
        "wires": []
    },
    {
        "id": "d57ddce80dd36ece",
        "type": "ui_gauge",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Humidity Gauge",
        "group": "env_group",
        "order": 3,
        "width": 6,
        "height": 4,
        "gtype": "gage",
        "title": "Humidity",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b5e9",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 500,
        "y": 960,
        "wires": []
    },
    {
        "id": "b0adece6f42f3e45",
        "type": "ui_slider",
        "z": "subflow_smarthome",
        "g": "e4a1e5e130e19d38",
        "name": "Light Intensity",
        "label": "Light Intensity",
        "group": "env_group",
        "order": 4,
        "width": 12,
        "height": 1,
        "passthru": true,
        "outs": "all",
        "topic": "",
        "min": "0",
        "max": "100",
        "step": 1,
        "x": 490,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "c73637d98e05e80e",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2270,
        "y": 1000,
        "wires": [
            [
                "cbee460370ecb3f8"
            ]
        ]
    },
    {
        "id": "cbee460370ecb3f8",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Total Energy Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2510,
        "y": 940,
        "wires": []
    },
    {
        "id": "9c27d852120b7dca",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "30df11e17a49e28b",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 540,
        "wires": [
            [
                "d06e351e37ac7bb6"
            ]
        ]
    },
    {
        "id": "d06e351e37ac7bb6",
        "type": "async-api-red",
        "z": "7ecc82fdd5fcacdb",
        "g": "30df11e17a49e28b",
        "name": "AC AsyncAPI",
        "x": 1350,
        "y": 540,
        "wires": [
            [
                "1bc270fcb0f4a60e",
                "c73637d98e05e80e",
                "8a7ff196473cf82f"
            ]
        ]
    },
    {
        "id": "1bc270fcb0f4a60e",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "30df11e17a49e28b",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1590,
        "y": 560,
        "wires": []
    },
    {
        "id": "a77332e4e594898f",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "11d91ae28562cdca",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 740,
        "wires": [
            [
                "7e3f0de7bd3f9c40"
            ]
        ]
    },
    {
        "id": "7e3f0de7bd3f9c40",
        "type": "async-api-red",
        "z": "7ecc82fdd5fcacdb",
        "g": "11d91ae28562cdca",
        "name": "Lights AsyncAPI",
        "x": 1360,
        "y": 740,
        "wires": [
            [
                "fa9fa00ea88688f3",
                "c73637d98e05e80e",
                "8a7ff196473cf82f"
            ]
        ]
    },
    {
        "id": "fa9fa00ea88688f3",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "11d91ae28562cdca",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1590,
        "y": 740,
        "wires": []
    },
    {
        "id": "6fc0b7f5e8f6f9f9",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "3cd4dba2d47ed535",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 940,
        "wires": [
            [
                "c56ca9ce7a363f13"
            ]
        ]
    },
    {
        "id": "c56ca9ce7a363f13",
        "type": "async-api-red",
        "z": "7ecc82fdd5fcacdb",
        "g": "3cd4dba2d47ed535",
        "name": "Fridge AsyncAPI",
        "x": 1360,
        "y": 940,
        "wires": [
            [
                "8de414979fd14e22",
                "c73637d98e05e80e",
                "8a7ff196473cf82f"
            ]
        ]
    },
    {
        "id": "8de414979fd14e22",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "3cd4dba2d47ed535",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1620,
        "y": 940,
        "wires": []
    },
    {
        "id": "80fd24d3cd148573",
        "type": "async-api-red",
        "z": "7ecc82fdd5fcacdb",
        "g": "e3185234fdbed879",
        "name": "Launder AsyncAPI",
        "x": 1350,
        "y": 1140,
        "wires": [
            [
                "db7b0582888824c4",
                "c73637d98e05e80e",
                "8a7ff196473cf82f"
            ]
        ]
    },
    {
        "id": "db7b0582888824c4",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "e3185234fdbed879",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1620,
        "y": 1160,
        "wires": []
    },
    {
        "id": "49af89a3f9808103",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "e3185234fdbed879",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 1140,
        "wires": [
            [
                "80fd24d3cd148573"
            ]
        ]
    },
    {
        "id": "792098efbd9ededb",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "37227888554b698a",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 1360,
        "wires": [
            [
                "8fc22c9d5addaedc"
            ]
        ]
    },
    {
        "id": "8fc22c9d5addaedc",
        "type": "async-api-red",
        "z": "7ecc82fdd5fcacdb",
        "g": "37227888554b698a",
        "name": "Dehumidifier AsyncAPI",
        "x": 1370,
        "y": 1360,
        "wires": [
            [
                "5e5d6d6a1e0281a5",
                "c73637d98e05e80e",
                "8a7ff196473cf82f"
            ]
        ]
    },
    {
        "id": "5e5d6d6a1e0281a5",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "37227888554b698a",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1680,
        "y": 1340,
        "wires": []
    },
    {
        "id": "f6d2febb9468a103",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "12a36cdccd5ed9f8",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 1540,
        "wires": [
            [
                "99b158b91d7bbe1d"
            ]
        ]
    },
    {
        "id": "99b158b91d7bbe1d",
        "type": "async-api-red",
        "z": "7ecc82fdd5fcacdb",
        "g": "12a36cdccd5ed9f8",
        "name": "Cooker AsyncAPI",
        "x": 1360,
        "y": 1540,
        "wires": [
            [
                "f2a482331f276baa",
                "c73637d98e05e80e",
                "8a7ff196473cf82f"
            ]
        ]
    },
    {
        "id": "f2a482331f276baa",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "12a36cdccd5ed9f8",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1620,
        "y": 1540,
        "wires": []
    },
    {
        "id": "e0db9ffe797a141e",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "7d5c52aa5ac682d2",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1750,
        "y": 320,
        "wires": []
    },
    {
        "id": "788d9c42c03be73c",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "7d5c52aa5ac682d2",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = 24;\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 340,
        "wires": [
            [
                "8c75489cbd6fbf08"
            ]
        ]
    },
    {
        "id": "8c75489cbd6fbf08",
        "type": "async-api-red",
        "z": "7ecc82fdd5fcacdb",
        "g": "7d5c52aa5ac682d2",
        "name": " Thermostat AsyncAPI",
        "x": 1460,
        "y": 340,
        "wires": [
            [
                "e0db9ffe797a141e",
                "c73637d98e05e80e",
                "8a7ff196473cf82f"
            ]
        ]
    },
    {
        "id": "a81d83c8e5e451b8",
        "type": "comment",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "SMARTHOME",
        "info": "",
        "x": 420,
        "y": 160,
        "wires": []
    },
    {
        "id": "3c917e3eeb92eecf",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Environment Generator",
        "func": "// --- Simulation Scale ---\n// Only set once (if not already set)\nif (!global.get(\"simulationScale\")) {\n    global.set(\"simulationScale\", 60);\n    // 1s = 1 minute\n    // change to 3600 for 1s = 1 hour\n}\n\n// --- Environment State ---\nconst desired = flow.get('desired_temp') || 22;\nlet current = flow.get('current_temp') || (desired + (Math.random() * 4 - 2));\n\n// Random drift\ncurrent += (Math.random() * 1 - 0.5);\n\n// Calculate humidity\nlet humidity = 40 + Math.floor(Math.random() * 20);\n\n// Simulate room light intensity (0 = dark, 100 = very bright)\nlet lightIntensity = Math.floor(Math.random() * 101);\n\n// Save globally for all devices\nflow.set('env.temperature', current);\nflow.set('env.humidity', humidity);\nflow.set('env.lightIntensity', lightIntensity);\nflow.set('current_temp', current);\n\n// Output payload\nmsg.payload = {\n    environment: true,\n    temperature: current.toFixed(1),\n    humidity: humidity,\n    lightIntensity: lightIntensity,\n    unit: \"C\",\n    simulationScale: global.get(\"simulationScale\") // include scale for visibility\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 660,
        "wires": [
            [
                "788d9c42c03be73c",
                "9c27d852120b7dca",
                "a77332e4e594898f",
                "6fc0b7f5e8f6f9f9",
                "49af89a3f9808103",
                "792098efbd9ededb",
                "f6d2febb9468a103",
                "e5aad1750982bf58"
            ]
        ]
    },
    {
        "id": "a1714f7d84f7249a",
        "type": "inject",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Sim Clock Trigger",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": "0.1",
        "topic": "",
        "x": 430,
        "y": 700,
        "wires": [
            [
                "3c917e3eeb92eecf"
            ]
        ]
    },
    {
        "id": "761fbf79bc5a0b6a",
        "type": "ui_template",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 2400,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "8a7ff196473cf82f",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2250,
        "y": 620,
        "wires": [
            [
                "761fbf79bc5a0b6a",
                "eee9708f5b5b3d60"
            ]
        ]
    },
    {
        "id": "eee9708f5b5b3d60",
        "type": "debug",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Merged payloads",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2430,
        "y": 520,
        "wires": []
    },
    {
        "id": "e5aad1750982bf58",
        "type": "function",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Route Env Data",
        "func": "// Split Environment Generator data\nconst out = [];\n\nif (msg.payload.environment) {\n    out.push({ topic: \"temperature\", payload: Number(msg.payload.temperature) });\n    out.push({ topic: \"humidity\", payload: Number(msg.payload.humidity) });\n    out.push({ topic: \"light\", payload: Number(msg.payload.lightIntensity) });\n}\n\nreturn [out];",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 920,
        "wires": [
            [
                "f8b4241ac415ab1f",
                "8ec75af908428eac",
                "3842878445c54be5",
                "db540a36c0cf8246"
            ]
        ]
    },
    {
        "id": "f8b4241ac415ab1f",
        "type": "ui_chart",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Temperature Chart",
        "group": "8c896da163d208f1",
        "order": 1,
        "width": "6",
        "height": 4,
        "label": "Temperature (C)",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "Waiting for data...",
        "dot": false,
        "ymin": "15",
        "ymax": "35",
        "removeOlder": "1",
        "removeOlderPoints": "100",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#ff7f0e",
            "#1f77b4",
            "#2ca02c",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 770,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "8ec75af908428eac",
        "type": "ui_gauge",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Temperature Gauge",
        "group": "env_group",
        "order": 2,
        "width": 6,
        "height": 4,
        "gtype": "gage",
        "title": "Temperature",
        "label": "C",
        "format": "{{value}}",
        "min": "0",
        "max": "40",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 780,
        "y": 920,
        "wires": []
    },
    {
        "id": "3842878445c54be5",
        "type": "ui_gauge",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Humidity Gauge",
        "group": "env_group",
        "order": 3,
        "width": 6,
        "height": 4,
        "gtype": "gage",
        "title": "Humidity",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b5e9",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 780,
        "y": 980,
        "wires": []
    },
    {
        "id": "db540a36c0cf8246",
        "type": "ui_slider",
        "z": "7ecc82fdd5fcacdb",
        "g": "85b30d2997a48dee",
        "name": "Light Intensity",
        "label": "Light Intensity",
        "group": "env_group",
        "order": 4,
        "width": 12,
        "height": 1,
        "passthru": true,
        "outs": "all",
        "topic": "",
        "min": "0",
        "max": "100",
        "step": 1,
        "x": 770,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "a683470f9f9d2be2",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "success",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 180,
        "wires": []
    },
    {
        "id": "fd241870fe8e402a",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "",
        "configUrlNode": "4e8e4d5957412be2",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "url": false,
            "urlNotRead": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "body body": {
                "name": "body",
                "isActive": true,
                "activeFilter": "",
                "required": true,
                "type": "editor:body",
                "collapsed": false,
                "parameters": {
                    "id": {
                        "name": "id",
                        "isActive": true,
                        "activeFilter": "",
                        "type": "msg",
                        "collapsed": false,
                        "value": "payload.body.id"
                    },
                    "category": {
                        "name": "category",
                        "activeFilter": "",
                        "type": "editor:Category",
                        "parameters": {
                            "id": {
                                "name": "id",
                                "activeFilter": ""
                            },
                            "name": {
                                "name": "name",
                                "activeFilter": ""
                            }
                        }
                    },
                    "name": {
                        "name": "name",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "msg",
                        "value": "payload.body.name"
                    },
                    "photoUrls": {
                        "name": "photoUrls",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "msg",
                        "value": "payload.body.photoUrls"
                    },
                    "tags": {
                        "name": "tags",
                        "activeFilter": ""
                    },
                    "status": {
                        "name": "status",
                        "activeFilter": ""
                    }
                },
                "in": "body"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 2,
        "responseOutputLabels": [
            {
                "code": "successful",
                "text": "all successful responses (2xx)"
            },
            {
                "code": "405",
                "text": "Invalid input"
            }
        ],
        "responseAsPayload": false,
        "debugMode": "",
        "headers": [
            {
                "key": "Affe",
                "valueType": "str",
                "value": "Elefant"
            }
        ],
        "_version": "2.2.0",
        "x": 360,
        "y": 200,
        "wires": [
            [
                "a683470f9f9d2be2"
            ],
            [
                "c8b83ed3e66303c2"
            ]
        ]
    },
    {
        "id": "bfb6d9bfe0c540fc",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1200,
        "y": 720,
        "wires": [
            [
                "3323c6018c67090b"
            ]
        ]
    },
    {
        "id": "743761d0ea53bc31",
        "type": "switch",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "check msg.response.ok",
        "property": "payload.ok",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1630,
        "y": 720,
        "wires": [
            [
                "7292a72a4b6230c9"
            ],
            [
                "d7f5f6ed015725be"
            ]
        ]
    },
    {
        "id": "7292a72a4b6230c9",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "ok",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1830,
        "y": 700,
        "wires": []
    },
    {
        "id": "d7f5f6ed015725be",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1830,
        "y": 740,
        "wires": []
    },
    {
        "id": "8708fbbaf99494f4",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "Standard",
        "info": "",
        "x": 1200,
        "y": 680,
        "wires": []
    },
    {
        "id": "eb7c8264bfd927b1",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1200,
        "y": 820,
        "wires": [
            [
                "7cdf47e943d3721a"
            ]
        ]
    },
    {
        "id": "fb837ec50d0e5ff5",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "ok",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1570,
        "y": 800,
        "wires": []
    },
    {
        "id": "e590371eec36462b",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1570,
        "y": 840,
        "wires": []
    },
    {
        "id": "b6a518cae0ed236e",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "Other output",
        "info": "",
        "x": 1210,
        "y": 780,
        "wires": []
    },
    {
        "id": "d148bc258eb112ca",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1200,
        "y": 940,
        "wires": [
            [
                "67e82cdae3014568"
            ]
        ]
    },
    {
        "id": "a8b3b1803a943f5d",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "ok",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1570,
        "y": 940,
        "wires": []
    },
    {
        "id": "2e21f69b42218552",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "Throw exception",
        "info": "",
        "x": 1220,
        "y": 900,
        "wires": []
    },
    {
        "id": "714e3635c401250f",
        "type": "catch",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "",
        "scope": [
            "67e82cdae3014568"
        ],
        "uncaught": false,
        "x": 1370,
        "y": 980,
        "wires": [
            [
                "f86103930fc1fd85"
            ]
        ]
    },
    {
        "id": "f86103930fc1fd85",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "x": 1570,
        "y": 980,
        "wires": []
    },
    {
        "id": "3323c6018c67090b",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "set an error",
        "configUrlNode": "4e8e4d5957412be2",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "classic",
        "errorHandling": "default",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "urlNotRead": false,
            "url": false,
            "source": ""
        },
        "parameters": {
            "body body": {
                "name": "body",
                "isActive": true,
                "required": true,
                "type": "json",
                "value": "{\"name\":\"bad cat\",\"photoUrls\":\"not an array\"}",
                "in": "body"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "successful",
                "text": "all successful responses (2xx)"
            }
        ],
        "responseAsPayload": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 1390,
        "y": 720,
        "wires": [
            [
                "743761d0ea53bc31"
            ]
        ]
    },
    {
        "id": "60072a460f71141f",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "Classic error handling",
        "info": "",
        "x": 1240,
        "y": 620,
        "wires": []
    },
    {
        "id": "a88e075f0ee05109",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "pet shop swagger example",
        "info": "\n",
        "x": 210,
        "y": 160,
        "wires": []
    },
    {
        "id": "7cdf47e943d3721a",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "set an error",
        "configUrlNode": "4e8e4d5957412be2",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "classic",
        "errorHandling": "other output",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "urlNotRead": false,
            "url": false,
            "source": ""
        },
        "parameters": {
            "body body": {
                "name": "body",
                "isActive": true,
                "required": true,
                "type": "json",
                "value": "{\"name\":\"bad cat\",\"photoUrls\":\"Not an array\"}",
                "in": "body"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 2,
        "responseOutputLabels": [
            {
                "code": "all",
                "text": "all responses"
            },
            {
                "code": "undefinedResponses",
                "text": "all undefined responses"
            }
        ],
        "responseAsPayload": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 1390,
        "y": 820,
        "wires": [
            [
                "fb837ec50d0e5ff5"
            ],
            [
                "e590371eec36462b"
            ]
        ]
    },
    {
        "id": "67e82cdae3014568",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "2785aa7402e0c422",
        "name": "set an error",
        "configUrlNode": "4e8e4d5957412be2",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "classic",
        "errorHandling": "throw exception",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "urlNotRead": false,
            "url": false,
            "source": ""
        },
        "parameters": {
            "body body": {
                "name": "body",
                "isActive": true,
                "required": true,
                "type": "json",
                "value": "{\"name\": \"bad cat\", \"photoUrls\": \"Not an array\"  }",
                "in": "body"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "all",
                "text": "all responses"
            }
        ],
        "responseAsPayload": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 1390,
        "y": 940,
        "wires": [
            [
                "a8b3b1803a943f5d"
            ]
        ]
    },
    {
        "id": "f13e6ce1a71fb95e",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "add pet 66",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "test",
                "v": "hund",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 520,
        "wires": [
            [
                "d2c25c70ca021b0e"
            ]
        ]
    },
    {
        "id": "e5fe633619ed6e0a",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "success",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 500,
        "wires": []
    },
    {
        "id": "d2c25c70ca021b0e",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "add pet",
        "configUrlNode": "4fc15b76b4d55d7d",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "url": false,
            "urlNotRead": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "activeFilter": "",
                "type": "json",
                "value": "{\n    \"id\": \"66\",\n    \"name\": \"Krawallnudel Lilli\",\n    \"category\": {},\n    \"photoUrls\": [],\n    \"tags\": [],\n    \"status\": \"available\"\n}",
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 4,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "Successful operation"
            },
            {
                "code": "400",
                "text": "Invalid input"
            },
            {
                "code": "422",
                "text": "Validation exception"
            },
            {
                "code": "default",
                "text": "Unexpected error"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [
            {
                "key": "abc",
                "valueType": "msg",
                "value": "test"
            }
        ],
        "_version": "2.2.0",
        "x": 360,
        "y": 520,
        "wires": [
            [
                "e5fe633619ed6e0a"
            ],
            [
                "4a87ce22e00f3efa"
            ],
            [],
            []
        ]
    },
    {
        "id": "d9b0d7fcf676d77f",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "pet shop openApi 3 example",
        "info": "",
        "x": 220,
        "y": 480,
        "wires": []
    },
    {
        "id": "ea87fde3734d5f09",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 1020,
        "wires": [
            [
                "21f13b66e154f470"
            ]
        ]
    },
    {
        "id": "4a34670d715fd56d",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "success",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 1000,
        "wires": []
    },
    {
        "id": "21f13b66e154f470",
        "type": "file in",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "",
        "filename": "./examples/dog.jpg",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 370,
        "y": 1020,
        "wires": [
            [
                "852ef3b902872cf8"
            ]
        ]
    },
    {
        "id": "852ef3b902872cf8",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "",
        "configUrlNode": "4fc15b76b4d55d7d",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "uploadFile",
            "hasOperationId": true,
            "path": "/pet/{petId}/uploadImage",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "other output",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "urlNotRead": false,
            "url": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "isActive": true,
                "activeFilter": "",
                "type": "msg",
                "value": "payload"
            },
            "petId path": {
                "name": "petId",
                "isActive": true,
                "activeFilter": "",
                "required": true,
                "type": "num",
                "value": "66",
                "in": "path"
            },
            "additionalMetadata query": {
                "name": "additionalMetadata",
                "activeFilter": "",
                "type": "str",
                "value": "",
                "in": "query"
            }
        },
        "requestContentType": "application/octet-stream",
        "responseContentType": "application/json",
        "outputs": 5,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "successful operation"
            },
            {
                "code": "400",
                "text": "No file uploaded"
            },
            {
                "code": "404",
                "text": "Pet not found"
            },
            {
                "code": "default",
                "text": "Unexpected error"
            },
            {
                "code": "undefinedResponses",
                "text": "all undefined responses"
            }
        ],
        "responseAsPayload": true,
        "debugMode": "",
        "headers": [],
        "_version": "2.2.0",
        "x": 570,
        "y": 1020,
        "wires": [
            [
                "4a34670d715fd56d"
            ],
            [
                "fe01a9e33899abda"
            ],
            [],
            [],
            []
        ]
    },
    {
        "id": "6d87958f749b4d65",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "set a path to an existing file",
        "info": "",
        "x": 390,
        "y": 980,
        "wires": []
    },
    {
        "id": "c8b83ed3e66303c2",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 405",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 220,
        "wires": []
    },
    {
        "id": "fb0068a4371ff253",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "set payload",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{ \"id\": 451,  \"name\": \"Benny Superstar\", \"photoUrl\": [] }",
        "payloadType": "json",
        "x": 1210,
        "y": 140,
        "wires": [
            [
                "9d2350b1eee037db"
            ]
        ]
    },
    {
        "id": "2810755f89def0ab",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1570,
        "y": 140,
        "wires": []
    },
    {
        "id": "9d2350b1eee037db",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "configUrlNode": "4e8e4d5957412be2",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "classic",
        "errorHandling": "throw exception",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "url": false,
            "urlNotRead": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "body body": {
                "name": "body",
                "isActive": true,
                "activeFilter": "",
                "required": true,
                "type": "editor:body",
                "collapsed": false,
                "parameters": {
                    "id": {
                        "name": "id",
                        "isActive": true,
                        "activeFilter": "",
                        "type": "msg",
                        "value": "payload.id"
                    },
                    "category": {
                        "name": "category",
                        "activeFilter": "",
                        "type": "editor:Category",
                        "parameters": {
                            "id": {
                                "name": "id",
                                "activeFilter": "",
                                "type": "msg",
                                "value": "payload.category.id"
                            },
                            "name": {
                                "name": "name",
                                "activeFilter": "",
                                "type": "msg",
                                "value": "payload.category.name"
                            }
                        }
                    },
                    "name": {
                        "name": "name",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "msg",
                        "value": "payload.name"
                    },
                    "photoUrls": {
                        "name": "photoUrls",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "json",
                        "value": "[]"
                    },
                    "tags": {
                        "name": "tags",
                        "activeFilter": "",
                        "type": "json",
                        "value": "true"
                    },
                    "status": {
                        "name": "status",
                        "activeFilter": "",
                        "type": "msg",
                        "value": "payload.status"
                    }
                },
                "in": "body"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "all",
                "text": "all responses"
            }
        ],
        "responseAsPayload": false,
        "debugMode": "",
        "headers": [],
        "_version": "2.2.0",
        "x": 1380,
        "y": 140,
        "wires": [
            [
                "2810755f89def0ab"
            ]
        ]
    },
    {
        "id": "75126d56d71e3c3c",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "pet shop swagger example (classic)",
        "info": "",
        "x": 1280,
        "y": 100,
        "wires": []
    },
    {
        "id": "facfb133068f19c4",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1200,
        "y": 360,
        "wires": [
            [
                "84f43a190c420cc0"
            ]
        ]
    },
    {
        "id": "cfb1e29cc9832121",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1590,
        "y": 360,
        "wires": []
    },
    {
        "id": "12d7924ce265af7b",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 1200,
        "y": 420,
        "wires": [
            [
                "11c835bfe0e324a3"
            ]
        ]
    },
    {
        "id": "8c42edd3ad8f483f",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1590,
        "y": 420,
        "wires": []
    },
    {
        "id": "11c835bfe0e324a3",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "configUrlNode": "4fc15b76b4d55d7d",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "getPetById",
            "hasOperationId": true,
            "path": "/pet/{petId}",
            "method": "get"
        },
        "outputStyle": "classic",
        "errorHandling": "default",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "url": false,
            "urlNotRead": false,
            "source": ""
        },
        "parameters": {
            "petId path": {
                "name": "petId",
                "isActive": true,
                "required": true,
                "type": "num",
                "value": "47",
                "in": "path"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "successful",
                "text": "all successful responses (2xx)"
            }
        ],
        "responseAsPayload": false,
        "debugMode": "",
        "headers": [],
        "_version": "2.2.0",
        "x": 1390,
        "y": 420,
        "wires": [
            [
                "8c42edd3ad8f483f"
            ]
        ]
    },
    {
        "id": "84f43a190c420cc0",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "configUrlNode": "4fc15b76b4d55d7d",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "classic",
        "errorHandling": "default",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "url": false,
            "urlNotRead": false,
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "type": "json",
                "value": "{\"id\":47,\"name\":\"Hildegard\",\"photoUrls\":[]}",
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "successful",
                "text": "all successful responses (2xx)"
            }
        ],
        "responseAsPayload": false,
        "debugMode": "",
        "headers": [],
        "_version": "2.2.0",
        "x": 1380,
        "y": 360,
        "wires": [
            [
                "cfb1e29cc9832121"
            ]
        ]
    },
    {
        "id": "9f53aae319aea21a",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "pet shop openApi 3 example (classic)",
        "info": "",
        "x": 1290,
        "y": 320,
        "wires": []
    },
    {
        "id": "e70c041c9abdaf24",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1200,
        "y": 500,
        "wires": [
            [
                "fae3ae2c4e4f2543"
            ]
        ]
    },
    {
        "id": "032cdf22b09cbf50",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1770,
        "y": 500,
        "wires": []
    },
    {
        "id": "fae3ae2c4e4f2543",
        "type": "file in",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "filename": "./examples/dog.jpg",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1410,
        "y": 500,
        "wires": [
            [
                "12e3afafe385aec5"
            ]
        ]
    },
    {
        "id": "12e3afafe385aec5",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "configUrlNode": "4fc15b76b4d55d7d",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "uploadFile",
            "hasOperationId": true,
            "path": "/pet/{petId}/uploadImage",
            "method": "post"
        },
        "outputStyle": "classic",
        "errorHandling": "default",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "urlNotRead": false,
            "url": false,
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "isActive": true,
                "type": "msg",
                "value": "payload"
            },
            "petId path": {
                "name": "petId",
                "isActive": true,
                "required": true,
                "type": "num",
                "value": "66",
                "in": "path"
            },
            "additionalMetadata query": {
                "name": "additionalMetadata",
                "type": "str",
                "value": "",
                "in": "query"
            }
        },
        "requestContentType": "application/octet-stream",
        "responseContentType": "application/json",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "successful",
                "text": "all successful responses (2xx)"
            }
        ],
        "responseAsPayload": true,
        "headers": [],
        "_version": "2.2.0",
        "x": 1610,
        "y": 500,
        "wires": [
            [
                "032cdf22b09cbf50"
            ]
        ]
    },
    {
        "id": "14862242a91c03b1",
        "type": "comment",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "set a path to an existing file",
        "info": "",
        "x": 1430,
        "y": 460,
        "wires": []
    },
    {
        "id": "18797dbc244535cc",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1200,
        "y": 220,
        "wires": [
            [
                "7f3d299d1ec31a66"
            ]
        ]
    },
    {
        "id": "9810d92794505360",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1590,
        "y": 220,
        "wires": []
    },
    {
        "id": "7f3d299d1ec31a66",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "01c6034556accf3a",
        "name": "",
        "configUrlNode": "4e8e4d5957412be2",
        "apiTag": "pet",
        "keepAuth": false,
        "operationData": {
            "id": "getPetById",
            "hasOperationId": true,
            "path": "/pet/{petId}",
            "method": "get"
        },
        "outputStyle": "classic",
        "errorHandling": "default",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "url": false,
            "urlNotRead": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "petId path": {
                "name": "petId",
                "isActive": true,
                "required": true,
                "type": "num",
                "value": "451",
                "in": "path"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "successful",
                "text": "all successful responses (2xx)"
            }
        ],
        "responseAsPayload": true,
        "debugMode": "",
        "headers": [],
        "_version": "2.2.0",
        "x": 1390,
        "y": 220,
        "wires": [
            [
                "9810d92794505360"
            ]
        ]
    },
    {
        "id": "1b52e6c758aacb10",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "get pet 451",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "451",
        "payloadType": "num",
        "x": 160,
        "y": 320,
        "wires": [
            [
                "17b0e03a9286c258"
            ]
        ]
    },
    {
        "id": "54ce4caefeb8ba12",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 200",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 300,
        "wires": []
    },
    {
        "id": "c6e69660fab90ac4",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 404",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 380,
        "wires": []
    },
    {
        "id": "17b0e03a9286c258",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "",
        "configUrlNode": "4e8e4d5957412be2",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "getPetById",
            "hasOperationId": true,
            "path": "/pet/{petId}",
            "method": "get"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "urlNotRead": false,
            "url": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "petId path": {
                "name": "petId",
                "isActive": true,
                "activeFilter": "",
                "required": true,
                "type": "msg",
                "collapsed": false,
                "value": "payload",
                "in": "path"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 3,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "successful operation"
            },
            {
                "code": "400",
                "text": "Invalid ID supplied"
            },
            {
                "code": "404",
                "text": "Pet not found"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [
            {
                "key": "Hund",
                "valueType": "str",
                "value": "katze"
            }
        ],
        "_version": "2.2.0",
        "x": 370,
        "y": 340,
        "wires": [
            [
                "54ce4caefeb8ba12"
            ],
            [
                "deee4299c301b4a8"
            ],
            [
                "c6e69660fab90ac4"
            ]
        ]
    },
    {
        "id": "deee4299c301b4a8",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 400",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 340,
        "wires": []
    },
    {
        "id": "5e6a3d87843af348",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "error 404",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 360,
        "wires": [
            [
                "17b0e03a9286c258"
            ]
        ]
    },
    {
        "id": "9571f83d9ff1cfb7",
        "type": "catch",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "catching all undefined responses",
        "scope": null,
        "uncaught": true,
        "x": 230,
        "y": 100,
        "wires": [
            [
                "a7a87e65a43ce895"
            ]
        ]
    },
    {
        "id": "a7a87e65a43ce895",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "error log",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 100,
        "wires": []
    },
    {
        "id": "4a87ce22e00f3efa",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 405",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 540,
        "wires": []
    },
    {
        "id": "16ff18397b551163",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "get pet 66",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "66",
        "payloadType": "num",
        "x": 160,
        "y": 780,
        "wires": [
            [
                "8045a1d812f80bfb"
            ]
        ]
    },
    {
        "id": "c2a567a74171bc92",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 200",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 820,
        "wires": []
    },
    {
        "id": "a2798a84ebf29821",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 404",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 900,
        "wires": []
    },
    {
        "id": "8045a1d812f80bfb",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "",
        "configUrlNode": "4fc15b76b4d55d7d",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "getPetById",
            "hasOperationId": true,
            "path": "/pet/{petId}",
            "method": "get"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "urlNotRead": false,
            "url": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "petId path": {
                "name": "petId",
                "isActive": true,
                "activeFilter": "",
                "required": true,
                "type": "msg",
                "value": "payload",
                "in": "path"
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 4,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "successful operation"
            },
            {
                "code": "400",
                "text": "Invalid ID supplied"
            },
            {
                "code": "404",
                "text": "Pet not found"
            },
            {
                "code": "default",
                "text": "Unexpected error"
            }
        ],
        "responseAsPayload": false,
        "debugMode": "",
        "headers": [],
        "_version": "2.2.0",
        "x": 370,
        "y": 860,
        "wires": [
            [
                "c2a567a74171bc92"
            ],
            [
                "3a9e9aaa25a5c025"
            ],
            [
                "a2798a84ebf29821"
            ],
            []
        ]
    },
    {
        "id": "3a9e9aaa25a5c025",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 400",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 860,
        "wires": []
    },
    {
        "id": "2acfae3a3b04e41f",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "error 400",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "\"10a\"",
        "payloadType": "str",
        "x": 160,
        "y": 900,
        "wires": [
            [
                "8045a1d812f80bfb"
            ]
        ]
    },
    {
        "id": "6d04430b35be0819",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "error 404",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 940,
        "wires": [
            [
                "8045a1d812f80bfb"
            ]
        ]
    },
    {
        "id": "fe01a9e33899abda",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "not defined response",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 1040,
        "wires": []
    },
    {
        "id": "5be937fe9b529fc1",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "add pet 952",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 620,
        "wires": [
            [
                "1d205353151b266e"
            ]
        ]
    },
    {
        "id": "1d6d17c456d6e266",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "success",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 600,
        "wires": []
    },
    {
        "id": "1d205353151b266e",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "add Pet by editor",
        "configUrlNode": "4fc15b76b4d55d7d",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "url": false,
            "urlNotRead": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "activeFilter": "",
                "type": "editor:Pet",
                "parameters": {
                    "id": {
                        "name": "id",
                        "isActive": true,
                        "activeFilter": "",
                        "type": "num",
                        "value": "952"
                    },
                    "name": {
                        "name": "name",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "str",
                        "value": "Mr. Whizzlecat"
                    },
                    "category": {
                        "name": "category",
                        "activeFilter": "",
                        "type": "editor:Category",
                        "parameters": {
                            "id": {
                                "name": "id",
                                "activeFilter": ""
                            },
                            "name": {
                                "name": "name",
                                "activeFilter": ""
                            }
                        }
                    },
                    "photoUrls": {
                        "name": "photoUrls",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "json",
                        "value": "[]"
                    },
                    "tags": {
                        "name": "tags",
                        "isActive": true,
                        "activeFilter": "",
                        "type": "array",
                        "value": [
                            {
                                "name": 0,
                                "isActive": true,
                                "activeFilter": "",
                                "required": true,
                                "type": "editor:Tag",
                                "collapsed": false,
                                "value": "",
                                "parameters": {
                                    "id": {
                                        "name": "id",
                                        "isActive": true,
                                        "activeFilter": "",
                                        "required": false,
                                        "type": "num",
                                        "collapsed": true,
                                        "value": "123",
                                        "parameters": {},
                                        "msgPathString": "payload.tags[\"0\"].id"
                                    },
                                    "name": {
                                        "name": "name",
                                        "isActive": true,
                                        "activeFilter": "",
                                        "required": false,
                                        "type": "str",
                                        "collapsed": true,
                                        "value": "has a tag",
                                        "parameters": {},
                                        "msgPathString": "payload.tags[\"0\"].name"
                                    }
                                },
                                "msgPathString": "payload.tags[\"0\"]"
                            },
                            {
                                "name": 1,
                                "isActive": true,
                                "activeFilter": "",
                                "required": true,
                                "type": "editor:Tag",
                                "collapsed": false,
                                "value": "",
                                "parameters": {
                                    "id": {
                                        "name": "id",
                                        "isActive": true,
                                        "activeFilter": "",
                                        "required": false,
                                        "type": "num",
                                        "collapsed": true,
                                        "value": "124",
                                        "parameters": {},
                                        "msgPathString": "payload.tags[\"1\"].id"
                                    },
                                    "name": {
                                        "name": "name",
                                        "isActive": true,
                                        "activeFilter": "",
                                        "required": false,
                                        "type": "str",
                                        "collapsed": true,
                                        "value": "and even a second one",
                                        "parameters": {},
                                        "msgPathString": "payload.tags[\"1\"].name"
                                    }
                                },
                                "msgPathString": "payload.tags[\"1\"]"
                            }
                        ]
                    },
                    "status": {
                        "name": "status",
                        "isActive": true,
                        "activeFilter": "",
                        "type": "select",
                        "value": "available"
                    }
                },
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 2,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "Successful operation"
            },
            {
                "code": "405",
                "text": "Invalid input"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 390,
        "y": 620,
        "wires": [
            [
                "1d6d17c456d6e266"
            ],
            [
                "8d63e9e4de8cbe37"
            ]
        ]
    },
    {
        "id": "8d63e9e4de8cbe37",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 405",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 640,
        "wires": []
    },
    {
        "id": "f7e22af6d625591e",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "get pet 952",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "952",
        "payloadType": "num",
        "x": 160,
        "y": 820,
        "wires": [
            [
                "8045a1d812f80bfb"
            ]
        ]
    },
    {
        "id": "c897adafa788de00",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "add pet 632",
        "props": [
            {
                "p": "id",
                "v": "632",
                "vt": "num"
            },
            {
                "p": "payload"
            },
            {
                "p": "urls",
                "v": "[\"http://www.myDog.de\",\"http://www.myDog.com\",\"http://www.myDog.at\",\"http://www.myDog.gov\"]",
                "vt": "json"
            },
            {
                "p": "isActive",
                "v": "true",
                "vt": "bool"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "[{\"id\":13,\"nameX\":\"YEAH\"},{\"id\":15,\"nameX\":\"IT\"},{\"id\":1232,\"nameX\":\"WORKS\"}]",
        "payloadType": "json",
        "x": 170,
        "y": 720,
        "wires": [
            [
                "ad8ebbbf4fad2678"
            ]
        ]
    },
    {
        "id": "65110c919e408b85",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "success",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 700,
        "wires": []
    },
    {
        "id": "8a432c1017ac312e",
        "type": "debug",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "defined response 405",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 640,
        "y": 740,
        "wires": []
    },
    {
        "id": "d81d9db98b14b421",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "get pet 632",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "632",
        "payloadType": "num",
        "x": 160,
        "y": 860,
        "wires": [
            [
                "8045a1d812f80bfb"
            ]
        ]
    },
    {
        "id": "ad8ebbbf4fad2678",
        "type": "openApi-red",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "add Pet by editor (has filter)",
        "configUrlNode": "4fc15b76b4d55d7d",
        "apiTag": "pet",
        "keepAuth": "",
        "operationData": {
            "id": "addPet",
            "hasOperationId": true,
            "path": "/pet",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "readUrl": false,
            "text": "",
            "url": false,
            "urlNotRead": false,
            "parameters": false,
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "activeFilter": "",
                "type": "editor:Pet",
                "parameters": {
                    "id": {
                        "name": "id",
                        "isActive": true,
                        "activeFilter": "{\n\treturn value === 632\n}",
                        "type": "msg",
                        "collapsed": false,
                        "value": "id"
                    },
                    "name": {
                        "name": "name",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "str",
                        "value": "Doggy Mc Dogface"
                    },
                    "category": {
                        "name": "category",
                        "activeFilter": "",
                        "type": "editor:Category",
                        "collapsed": false,
                        "parameters": {
                            "id": {
                                "name": "id",
                                "activeFilter": ""
                            },
                            "name": {
                                "name": "name",
                                "activeFilter": ""
                            }
                        }
                    },
                    "photoUrls": {
                        "name": "photoUrls",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "each",
                        "collapsed": false,
                        "value": [
                            {
                                "name": "0",
                                "isActive": true,
                                "activeFilter": "{\n\treturn url !== \"http://www.myDog.at\"\n}",
                                "required": true,
                                "type": "_each_url",
                                "collapsed": true,
                                "value": "",
                                "parameters": {},
                                "msgPathString": "payload.photoUrls[\"0\"]"
                            }
                        ],
                        "eachType": "msg",
                        "each": "urls",
                        "as": "url"
                    },
                    "tags": {
                        "name": "tags",
                        "isActive": true,
                        "activeFilter": "",
                        "type": "each",
                        "collapsed": false,
                        "value": [
                            {
                                "name": 0,
                                "isActive": true,
                                "required": true,
                                "type": "editor:Tag",
                                "collapsed": false,
                                "value": "[{ \"id\": \"integer\", \"name\": \"string\" }]",
                                "parameters": {
                                    "id": {
                                        "name": "id",
                                        "isActive": true,
                                        "required": false,
                                        "type": "_each_tag",
                                        "collapsed": true,
                                        "value": ".id",
                                        "parameters": {},
                                        "msgPathString": "payload.tags[\"0\"].id",
                                        "activeFilter": "{\n\treturn tag.id !== 13\n}"
                                    },
                                    "name": {
                                        "name": "name",
                                        "isActive": true,
                                        "required": false,
                                        "type": "_each_tag",
                                        "collapsed": true,
                                        "value": ".nameX",
                                        "parameters": {},
                                        "msgPathString": "payload.tags[\"0\"].name"
                                    }
                                },
                                "msgPathString": "payload.tags[\"0\"]",
                                "activeFilter": "{\n\treturn tag.id === 13 || tag.id === 15\n}"
                            }
                        ],
                        "eachType": "msg",
                        "each": "payload",
                        "as": "tag"
                    },
                    "status": {
                        "name": "status",
                        "isActive": true,
                        "activeFilter": "",
                        "type": "select",
                        "value": "available"
                    }
                },
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 2,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "Successful operation"
            },
            {
                "code": "405",
                "text": "Invalid input"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 380,
        "y": 720,
        "wires": [
            [
                "65110c919e408b85"
            ],
            [
                "8a432c1017ac312e"
            ]
        ]
    },
    {
        "id": "751bd26d424cc321",
        "type": "inject",
        "z": "0c8e0c86799d088c",
        "g": "efb7a27e4dfae1f6",
        "name": "add pet 451",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{}",
        "payloadType": "json",
        "x": 170,
        "y": 200,
        "wires": [
            [
                "fd241870fe8e402a"
            ]
        ]
    },
    {
        "id": "d4f8c637ba287db1",
        "type": "inject",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Inject Current Temp",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 260,
        "y": 200,
        "wires": [
            [
                "ba5dc6718d645637"
            ]
        ]
    },
    {
        "id": "69ded1d17cbec561",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Compare and Decide",
        "func": "const desired = flow.get('desired_temp') || 22;\nconst current = msg.payload.current;\nlet state = \"IDLE\";\nif (current < desired - 1) state = \"HEATING\";\nelse if (current > desired + 1) state = \"COOLING\";\nmsg.payload = { temperature: desired, unit: \"C\", current, state };\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 160,
        "wires": [
            [
                "1d06a67200a8e66e",
                "8081e1c458fe1e4b"
            ]
        ]
    },
    {
        "id": "9a05b0be9bfe3225",
        "type": "ui_text",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Status Display",
        "label": "Thermostat Status",
        "format": "{{msg.payload.state}} | Current: {{msg.payload.current}}C | Target: {{msg.payload.temperature}}C",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1330,
        "y": 260,
        "wires": []
    },
    {
        "id": "1d06a67200a8e66e",
        "type": "async-api-red",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Send to Thermostat Device",
        "x": 1010,
        "y": 200,
        "wires": [
            [
                "d9d04269593328c3",
                "9a05b0be9bfe3225"
            ]
        ]
    },
    {
        "id": "d9d04269593328c3",
        "type": "debug",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Debug Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "statusVal": "",
        "statusType": "auto",
        "x": 1330,
        "y": 180,
        "wires": []
    },
    {
        "id": "1eb2f1ad87e9df5c",
        "type": "comment",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Thermostat simulation",
        "info": "",
        "x": 220,
        "y": 120,
        "wires": []
    },
    {
        "id": "09f2f1cdc17cf192",
        "type": "ui_slider",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Desired Temp",
        "label": "Set Desired Temp",
        "tooltip": "",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "topicType": "str",
        "min": 15,
        "max": 30,
        "step": 1,
        "className": "",
        "x": 240,
        "y": 280,
        "wires": [
            [
                "5fd815fb2caf5aba"
            ]
        ]
    },
    {
        "id": "5fd815fb2caf5aba",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Store Desired Temp",
        "func": "flow.set('desired_temp', msg.payload);\nreturn null;",
        "outputs": 1,
        "x": 470,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "4c2bce897c0d2007",
        "type": "comment",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "AC simulation",
        "info": "",
        "x": 190,
        "y": 400,
        "wires": []
    },
    {
        "id": "1616e8d0253bffbf",
        "type": "inject",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Inject Random Brightness",
        "props": [],
        "repeat": "5",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 260,
        "y": 860,
        "wires": [
            [
                "29a719f9730293ac"
            ]
        ]
    },
    {
        "id": "29a719f9730293ac",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Generate Brightness",
        "func": "const brightness = Math.floor(Math.random() * 101);\nmsg.payload = { brightness };\nreturn msg;",
        "outputs": 1,
        "x": 520,
        "y": 800,
        "wires": [
            [
                "b58e5041e4c9741b",
                "d83a4d77d7f049bf"
            ]
        ]
    },
    {
        "id": "b58e5041e4c9741b",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Check Brightness",
        "func": "const brightness = msg.payload.brightness;\nmsg.payload = {\n    state: brightness >= 80 ? \"on\" : \"off\",\n    brightness\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 800,
        "wires": [
            [
                "dba1b26fa3a4b0a8"
            ]
        ]
    },
    {
        "id": "d83a4d77d7f049bf",
        "type": "ui_chart",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Brightness Chart",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "Brightness Over Time",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "Waiting...",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 710,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "84eae99cd8fb8148",
        "type": "switch",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Light ON or OFF?",
        "property": "payload.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1230,
        "y": 740,
        "wires": [
            [
                "9b07cf1424fb44b6"
            ],
            [
                "499267adb5adb442"
            ]
        ]
    },
    {
        "id": "9b07cf1424fb44b6",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Count ON",
        "func": "let count = context.get('on') || 0;\ncount += 1;\ncontext.set('on', count);\nmsg.payload = count;\nreturn msg;",
        "outputs": 1,
        "x": 1520,
        "y": 720,
        "wires": [
            [
                "02494731b443fa30"
            ]
        ]
    },
    {
        "id": "499267adb5adb442",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Count OFF",
        "func": "let count = context.get('off') || 0;\ncount += 1;\ncontext.set('off', count);\nmsg.payload = count;\nreturn msg;",
        "outputs": 1,
        "x": 1520,
        "y": 760,
        "wires": [
            [
                "4229373250208f05"
            ]
        ]
    },
    {
        "id": "02494731b443fa30",
        "type": "ui_text",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "group": "",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "Times ON",
        "label": "Light ON Count",
        "format": "{{msg.payload}} times",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1740,
        "y": 720,
        "wires": []
    },
    {
        "id": "4229373250208f05",
        "type": "ui_text",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "group": "",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "Times OFF",
        "label": "Light OFF Count",
        "format": "{{msg.payload}} times",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1740,
        "y": 760,
        "wires": []
    },
    {
        "id": "dba1b26fa3a4b0a8",
        "type": "async-api-red",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Send to Light Device",
        "x": 1000,
        "y": 860,
        "wires": [
            [
                "84eae99cd8fb8148",
                "c0f6b3899961c14c",
                "ae9ed5515183f125",
                "bdacb97c9c98471c"
            ]
        ]
    },
    {
        "id": "c0f6b3899961c14c",
        "type": "ui_gauge",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "Brightness",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Brightness",
        "label": "%",
        "format": "{{msg.payload.brightness}}",
        "min": 0,
        "max": 100,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": 60,
        "seg2": 80,
        "diff": false,
        "className": "",
        "x": 1250,
        "y": 840,
        "wires": []
    },
    {
        "id": "ae9ed5515183f125",
        "type": "ui_text",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Light State",
        "label": "Light State",
        "format": "{{msg.payload.state}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1250,
        "y": 940,
        "wires": []
    },
    {
        "id": "bdacb97c9c98471c",
        "type": "debug",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "debug 14",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 1020,
        "wires": []
    },
    {
        "id": "f42d0e7a987f22d0",
        "type": "comment",
        "z": "a527806fb52a0bc0",
        "g": "6996a7f421765b1a",
        "name": "smartlights simulation",
        "info": "",
        "x": 220,
        "y": 720,
        "wires": []
    },
    {
        "id": "2f8c3fe9e3a364d1",
        "type": "ui_switch",
        "z": "a527806fb52a0bc0",
        "g": "38af56c2be0e770c",
        "name": "Door Lock Switch",
        "label": "Lock Door",
        "tooltip": "",
        "group": "",
        "order": 1,
        "width": 3,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 210,
        "y": 1200,
        "wires": [
            [
                "aec069bf440e39e4"
            ]
        ]
    },
    {
        "id": "aec069bf440e39e4",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "38af56c2be0e770c",
        "name": "Format DoorLock Payload",
        "func": "msg.payload = { locked: msg.payload };\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 1200,
        "wires": [
            [
                "601a43db7ca6fa0a"
            ]
        ]
    },
    {
        "id": "601a43db7ca6fa0a",
        "type": "async-api-red",
        "z": "a527806fb52a0bc0",
        "g": "38af56c2be0e770c",
        "name": "SmartDoor Lock ",
        "x": 720,
        "y": 1140,
        "wires": [
            [
                "f6b18e5f375f811d",
                "47886e634365fb88"
            ]
        ]
    },
    {
        "id": "47886e634365fb88",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "38af56c2be0e770c",
        "name": "Update Dashboard Status",
        "func": "msg.payload = msg.payload.locked ? \"Locked\" : \"Unlocked\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1030,
        "y": 1220,
        "wires": [
            [
                "f324d4a123376c63"
            ]
        ]
    },
    {
        "id": "f324d4a123376c63",
        "type": "ui_text",
        "z": "a527806fb52a0bc0",
        "g": "38af56c2be0e770c",
        "group": "",
        "order": 2,
        "width": 3,
        "height": 1,
        "name": "Lock Status Text",
        "label": "Door Status",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 1320,
        "y": 1220,
        "wires": []
    },
    {
        "id": "f6b18e5f375f811d",
        "type": "debug",
        "z": "a527806fb52a0bc0",
        "g": "38af56c2be0e770c",
        "name": "debug 15",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1140,
        "y": 1140,
        "wires": []
    },
    {
        "id": "6aa34857a3f76ef9",
        "type": "comment",
        "z": "a527806fb52a0bc0",
        "g": "38af56c2be0e770c",
        "name": "Smartdoor",
        "info": "",
        "x": 180,
        "y": 1140,
        "wires": []
    },
    {
        "id": "d4868acaa6b1056b",
        "type": "comment",
        "z": "a527806fb52a0bc0",
        "g": "d6d6813509f8a19b",
        "name": "cofee machine simulator",
        "info": "",
        "x": 230,
        "y": 1360,
        "wires": []
    },
    {
        "id": "format_coffee",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "d6d6813509f8a19b",
        "name": "Format Coffee Payload",
        "func": "msg.payload = {\n  strength: msg.payload.strength,\n  size: msg.payload.size\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 770,
        "y": 1460,
        "wires": [
            [
                "b972287969dd1e02"
            ]
        ]
    },
    {
        "id": "join_coffee",
        "type": "join",
        "z": "a527806fb52a0bc0",
        "g": "d6d6813509f8a19b",
        "name": "Join Strength & Size",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": true,
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 480,
        "y": 1460,
        "wires": [
            [
                "format_coffee"
            ]
        ]
    },
    {
        "id": "debug_coffee",
        "type": "debug",
        "z": "a527806fb52a0bc0",
        "g": "d6d6813509f8a19b",
        "name": "Debug Coffee Payload",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 1220,
        "y": 1400,
        "wires": []
    },
    {
        "id": "b972287969dd1e02",
        "type": "async-api-red",
        "z": "a527806fb52a0bc0",
        "g": "d6d6813509f8a19b",
        "name": "SmartDoor Lock ",
        "x": 1000,
        "y": 1460,
        "wires": [
            [
                "debug_coffee",
                "ui_coffee_status"
            ]
        ]
    },
    {
        "id": "ui_size",
        "type": "ui_dropdown",
        "z": "a527806fb52a0bc0",
        "g": "d6d6813509f8a19b",
        "name": "Select Size",
        "label": "Coffee Size",
        "tooltip": "",
        "place": "",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Small",
                "value": "small",
                "type": "str"
            },
            {
                "label": "Medium",
                "value": "medium",
                "type": "str"
            },
            {
                "label": "Large",
                "value": "large",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "size",
        "topicType": "str",
        "className": "",
        "x": 230,
        "y": 1500,
        "wires": [
            [
                "join_coffee"
            ]
        ]
    },
    {
        "id": "ui_strength",
        "type": "ui_dropdown",
        "z": "a527806fb52a0bc0",
        "g": "d6d6813509f8a19b",
        "name": "Select Strength",
        "label": "Coffee Strength",
        "tooltip": "",
        "place": "",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "Light",
                "value": "light",
                "type": "str"
            },
            {
                "label": "Medium",
                "value": "medium",
                "type": "str"
            },
            {
                "label": "Strong",
                "value": "strong",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "strength",
        "topicType": "str",
        "className": "",
        "x": 220,
        "y": 1440,
        "wires": [
            [
                "join_coffee"
            ]
        ]
    },
    {
        "id": "ui_coffee_status",
        "type": "ui_text",
        "z": "a527806fb52a0bc0",
        "g": "d6d6813509f8a19b",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "Order Status",
        "label": "Coffee Order",
        "format": "{{msg.payload.strength}} / {{msg.payload.size}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1230,
        "y": 1480,
        "wires": []
    },
    {
        "id": "652fef5d99c41776",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Check AC State",
        "func": "const currentTemp = msg.payload.temperature;\nconst desiredTemp = flow.get(\"desired_temp\") || 24;\nmsg.payload = {\n    temperature: currentTemp,\n    desired: desiredTemp,\n    unit: 'C',\n    state: currentTemp > desiredTemp ? \"ON\" : \"OFF\"\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 460,
        "wires": [
            [
                "98def4b9de0bd9e0",
                "3cdc3eae3c728601"
            ]
        ]
    },
    {
        "id": "98def4b9de0bd9e0",
        "type": "async-api-red",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "AC Controller Node",
        "x": 1040,
        "y": 460,
        "wires": [
            [
                "977bf35655af95ea",
                "325004b4427897ea",
                "6f5c1f35a0395420"
            ]
        ]
    },
    {
        "id": "977bf35655af95ea",
        "type": "debug",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Debug AC Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 420,
        "wires": []
    },
    {
        "id": "325004b4427897ea",
        "type": "ui_text",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "AC State",
        "label": "AC State",
        "format": "AC is {{msg.payload.state}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1400,
        "y": 500,
        "wires": []
    },
    {
        "id": "4ffc7d206027f2ef",
        "type": "ui_slider",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Desired Temp",
        "label": "Set Desired Temp",
        "tooltip": "",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "topicType": "str",
        "min": 15,
        "max": 30,
        "step": 1,
        "className": "",
        "x": 300,
        "y": 540,
        "wires": [
            [
                "180cc2c38f2b7ec2"
            ]
        ]
    },
    {
        "id": "180cc2c38f2b7ec2",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Store Desired Temp",
        "func": "flow.set('desired_temp', msg.payload);\nreturn null;",
        "outputs": 1,
        "x": 570,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "6f5c1f35a0395420",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Track Energy",
        "func": "// Constants\nconst power_kW = 1.5; // Power usage of the AC in kW\n\n// Get previous state and timestamp\nconst prevState = flow.get(\"ac_last_state\") || \"OFF\";\nconst lastChange = flow.get(\"ac_last_change\") || Date.now();\nconst energy = flow.get(\"energy_consumed\") || 0;\n\nconst now = Date.now();\nlet newEnergy = energy;\n\nif (prevState === \"ON\" && msg.payload.state === \"OFF\") {\n    const durationHrs = (now - lastChange) / (1000 * 60 * 60);\n    newEnergy += durationHrs * power_kW;\n    flow.set(\"energy_consumed\", newEnergy);\n}\n\n// Update flow context\nflow.set(\"ac_last_state\", msg.payload.state);\nflow.set(\"ac_last_change\", now);\n\nmsg.energy = newEnergy.toFixed(3);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 540,
        "wires": [
            [
                "c90d975ea0894abd"
            ]
        ]
    },
    {
        "id": "c90d975ea0894abd",
        "type": "ui_text",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Energy Display",
        "label": "Total Energy (kWh)",
        "format": "{{msg.energy}}",
        "layout": "row-spread",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1400,
        "y": 580,
        "wires": []
    },
    {
        "id": "e5f04a5e61c95926",
        "type": "ui_button",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Reset Energy",
        "label": "Reset Energy",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "refresh",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 300,
        "y": 600,
        "wires": [
            [
                "87c71e9f1e18a5cb"
            ]
        ]
    },
    {
        "id": "87c71e9f1e18a5cb",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Reset Energy Values",
        "func": "flow.set(\"energy_consumed\", 0);\nflow.set(\"ac_last_change\", Date.now());\nreturn null;",
        "outputs": 0,
        "x": 570,
        "y": 600,
        "wires": []
    },
    {
        "id": "ba5dc6718d645637",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Generate Current Temp",
        "func": "msg.payload = { current: Math.floor(15 + Math.random() * 15) };\nreturn msg;",
        "outputs": 1,
        "x": 490,
        "y": 200,
        "wires": [
            [
                "69ded1d17cbec561",
                "27b270e5d78bc103"
            ]
        ]
    },
    {
        "id": "27b270e5d78bc103",
        "type": "ui_gauge",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "Current Temp",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Current Temperature",
        "label": "C",
        "format": "{{msg.payload.current}}",
        "min": "10",
        "max": "35",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 730,
        "y": 260,
        "wires": []
    },
    {
        "id": "a11a61d05abb0fd9",
        "type": "function",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Generate Current Temp",
        "func": "msg.payload = { temperature: Math.floor(15 + Math.random() * 15) };\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 460,
        "wires": [
            [
                "96ab1cc712be6574",
                "652fef5d99c41776"
            ]
        ]
    },
    {
        "id": "97a42e312b36f637",
        "type": "inject",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Inject Current Temp",
        "props": [],
        "repeat": "5",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 300,
        "y": 460,
        "wires": [
            [
                "a11a61d05abb0fd9"
            ]
        ]
    },
    {
        "id": "96ab1cc712be6574",
        "type": "ui_gauge",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "Current Temp",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Current Temperature",
        "label": "C",
        "format": "{{msg.payload.temperature}}",
        "min": "10",
        "max": "35",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 790,
        "y": 520,
        "wires": []
    },
    {
        "id": "3cdc3eae3c728601",
        "type": "debug",
        "z": "a527806fb52a0bc0",
        "g": "a0bc03072058d078",
        "name": "input ac",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 400,
        "wires": []
    },
    {
        "id": "8081e1c458fe1e4b",
        "type": "debug",
        "z": "a527806fb52a0bc0",
        "g": "50a045551ea38743",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 120,
        "wires": []
    },
    {
        "id": "209eb22e55aef159",
        "type": "subflow:subflow-thermostat-logic",
        "z": "a7f4785e36cba6a2",
        "name": "Thermostat 1 Logic",
        "x": 1290,
        "y": 300,
        "wires": [
            [
                "b693ac0c316bb007",
                "278d3dc18bde92a3"
            ]
        ]
    },
    {
        "id": "b693ac0c316bb007",
        "type": "ui_text",
        "z": "a7f4785e36cba6a2",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Status 1",
        "label": "Thermostat 1",
        "format": "{{msg.payload.state}} | {{msg.payload.current}}C / {{msg.payload.desired}}C",
        "layout": "row-spread",
        "x": 1530,
        "y": 280,
        "wires": []
    },
    {
        "id": "278d3dc18bde92a3",
        "type": "ui_gauge",
        "z": "a7f4785e36cba6a2",
        "name": "Gauge 1",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Current Temp 1",
        "label": "C",
        "format": "{{msg.payload.current}}",
        "min": 10,
        "max": 35,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "x": 1530,
        "y": 320,
        "wires": []
    },
    {
        "id": "d413c272304f7027",
        "type": "function",
        "z": "a7f4785e36cba6a2",
        "name": "Attach Desired Temp 1",
        "func": "msg.desired = flow.get(\"desired1\") || 22;\nreturn msg;",
        "outputs": 1,
        "x": 1070,
        "y": 300,
        "wires": [
            [
                "209eb22e55aef159"
            ]
        ]
    },
    {
        "id": "04f14957bb63ad6c",
        "type": "inject",
        "z": "a7f4785e36cba6a2",
        "name": "Simulate Temp 1",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 690,
        "y": 300,
        "wires": [
            [
                "e5cf4791a88d36ed"
            ]
        ]
    },
    {
        "id": "e5cf4791a88d36ed",
        "type": "function",
        "z": "a7f4785e36cba6a2",
        "name": "Generate Random Temp",
        "func": "msg.payload = { current: Math.floor(15 + Math.random() * 10) };\nreturn msg;",
        "outputs": 1,
        "x": 890,
        "y": 360,
        "wires": [
            [
                "d413c272304f7027"
            ]
        ]
    },
    {
        "id": "b1b29f96499e193e",
        "type": "ui_slider",
        "z": "a7f4785e36cba6a2",
        "name": "Slider 1",
        "label": "Desired Temp 1",
        "tooltip": "",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "min": 15,
        "max": 30,
        "step": 1,
        "x": 890,
        "y": 240,
        "wires": [
            [
                "a3b785ec104fb684"
            ]
        ]
    },
    {
        "id": "a3b785ec104fb684",
        "type": "function",
        "z": "a7f4785e36cba6a2",
        "name": "Store Desired 1",
        "func": "flow.set(\"desired1\", msg.payload);\nreturn null;",
        "outputs": 1,
        "x": 1080,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "f3c546cb501a34c1",
        "type": "subflow:subflow-thermostat-logic",
        "z": "a7f4785e36cba6a2",
        "name": "Thermostat 2 Logic",
        "x": 1290,
        "y": 500,
        "wires": [
            [
                "de83e57ebf24426f",
                "f43d8752f3a53b9e"
            ]
        ]
    },
    {
        "id": "de83e57ebf24426f",
        "type": "ui_text",
        "z": "a7f4785e36cba6a2",
        "group": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Status 2",
        "label": "Thermostat 2",
        "format": "{{msg.payload.state}} | {{msg.payload.current}}C / {{msg.payload.desired}}C",
        "layout": "row-spread",
        "x": 1530,
        "y": 480,
        "wires": []
    },
    {
        "id": "f43d8752f3a53b9e",
        "type": "ui_gauge",
        "z": "a7f4785e36cba6a2",
        "name": "Gauge 2",
        "group": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Current Temp 2",
        "label": "C",
        "format": "{{msg.payload.current}}",
        "min": 10,
        "max": 35,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "x": 1530,
        "y": 520,
        "wires": []
    },
    {
        "id": "1deeb3c38486ec3e",
        "type": "inject",
        "z": "a7f4785e36cba6a2",
        "name": "Simulate Temp 2",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "x": 610,
        "y": 500,
        "wires": [
            [
                "dcbcc6db108b2ef3"
            ]
        ]
    },
    {
        "id": "dcbcc6db108b2ef3",
        "type": "function",
        "z": "a7f4785e36cba6a2",
        "name": "Generate Temp 2",
        "func": "msg.payload = { current: Math.floor(15 + Math.random() * 10) };\nreturn msg;",
        "outputs": 1,
        "x": 830,
        "y": 560,
        "wires": [
            [
                "a7f9f85e8ad8fa6e"
            ]
        ]
    },
    {
        "id": "a7f9f85e8ad8fa6e",
        "type": "function",
        "z": "a7f4785e36cba6a2",
        "name": "Attach Desired 2",
        "func": "msg.desired = flow.get(\"desired2\") || 22;\nreturn msg;",
        "outputs": 1,
        "x": 1070,
        "y": 500,
        "wires": [
            [
                "f3c546cb501a34c1"
            ]
        ]
    },
    {
        "id": "1f5477c9da2d418f",
        "type": "ui_slider",
        "z": "a7f4785e36cba6a2",
        "name": "Slider 2",
        "label": "Desired Temp 2",
        "tooltip": "",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "min": 15,
        "max": 30,
        "step": 1,
        "x": 840,
        "y": 440,
        "wires": [
            [
                "ba9cd257a3f10828"
            ]
        ]
    },
    {
        "id": "ba9cd257a3f10828",
        "type": "function",
        "z": "a7f4785e36cba6a2",
        "name": "Store Desired 2",
        "func": "flow.set(\"desired2\", msg.payload);\nreturn null;",
        "outputs": 1,
        "x": 1080,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "inject_temp",
        "type": "inject",
        "z": "b0c6f1e3d4fc18a3",
        "g": "6fbdbe15acb6baf1",
        "name": "Inject Current Temp",
        "props": [],
        "repeat": "5",
        "once": true,
        "topic": "",
        "x": 260,
        "y": 260,
        "wires": [
            [
                "gen_temp"
            ]
        ]
    },
    {
        "id": "gen_temp",
        "type": "function",
        "z": "b0c6f1e3d4fc18a3",
        "g": "6fbdbe15acb6baf1",
        "name": "Generate Current Temp",
        "func": "msg.payload = { current: 15 + Math.floor(Math.random()*10) };\nreturn msg;",
        "outputs": 1,
        "x": 550,
        "y": 260,
        "wires": [
            [
                "decide_mode"
            ]
        ]
    },
    {
        "id": "decide_mode",
        "type": "function",
        "z": "b0c6f1e3d4fc18a3",
        "g": "6fbdbe15acb6baf1",
        "name": "Compare and Decide",
        "func": "const desired = flow.get('desired_temp') || 22;\nconst current = msg.payload.current;\nlet mode = \"idle\";\nif (current < desired - 1) mode = \"heat\";\nelse if (current > desired + 1) mode = \"cool\";\n\n// track energy use\nlet energy = flow.get('energy.thermostat') || 0;\nif (mode !== \"idle\") energy += 0.05; // add kWh step\nflow.set('energy.thermostat', energy);\n\nmsg.payload = {\n    temperature: current,\n    humidity: Math.floor(40 + Math.random()*20),\n    mode: mode,\n    energyUsed: energy,\n    unit: \"C\"\n};\nreturn msg;",
        "outputs": 1,
        "x": 810,
        "y": 260,
        "wires": [
            [
                "thermostat_asyncapi",
                "thermostat_ui"
            ]
        ]
    },
    {
        "id": "thermostat_asyncapi",
        "type": "async-api-red",
        "z": "b0c6f1e3d4fc18a3",
        "g": "6fbdbe15acb6baf1",
        "name": "thermostatState",
        "x": 1080,
        "y": 260,
        "wires": [
            [
                "thermostat_debug"
            ]
        ]
    },
    {
        "id": "thermostat_debug",
        "type": "debug",
        "z": "b0c6f1e3d4fc18a3",
        "g": "6fbdbe15acb6baf1",
        "name": "Thermostat Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 1310,
        "y": 260,
        "wires": []
    },
    {
        "id": "thermostat_ui",
        "type": "ui_text",
        "z": "b0c6f1e3d4fc18a3",
        "g": "6fbdbe15acb6baf1",
        "group": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Thermostat Status",
        "label": "Thermostat",
        "format": "Temp: {{msg.payload.temperature}}C | Mode: {{msg.payload.mode}} | Energy: {{msg.payload.energyUsed.toFixed(2)}} kWh",
        "layout": "row-spread",
        "x": 1080,
        "y": 320,
        "wires": []
    },
    {
        "id": "7a5f61a9eaff8de0",
        "type": "comment",
        "z": "b0c6f1e3d4fc18a3",
        "g": "6fbdbe15acb6baf1",
        "name": "Thermostat",
        "info": "",
        "x": 210,
        "y": 200,
        "wires": []
    },
    {
        "id": "inject_thermostat",
        "type": "inject",
        "z": "smarthome_flow",
        "g": "thermostat_group",
        "name": "Inject Temp",
        "props": [],
        "repeat": "5",
        "once": true,
        "x": 250,
        "y": 200,
        "wires": [
            [
                "func_thermostat"
            ]
        ]
    },
    {
        "id": "func_thermostat",
        "type": "function",
        "z": "smarthome_flow",
        "g": "thermostat_group",
        "name": "Thermostat State & Energy",
        "func": "const desired = flow.get('desired_temp') || 22;\nconst current = 15 + Math.floor(Math.random()*10);\nlet mode='idle';\nif(current < desired-1) mode='heat';\nelse if(current>desired+1) mode='cool';\nlet energy=flow.get('energy.thermostat')||0;\nif(mode!=='idle') energy+=0.05;\nflow.set('energy.thermostat',energy);\nmsg.payload={temperature:current,humidity:40+Math.floor(Math.random()*20),mode:mode,energyUsed:energy,unit:'C'};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 200,
        "wires": [
            [
                "asyncapi_thermostat",
                "ui_thermostat"
            ]
        ]
    },
    {
        "id": "asyncapi_thermostat",
        "type": "async-api-red",
        "z": "smarthome_flow",
        "g": "thermostat_group",
        "name": "Thermostat AsyncAPI",
        "x": 840,
        "y": 160,
        "wires": [
            [
                "debug_thermostat"
            ]
        ]
    },
    {
        "id": "debug_thermostat",
        "type": "debug",
        "z": "smarthome_flow",
        "g": "thermostat_group",
        "name": "Thermostat Debug",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "x": 1110,
        "y": 160,
        "wires": []
    },
    {
        "id": "ui_thermostat",
        "type": "ui_text",
        "z": "smarthome_flow",
        "g": "thermostat_group",
        "group": "",
        "order": 1,
        "width": "",
        "height": "",
        "name": "",
        "label": "Thermostat",
        "format": "Temp: {{msg.payload.temperature}}C | Mode: {{msg.payload.mode}} | Energy: {{msg.payload.energyUsed.toFixed(2)}} kWh",
        "layout": "",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 810,
        "y": 220,
        "wires": []
    },
    {
        "id": "comment_thermostat",
        "type": "comment",
        "z": "smarthome_flow",
        "g": "thermostat_group",
        "name": "Thermostat",
        "info": "",
        "x": 220,
        "y": 130,
        "wires": []
    },
    {
        "id": "ec8567273d2eeee4",
        "type": "inject",
        "z": "9d0b8d8486bf692d",
        "g": "60aadd304320ab68",
        "name": "Inject Temp",
        "props": [],
        "repeat": "5",
        "once": true,
        "x": 200,
        "y": 80,
        "wires": [
            [
                "4f76589d9ce93708"
            ]
        ]
    },
    {
        "id": "4f76589d9ce93708",
        "type": "function",
        "z": "9d0b8d8486bf692d",
        "g": "60aadd304320ab68",
        "name": "Thermostat State & Energy",
        "func": "const desired = flow.get('desired_temp') || 22;\nconst current = 15 + Math.floor(Math.random()*10);\nlet mode='idle';\nif(current < desired-1) mode='heat';\nelse if(current>desired+1) mode='cool';\nlet energy=flow.get('energy.thermostat')||0;\nif(mode!=='idle') energy+=0.05;\nflow.set('energy.thermostat',energy);\nmsg.payload={temperature:current,humidity:40+Math.floor(Math.random()*20),mode:mode,energyUsed:energy,unit:'C'};\nreturn msg;",
        "outputs": 1,
        "x": 450,
        "y": 80,
        "wires": [
            [
                "3c02180f43d76483",
                "08eba1a39da3c211"
            ]
        ]
    },
    {
        "id": "3c02180f43d76483",
        "type": "async-api-red",
        "z": "9d0b8d8486bf692d",
        "g": "60aadd304320ab68",
        "name": "Thermostat AsyncAPI",
        "x": 700,
        "y": 80,
        "wires": [
            [
                "52372a1a90bed450"
            ]
        ]
    },
    {
        "id": "52372a1a90bed450",
        "type": "debug",
        "z": "9d0b8d8486bf692d",
        "g": "60aadd304320ab68",
        "name": "Thermostat Debug",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "x": 900,
        "y": 80,
        "wires": []
    },
    {
        "id": "08eba1a39da3c211",
        "type": "ui_text",
        "z": "9d0b8d8486bf692d",
        "g": "60aadd304320ab68",
        "group": "",
        "order": 1,
        "label": "Thermostat",
        "format": "Temp: {{msg.payload.temperature}}C | Mode: {{msg.payload.mode}} | Energy: {{msg.payload.energyUsed.toFixed(2)}} kWh",
        "x": 700,
        "y": 140,
        "wires": []
    },
    {
        "id": "d34fbeffad5f26c3",
        "type": "comment",
        "z": "9d0b8d8486bf692d",
        "g": "60aadd304320ab68",
        "name": "Thermostat",
        "info": "",
        "x": 150,
        "y": 50,
        "wires": []
    },
    {
        "id": "b2ace2b50a3cffc6",
        "type": "inject",
        "z": "9d0b8d8486bf692d",
        "g": "7495cd4d423a5333",
        "name": "Inject AC State",
        "props": [],
        "repeat": "5",
        "once": true,
        "x": 200,
        "y": 330,
        "wires": [
            [
                "5767fb305640ce22"
            ]
        ]
    },
    {
        "id": "5767fb305640ce22",
        "type": "function",
        "z": "9d0b8d8486bf692d",
        "g": "7495cd4d423a5333",
        "name": "AC State & Energy",
        "func": "const state=Math.random()>0.5?'ON':'OFF';\nlet energy=flow.get('energy.ac')||0;\nif(state==='ON') energy+=0.2;\nflow.set('energy.ac',energy);\nmsg.payload={state:state,energyUsed:energy,mode:'cooling'};\nreturn msg;",
        "outputs": 1,
        "x": 450,
        "y": 330,
        "wires": [
            [
                "320f5263b6a058cb",
                "d61ec178a3c22e54"
            ]
        ]
    },
    {
        "id": "320f5263b6a058cb",
        "type": "async-api-red",
        "z": "9d0b8d8486bf692d",
        "g": "7495cd4d423a5333",
        "name": "AC AsyncAPI",
        "x": 700,
        "y": 330,
        "wires": [
            [
                "6c79919ed6d57634"
            ]
        ]
    },
    {
        "id": "6c79919ed6d57634",
        "type": "debug",
        "z": "9d0b8d8486bf692d",
        "g": "7495cd4d423a5333",
        "name": "AC Debug",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "x": 900,
        "y": 330,
        "wires": []
    },
    {
        "id": "d61ec178a3c22e54",
        "type": "ui_text",
        "z": "9d0b8d8486bf692d",
        "g": "7495cd4d423a5333",
        "group": "",
        "order": 1,
        "label": "AC",
        "format": "State: {{msg.payload.state}} | Energy: {{msg.payload.energyUsed.toFixed(2)}} kWh",
        "x": 700,
        "y": 390,
        "wires": []
    },
    {
        "id": "29acb7a9e4ad24bf",
        "type": "comment",
        "z": "9d0b8d8486bf692d",
        "g": "7495cd4d423a5333",
        "name": "AC",
        "info": "",
        "x": 150,
        "y": 300,
        "wires": []
    },
    {
        "id": "565b754961e5b93e",
        "type": "inject",
        "z": "db6486d1d2cd59d6",
        "g": "5b08965eee815217",
        "name": "Inject Temp",
        "props": [],
        "repeat": "5",
        "once": true,
        "x": 200,
        "y": 80,
        "wires": [
            [
                "230fec0f35cc4133"
            ]
        ]
    },
    {
        "id": "230fec0f35cc4133",
        "type": "function",
        "z": "db6486d1d2cd59d6",
        "g": "5b08965eee815217",
        "name": "Thermostat State & Energy",
        "func": "const desired = flow.get('desired_temp') || 22;\nconst current = 15 + Math.floor(Math.random()*10);\nlet mode='idle';\nif(current < desired-1) mode='heat';\nelse if(current>desired+1) mode='cool';\nlet energy=flow.get('energy.thermostat')||0;\nif(mode!=='idle') energy+=0.05;\nflow.set('energy.thermostat',energy);\nmsg.payload={temperature:current,humidity:40+Math.floor(Math.random()*20),mode:mode,energyUsed:energy,unit:'C'};\nreturn msg;",
        "outputs": 1,
        "x": 450,
        "y": 80,
        "wires": [
            [
                "55079425775637d9",
                "512fb36647226d10"
            ]
        ]
    },
    {
        "id": "55079425775637d9",
        "type": "async-api-red",
        "z": "db6486d1d2cd59d6",
        "g": "5b08965eee815217",
        "name": "Thermostat AsyncAPI",
        "x": 700,
        "y": 80,
        "wires": [
            [
                "559b9f04cf93c275"
            ]
        ]
    },
    {
        "id": "559b9f04cf93c275",
        "type": "debug",
        "z": "db6486d1d2cd59d6",
        "g": "5b08965eee815217",
        "name": "Thermostat Debug",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "x": 900,
        "y": 80,
        "wires": []
    },
    {
        "id": "512fb36647226d10",
        "type": "ui_text",
        "z": "db6486d1d2cd59d6",
        "g": "5b08965eee815217",
        "group": "",
        "order": 1,
        "width": "",
        "height": "",
        "name": "",
        "label": "Thermostat",
        "format": "Temp: {{msg.payload.temperature}}C | Mode: {{msg.payload.mode}} | Energy: {{msg.payload.energyUsed.toFixed(2)}} kWh",
        "layout": "",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 700,
        "y": 140,
        "wires": []
    },
    {
        "id": "01573af29b531a78",
        "type": "inject",
        "z": "db6486d1d2cd59d6",
        "g": "4575d7c456ea2458",
        "name": "Inject AC State",
        "props": [],
        "repeat": "5",
        "once": true,
        "x": 200,
        "y": 330,
        "wires": [
            [
                "4d738e0fc0f1352c"
            ]
        ]
    },
    {
        "id": "4d738e0fc0f1352c",
        "type": "function",
        "z": "db6486d1d2cd59d6",
        "g": "4575d7c456ea2458",
        "name": "AC State & Energy",
        "func": "const state=Math.random()>0.5?'ON':'OFF';\nlet energy=flow.get('energy.ac')||0;\nif(state==='ON') energy+=0.2;\nflow.set('energy.ac',energy);\nmsg.payload={state:state,energyUsed:energy,mode:'cooling'};\nreturn msg;",
        "outputs": 1,
        "x": 450,
        "y": 330,
        "wires": [
            [
                "a946ef667e501665",
                "91288be2c27b7ea4"
            ]
        ]
    },
    {
        "id": "a946ef667e501665",
        "type": "async-api-red",
        "z": "db6486d1d2cd59d6",
        "g": "4575d7c456ea2458",
        "name": "AC AsyncAPI",
        "x": 700,
        "y": 330,
        "wires": [
            [
                "0ab73cc9fa9c5c90"
            ]
        ]
    },
    {
        "id": "0ab73cc9fa9c5c90",
        "type": "debug",
        "z": "db6486d1d2cd59d6",
        "g": "4575d7c456ea2458",
        "name": "AC Debug",
        "active": true,
        "tosidebar": true,
        "complete": "payload",
        "x": 900,
        "y": 330,
        "wires": []
    },
    {
        "id": "91288be2c27b7ea4",
        "type": "ui_text",
        "z": "db6486d1d2cd59d6",
        "g": "4575d7c456ea2458",
        "group": "",
        "order": 1,
        "width": "",
        "height": "",
        "name": "",
        "label": "AC",
        "format": "State: {{msg.payload.state}} | Energy: {{msg.payload.energyUsed.toFixed(2)}} kWh",
        "layout": "",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 700,
        "y": 390,
        "wires": []
    },
    {
        "id": "07d92834eb8e47f5",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "c99ee48a54796f90",
        "name": "AC Telemetry",
        "func": "// === Air Conditioner Telemetry Simulator (Smart Plug Controlled) ===\n\n// --- Check Smart Plug state ---\nconst plugState = global.get('acState') || 'off';\nif (plugState !== 'on') {\n    node.status({ fill: 'grey', shape: 'ring', text: 'Plug OFF  telemetry paused' });\n    return null; // stop execution when AC plug is off\n}\n\n// --- Environment values ---\nlet envTemp = parseFloat(msg.payload.temperature || 25);\nlet envHumidity = msg.payload.humidity || 50;\n\n// --- Persistent setpoint (holds same for 1 hour) ---\nlet setpoint = flow.get('ac.setpoint');\nlet setpointTimer = flow.get('ac.setpointTimer') || 0;\n\n// Initialize or refresh setpoint every 3600 simulated seconds\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale; // seconds per tick\nsetpointTimer += tickDuration;\n\nif (!setpoint || setpointTimer >= 3600) {\n    setpoint = Math.floor(16 + Math.random() * 15); // 1630C\n    setpointTimer = 0;\n}\n\n// --- Current temperature drift ---\nlet current = flow.get('ac.currentTemp') || envTemp;\ncurrent += (Math.random() - 0.5) * 0.3; // small drift 0.15C\n\n// --- Determine AC mode ---\nlet mode = 'idle';\nlet currentPower = 0; // Watts\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    currentPower = 1200; // cooling\n    current -= 0.5;\n} else if (current < setpoint - 1) {\n    mode = 'heat';\n    currentPower = 2000; // heating\n    current += 0.5;\n}\n\n// --- Energy tracking (kWh) ---\nlet energy = flow.get('energy.ac') || 0;\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\nif (currentPower > 0) energy += wattToKwh(currentPower, tickDuration);\n\n// --- Save state ---\nflow.set('ac.setpoint', setpoint);\nflow.set('ac.setpointTimer', setpointTimer);\nflow.set('ac.currentTemp', current);\nflow.set('energy.ac', energy);\n\n// --- Node status feedback ---\nlet color = \"grey\";\nlet shape = \"ring\";\nlet text = \"\";\n\nif (mode === 'cool') {\n    color = \"blue\";\n    shape = \"dot\";\n    text = `Cooling | ${current.toFixed(1)}C  ${setpoint}C | ${currentPower} W`;\n} else if (mode === 'heat') {\n    color = \"red\";\n    shape = \"dot\";\n    text = `Heating | ${current.toFixed(1)}C  ${setpoint}C | ${currentPower} W`;\n} else {\n    color = \"green\";\n    shape = \"ring\";\n    text = `Idle | ${current.toFixed(1)}C | 0 W`;\n}\n\nnode.status({ fill: color, shape: shape, text: text });\n\n// --- Telemetry output ---\nmsg.payload = {\n    device: \"ac\",\n    power: plugState,             // on/off from smart plug\n    temperature: parseFloat(current.toFixed(1)),\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    currentPower: currentPower,   // instantaneous Watts\n    energyUsed: parseFloat(energy.toFixed(3)), // cumulative kWh\n    unit: \"C\",\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2140,
        "y": 420,
        "wires": [
            [
                "598f2008fafaa0f4"
            ]
        ]
    },
    {
        "id": "598f2008fafaa0f4",
        "type": "async-api-red",
        "z": "4f4855f52107b72b",
        "g": "c99ee48a54796f90",
        "name": "AC AsyncAPI",
        "x": 2390,
        "y": 420,
        "wires": [
            [
                "fc5e972c26387247",
                "94935853959483b3"
            ]
        ]
    },
    {
        "id": "fc5e972c26387247",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "c99ee48a54796f90",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 2590,
        "y": 400,
        "wires": []
    },
    {
        "id": "func_lights",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "lights_group",
        "name": "Lights Telemetry",
        "func": "// === Smart Light Telemetry Simulator (Controlled by Smart Plug) ===\n\n// --- Check Smart Plug state first ---\nconst plugState = global.get('lightState') || 'off';\nif (plugState !== 'on') {\n    node.status({ fill: 'grey', shape: 'ring', text: 'Plug OFF  telemetry paused' });\n    return null; // stop simulation when plug is off\n}\n\n// --- Environment info ---\nlet envTemp = parseFloat(msg.payload.temperature || 22);\nlet envHumidity = msg.payload.humidity || 45;\nlet envLight = msg.payload.lightIntensity || 50;\n\n// --- Threshold for turning lights ON/OFF (0100) ---\nconst lightThreshold = 30;\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// --- Light behavior when ON ---\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// --- Energy tracking (kWh) ---\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0; // W\nenergy += (power / 1000) * (tickSeconds / 3600); // convert to kWh\nflow.set('energy.light', parseFloat(energy.toFixed(3)));\n\n// --- Node status for dashboard ---\nlet colorStatus = state === \"ON\" ? \"green\" : \"red\";\nlet shape = state === \"ON\" ? \"dot\" : \"ring\";\nlet text = `${state} | ${power.toFixed(1)} W`;\n\nnode.status({ fill: colorStatus, shape: shape, text: text });\n\n// --- Telemetry output ---\nmsg.payload = {\n    device: \"light\",\n    power: plugState, // shows if plug is ON/OFF\n    state: state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: parseFloat(energy.toFixed(3)), // cumulative kWh\n    voltage: 230,\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2140,
        "y": 600,
        "wires": [
            [
                "asyncapi_lights"
            ]
        ]
    },
    {
        "id": "asyncapi_lights",
        "type": "async-api-red",
        "z": "4f4855f52107b72b",
        "g": "lights_group",
        "name": "Lights AsyncAPI",
        "x": 2400,
        "y": 600,
        "wires": [
            [
                "debug_lights",
                "94935853959483b3"
            ]
        ]
    },
    {
        "id": "debug_lights",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "lights_group",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 2630,
        "y": 560,
        "wires": []
    },
    {
        "id": "func_fridge",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "fridge_group",
        "name": "Fridge Telemetry",
        "func": "// === Fridge & Freezer Telemetry Simulator (Safe Temperatures) ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;     // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") ?? fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") ?? freezerSet + (Math.random() * 2 - 1);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;  // seconds per tick\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);   // 0.2C\nfreezerTemp += (Math.random() * 0.6 - 0.3);  // 0.3C\n\n// Compressor state logic\nlet compressor = \"OFF\";\nlet currentPower = 5; // idle watts\n\nif (fridgeTemp > fridgeSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3;  // small decrement per tick\n    if (fridgeTemp < fridgeSet) fridgeTemp = fridgeSet; // prevent overcooling\n    currentPower = 150;\n}\n\nif (freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    freezerTemp -= 0.5;\n    if (freezerTemp < freezerSet) freezerTemp = freezerSet; // prevent overcooling\n    currentPower = 150;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\nenergy += wattToKwh(currentPower, tickSeconds);\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// --- Node status visual feedback ---\nlet color = \"grey\";\nlet shape = \"ring\";\nlet text = \"\";\n\nif (doorStatus !== \"closed\") {\n    color = \"red\";\n    shape = \"dot\";\n    text = ` Door Open (${doorStatus.replace(\"_\", \" \")}) | ${currentPower} W`;\n} else if (compressor === \"ON\") {\n    color = \"blue\";\n    shape = \"dot\";\n    text = `Cooling ON | ${fridgeTemp.toFixed(1)}C / ${freezerTemp.toFixed(1)}C | ${currentPower} W`;\n} else {\n    color = \"green\";\n    shape = \"ring\";\n    text = `Stable | ${fridgeTemp.toFixed(1)}C / ${freezerTemp.toFixed(1)}C | ${currentPower} W`;\n}\n\nnode.status({ fill: color, shape: shape, text });\n\n// --- Telemetry payload ---\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    currentPower: currentPower, // instantaneous W\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 780,
        "wires": [
            [
                "asyncapi_fridge"
            ]
        ]
    },
    {
        "id": "asyncapi_fridge",
        "type": "async-api-red",
        "z": "4f4855f52107b72b",
        "g": "fridge_group",
        "name": "Fridge AsyncAPI",
        "x": 2400,
        "y": 780,
        "wires": [
            [
                "debug_fridge",
                "94935853959483b3"
            ]
        ]
    },
    {
        "id": "debug_fridge",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "fridge_group",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 2660,
        "y": 800,
        "wires": []
    },
    {
        "id": "asyncapi_launder",
        "type": "async-api-red",
        "z": "4f4855f52107b72b",
        "g": "launder_group",
        "name": "Launder AsyncAPI",
        "x": 2390,
        "y": 1000,
        "wires": [
            [
                "debug_launder",
                "94935853959483b3"
            ]
        ]
    },
    {
        "id": "debug_launder",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "launder_group",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 2640,
        "y": 1020,
        "wires": []
    },
    {
        "id": "func_dehumidifier",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "dehumidifier_group",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator (Auto Stop/Start by Humidity) ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1; // seconds per tick\nconst tickMinutes = 1 * scale; // 1 tick = 1 minute\n\n// --- Persistent state ---\nlet running = flow.get('dehumidifier.running');\nif (running === undefined) running = true;\n\nlet tankLevel = flow.get('dehumidifier.tankLevel') || 0;\nlet elapsedMinutes = flow.get('dehumidifier.elapsedMinutes') || 0;\n\n// Fixed mode and fan speed\nconst mode = \"auto\";\nconst fanSpeed = \"medium\";\n\n// Random environment humidity\nlet environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\n\n// --- Auto Stop/Start logic ---\nif (environmentHumidity <= 50) {\n    running = false; // stop dehumidifier\n} else if (environmentHumidity > 50) {\n    running = true;  // start dehumidifier\n}\n\n// Power settings\nconst powerWatts = running ? 200 : 0; // instantaneous Watts\n\n// --- Run logic ---\nif (running) {\n    // Increment elapsed time\n    elapsedMinutes += tickMinutes;\n\n    // Gradual tank filling step-by-step (small random increment per minute)\n    const humidityRemoved = parseFloat((Math.random() * 2 + 0.5).toFixed(2)); // 0.52.5% per tick\n    tankLevel = Math.min(100, tankLevel + humidityRemoved);\n\n    // Reset tank if full or after 60 min\n    if (tankLevel >= 100 || elapsedMinutes >= 60) {\n        tankLevel = 0;\n        elapsedMinutes = 0;\n    }\n}\n\n// --- Energy tracking (kWh) ---\nlet energy = flow.get('energy.dehumidifier') || 0;\nfunction wattToKwh(powerWatts, minutes) {\n    return (powerWatts / 1000) * (minutes / 60);\n}\nif (powerWatts > 0) energy += wattToKwh(powerWatts, tickMinutes);\n\n// --- Save persistent state ---\nflow.set('dehumidifier.running', running);\nflow.set('dehumidifier.tankLevel', tankLevel);\nflow.set('dehumidifier.elapsedMinutes', elapsedMinutes);\nflow.set('energy.dehumidifier', energy);\n\n// --- Node status feedback ---\nlet color = running ? \"blue\" : \"grey\";\nlet shape = running ? \"dot\" : \"ring\";\n\n// Calculate progress as percentage of 60 min run\nconst progressPercent = Math.min(100, Math.round((elapsedMinutes / 60) * 100));\nlet text = running \n    ? `${environmentHumidity}% | ${mode.toUpperCase()} | ${powerWatts} W `\n    : `${environmentHumidity}% | OFF | 0 W `;\n\n// Update node status\nnode.status({ fill: color, shape: shape, text: text });\n\n// --- Telemetry payload ---\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    progressPercent: progressPercent,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    currentPower: powerWatts,\n    humidity: environmentHumidity,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2160,
        "y": 1200,
        "wires": [
            [
                "asyncapi_dehumidifier"
            ]
        ]
    },
    {
        "id": "asyncapi_dehumidifier",
        "type": "async-api-red",
        "z": "4f4855f52107b72b",
        "g": "dehumidifier_group",
        "name": "Dehumidifier AsyncAPI",
        "x": 2410,
        "y": 1200,
        "wires": [
            [
                "debug_dehumidifier",
                "94935853959483b3"
            ]
        ]
    },
    {
        "id": "debug_dehumidifier",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "dehumidifier_group",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 2720,
        "y": 1180,
        "wires": []
    },
    {
        "id": "func_cooker",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "cooker_group",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator (30 min Standard Mode) ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1; // seconds per tick\nconst tickSeconds = 1 * scale; // 1 tick = 1 real second\n\n// Check Smart Plug state\nconst plugState = global.get('cookerState') || 'off';\nif (plugState !== 'on') {\n    node.status({ fill: 'grey', shape: 'ring', text: 'Plug OFF  telemetry paused' });\n    return null;\n}\n\nlet running = true;\n\n// Standard fixed mode\nconst mode = \"bake\"; // standard mode\n\n// Persistent timer in seconds\nlet remainingSeconds = flow.get('cooker.remainingSeconds');\nif (!remainingSeconds) {\n    remainingSeconds = 30 * 60; // 30 minutes in seconds\n}\n\n// Update timer\nif (running) {\n    remainingSeconds = Math.max(0, remainingSeconds - tickSeconds);\n    if (remainingSeconds === 0) running = false;\n}\n\n// Temperatures\nconst currentTemp = running ? 180 : 25; // standard bake temp\nconst setTemp = running ? 200 : 0;\n\n// Instantaneous power in Watts\nconst powerWatts = running ? 1500 : 0;\n\n// Energy tracking in kWh\nlet energy = flow.get('energy.cooker') || 0;\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\nif (running) energy += wattToKwh(powerWatts, tickSeconds);\nflow.set('energy.cooker', energy);\n\n// Save persistent timer\nflow.set('cooker.remainingSeconds', remainingSeconds);\n\n// --- Node status feedback ---\nlet color = running ? \"orange\" : \"grey\";\nlet shape = running ? \"dot\" : \"ring\";\nlet minutesLeft = Math.ceil(remainingSeconds / 60); // only minutes, round up\n\nlet text = running \n    ? `${mode.toUpperCase()} | ${currentTemp}C  ${setTemp}C | ${minutesLeft} min left | ${powerWatts} W`\n    : `OFF | Temp: ${currentTemp}C | 0 W`;\n\nnode.status({ fill: color, shape: shape, text });\n\n// --- Telemetry payload ---\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode,\n    setTemp,\n    currentTemp,\n    timerMinutes: minutesLeft,\n    energyUsed: parseFloat(energy.toFixed(3)), // cumulative kWh\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 1400,
        "wires": [
            [
                "asyncapi_cooker"
            ]
        ]
    },
    {
        "id": "asyncapi_cooker",
        "type": "async-api-red",
        "z": "4f4855f52107b72b",
        "g": "cooker_group",
        "name": "Cooker AsyncAPI",
        "x": 2490,
        "y": 1400,
        "wires": [
            [
                "debug_cooker",
                "94935853959483b3"
            ]
        ]
    },
    {
        "id": "debug_cooker",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "cooker_group",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 2740,
        "y": 1400,
        "wires": []
    },
    {
        "id": "1915adae0ac41c37",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "19609f77c4ba5897",
        "name": "Thermostat Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2670,
        "y": 180,
        "wires": []
    },
    {
        "id": "dbd082096676a420",
        "type": "async-api-red",
        "z": "4f4855f52107b72b",
        "g": "19609f77c4ba5897",
        "name": " Thermostat AsyncAPI",
        "x": 2420,
        "y": 240,
        "wires": [
            [
                "1915adae0ac41c37",
                "94935853959483b3"
            ]
        ]
    },
    {
        "id": "577012c85e361b8b",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "6578bf7b191c43b7",
        "name": "Sim Clock Trigger",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": "0.1",
        "topic": "",
        "x": 730,
        "y": 960,
        "wires": [
            [
                "8084d0c60d963452"
            ]
        ]
    },
    {
        "id": "94935853959483b3",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "name": "Total Energy Calculator",
        "func": "let devices = ['ac', 'light', 'fridge', 'laundry', 'dehumidifier', 'cooker', 'thermostat'];\nlet hours = flow.get('hours') || 1; // time period in hours\n\n// Sum all device energy values\nlet totalW = devices.reduce((sum, d) => sum + (flow.get(`energy.${d}`) || 0), 0);\nlet totalKWh = totalW * hours / 1000;\n\n// Round and prepare output\nmsg.totalEnergy = `${totalKWh.toFixed(3)} kWh`;\n\n// --- Node status display ---\nlet color = \"green\";\nlet shape = \"dot\";\nlet text = `Total: ${totalKWh.toFixed(3)} kWh`;\n\nif (totalKWh === 0) {\n    color = \"grey\";\n    shape = \"ring\";\n    text = \"No energy recorded\";\n}\n\nnode.status({ fill: color, shape: shape, text });\n\n// Output message\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3390,
        "y": 660,
        "wires": [
            [
                "d7982dd2528420ba"
            ]
        ]
    },
    {
        "id": "d7982dd2528420ba",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3590,
        "y": 1040,
        "wires": []
    },
    {
        "id": "8084d0c60d963452",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "6578bf7b191c43b7",
        "name": "Environment Generator",
        "func": "// --- Simulation Scale ---\nif (!global.get(\"simulationScale\")) {\n    global.set(\"simulationScale\", 60); // 1s = 1 minute\n}\n\n// --- Realistic Environment Base ---\nconst baseTemp = 22; // C\nconst baseHumidity = 45; // %\nconst hour = new Date().getHours(); // local time for light simulation\n\n// Get previous state\nlet currentTemp = flow.get('env.temperature') || baseTemp;\nlet currentHumidity = flow.get('env.humidity') || baseHumidity;\nlet currentLight = flow.get('env.lightIntensity') || 50;\n\n// --- Apply small drift ---\ncurrentTemp += (Math.random() * 0.4 - 0.2); // 0.2C\ncurrentHumidity += (Math.random() * 2 - 1);  // 1%\ncurrentHumidity = Math.max(20, Math.min(70, currentHumidity)); // clamp realistic\n// Light based on time of day\nif (hour >= 6 && hour < 18) {\n    currentLight = 70 + Math.floor(Math.random() * 30); // day\n} else {\n    currentLight = 0 + Math.floor(Math.random() * 20);  // night\n}\n\n// Save state for next tick\nflow.set('env.temperature', currentTemp);\nflow.set('env.humidity', currentHumidity);\nflow.set('env.lightIntensity', currentLight);\nflow.set('current_temp', currentTemp);\n\n// --- Output payload ---\nmsg.payload = {\n    environment: true,\n    temperature: currentTemp.toFixed(1),\n    humidity: currentHumidity.toFixed(1),\n    lightIntensity: currentLight,\n    unit: \"C\",\n    simulationScale: global.get(\"simulationScale\")\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 960,
        "wires": [
            [
                "07d92834eb8e47f5",
                "func_lights",
                "func_fridge",
                "func_laundry_telemetry",
                "func_dehumidifier",
                "func_cooker",
                "f8959e1f024fcb3c"
            ]
        ]
    },
    {
        "id": "dbcecb9927394929",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "876a8dac7a94efab",
        "name": "SMARTHOME",
        "info": "",
        "x": 220,
        "y": 120,
        "wires": []
    },
    {
        "id": "func_laundry_telemetry",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "launder_group",
        "name": "Laundry Telemetry",
        "func": "// --- Full Washing Machine Cycle Simulator ---\n\n// --- Simulation scale ---\nconst scale = global.get(\"simulationScale\") || 60; // seconds per tick\nconst tickSeconds = 60 * scale; // 1 tick = 1 minute\n\n// --- Check Smart Plug / power ---\nconst plugState = global.get('laundryState') || 'off';\nif (plugState !== 'on') {\n    node.status({ fill: 'grey', shape: 'ring', text: 'Plug OFF  cycle paused' });\n    return null;\n}\n\n// --- Load persistent state ---\nlet phase = flow.get('laundry.phase') || 'idle';\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || (plugState === 'on' ? true:false);\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\nlet mode = flow.get('laundry.mode') || 'normal';\n\n// --- Phase durations per mode (minutes) ---\nconst modeDurations = {\n    eco: { filling:5, washing:60, rinsing:15, spinning:10, drying:30 },\n    normal: { filling:5, washing:45, rinsing:15, spinning:10, drying:20 },\n    quick: { filling:3, washing:20, rinsing:10, spinning:5, drying:10 },\n    heavy: { filling:5, washing:75, rinsing:20, spinning:15, drying:40 },\n    delicate: { filling:5, washing:30, rinsing:15, spinning:5, drying:10 }\n};\n\n// --- Power per phase (Watts) ---\nconst phasePower = { filling:50, washing:500, rinsing:300, spinning:800, drying:2000, completed:0 };\n\n// --- Start new cycle if idle ---\nif (!running && phase === 'idle') {\n    running = true;\n    const modes = Object.keys(modeDurations);\n    mode = modes[Math.floor(Math.random() * modes.length)];\n    phase = 'filling';\n    remainingTime = modeDurations[mode][phase];\n}\n\n// --- Progress cycle ---\nif (running) {\n    remainingTime -= 1 * scale;\n\n    if (remainingTime <= 0) {\n        const phases = ['filling','washing','rinsing','spinning','drying'];\n        const currentIndex = phases.indexOf(phase);\n\n        if (currentIndex < phases.length - 1) {\n            phase = phases[currentIndex + 1];\n            remainingTime = modeDurations[mode][phase];\n        } else {\n            // Cycle completed\n            phase = 'completed';\n            running = false;\n            remainingTime = 0;\n        }\n    }\n}\n\n// --- Instantaneous power ---\nlet currentPower = running ? phasePower[phase] || 0 : 0;\n\n// --- Energy usage (kWh) ---\nenergy += (currentPower / 1000) * (tickSeconds / 3600);\n\n// --- Water usage ---\nif (['filling','washing','rinsing'].includes(phase)) {\n    waterUsed += Math.random() * 0.5 * scale;\n}\n\n// --- Simulated values ---\nlet waterTemp = (phase === 'washing') ? 40 + Math.random()*10 : 25;\nlet spinSpeed = (phase === 'spinning') ? 800 + Math.floor(Math.random()*400) : 0;\nlet loadWeight = 5 + Math.random()*3;\n\n// --- Door status ---\nlet doorStatus = (running || phase === 'completed') ? 'locked' : 'closed';\n\n// --- Save state ---\nflow.set('laundry.phase', phase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\nflow.set('laundry.mode', mode);\n\n// --- Node status feedback ---\nlet color = \"grey\", shape = \"ring\", text = \"\";\n\nif (!running && phase === 'completed') {\n    color = 'green';\n    shape = 'ring';\n    text = ` Cycle Completed | 0 W`;\n} else if (running) {\n    color = 'blue';\n    shape = 'dot';\n    text = `${phase.toUpperCase()} | ${remainingTime} min left | ${currentPower} W`;\n}\n\nif (doorStatus === 'open') {\n    color = 'red';\n    text = ' Door Open';\n}\n\nnode.status({ fill: color, shape: shape, text: text });\n\n// --- Telemetry payload ---\nmsg.payload = {\n    device: 'laundry',\n    power: 'ON',\n    running,\n    mode,\n    phase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)), // cumulative kWh\n    currentPower: currentPower, // instantaneous Watts\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 1000,
        "wires": [
            [
                "asyncapi_launder"
            ]
        ]
    },
    {
        "id": "7beea3e98437718c",
        "type": "http in",
        "z": "4f4855f52107b72b",
        "g": "50d822b0af5cc61a",
        "name": "[POST] Smartplug Webhook",
        "url": "/smartplug/thermostat/webhook",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 440,
        "y": 2240,
        "wires": [
            [
                "4e8d16b83fa2b771"
            ]
        ]
    },
    {
        "id": "4e8d16b83fa2b771",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "50d822b0af5cc61a",
        "name": "Handle Webhook State",
        "func": "// Parse desired state\nlet newState = (msg.payload.state || '').toLowerCase();\n\nif (!['on', 'off'].includes(newState)) {\n    msg.statusCode = 400;\n    msg.payload = { error: 'Invalid state. Use \"on\" or \"off\".' };\n    return msg;\n}\n\n// Save new state\nglobal.set('smartplug.state', newState);\nflow.set('smartplug_state', newState);\n\n\nmsg.statusCode = 200;\nmsg.payload = {\n    message: `Smart plug turned ${newState}`,\n    state: newState,\n    timestamp: new Date().toISOString()\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 2240,
        "wires": [
            [
                "0dc74f1972d85f33"
            ]
        ]
    },
    {
        "id": "0dc74f1972d85f33",
        "type": "http response",
        "z": "4f4855f52107b72b",
        "g": "50d822b0af5cc61a",
        "name": "Response (POST)",
        "statusCode": "",
        "headers": {
            "content-type": "application/json"
        },
        "x": 940,
        "y": 2240,
        "wires": []
    },
    {
        "id": "792d16844e582310",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "50d822b0af5cc61a",
        "name": "webhook endpoint for thermostat",
        "info": "",
        "x": 450,
        "y": 2180,
        "wires": []
    },
    {
        "id": "5e636eef5daa1b5f",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "881db607590cd279",
        "name": "Smartplug for thermostat",
        "info": "",
        "x": 570,
        "y": 160,
        "wires": []
    },
    {
        "id": "ddf88dd27e263bd5",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "881db607590cd279",
        "name": "State -> ON",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"on\"}",
        "payloadType": "json",
        "x": 570,
        "y": 220,
        "wires": [
            [
                "d19baf00cf51bded"
            ]
        ]
    },
    {
        "id": "0776bc1099a8818c",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "881db607590cd279",
        "name": "State -> OFF",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"off\"}",
        "payloadType": "json",
        "x": 560,
        "y": 290,
        "wires": [
            [
                "d19baf00cf51bded"
            ]
        ]
    },
    {
        "id": "91dad80f577e2b9f",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "881db607590cd279",
        "name": "Save SmartPlug State",
        "func": "if (msg.payload && msg.payload.state) {\n    global.set('thermostatState', msg.payload.state);\n    node.status({fill: msg.payload.state === 'on' ? 'green' : 'red', shape: 'dot', text: `Plug ${msg.payload.state}`});\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 260,
        "wires": [
            [
                "f8959e1f024fcb3c"
            ]
        ]
    },
    {
        "id": "f8959e1f024fcb3c",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "19609f77c4ba5897",
        "name": "Thermostat Telemetry",
        "func": "// Check Smart Plug state before running\nconst plugState = global.get('thermostatState') || 'off';\nif (plugState !== 'on') {\n    node.status({ fill: 'grey', shape: 'ring', text: 'Plug OFF  telemetry paused' });\n    return null; // stop execution\n}\n\n// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature || 22); // default 22C\nlet envHumidity = msg.payload.humidity || 45;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nlet currentPower = 0; // W\n\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5;\n    currentPower = 2000; // heater power in W\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5;\n    currentPower = 1200; // AC power in W\n}\n\n// Energy tracking (cumulative kWh)\nlet energy = flow.get('energy.thermostat') || 0;\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale; // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\n// Add to cumulative energy\nenergy += wattToKwh(currentPower, tickDuration);\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// --- Node status for visual feedback ---\nlet color = 'grey';\nlet shape = 'ring';\nlet text = 'Idle';\n\nif (mode === 'heat') {\n    color = 'red';\n    shape = 'dot';\n    text = `HEAT | ${current.toFixed(1)}C  ${desired}C | ${currentPower} W`;\n} else if (mode === 'cool') {\n    color = 'blue';\n    shape = 'dot';\n    text = `COOL | ${current.toFixed(1)}C  ${desired}C | ${currentPower} W`;\n} else {\n    text = `IDLE | ${current.toFixed(1)}C | 0 W`;\n}\n\nnode.status({ fill: color, shape: shape, text });\n\n// --- Telemetry output ---\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    power: plugState,       // instantaneous W\n    energyUsed: parseFloat(energy.toFixed(3)), // cumulative kWh\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2160,
        "y": 240,
        "wires": [
            [
                "dbd082096676a420"
            ]
        ]
    },
    {
        "id": "57eefc9f63239b74",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "881db607590cd279",
        "name": "Smartplug debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 180,
        "wires": []
    },
    {
        "id": "d19baf00cf51bded",
        "type": "openApi-red",
        "z": "4f4855f52107b72b",
        "g": "881db607590cd279",
        "name": "Thermostat webhook",
        "configUrlNode": "f2d3a14b35277c31",
        "apiTag": "SmartPlug",
        "keepAuth": false,
        "operationData": {
            "id": "setSmartPlugState",
            "hasOperationId": true,
            "path": "/smartplug/webhook",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "text": "",
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "activeFilter": "",
                "type": "editor:Request body",
                "parameters": {
                    "state": {
                        "name": "state",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "msg",
                        "value": "payload.state"
                    }
                },
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "successful",
                "text": "all successful responses (2xx)"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 860,
        "y": 260,
        "wires": [
            [
                "91dad80f577e2b9f",
                "57eefc9f63239b74"
            ]
        ]
    },
    {
        "id": "7b0894f417168af4",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "e2e99964236f8675",
        "name": "Smartplug for cooker",
        "info": "",
        "x": 550,
        "y": 1740,
        "wires": []
    },
    {
        "id": "a3255351da27c4c9",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "e2e99964236f8675",
        "name": "State -> ON",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"on\"}",
        "payloadType": "json",
        "x": 570,
        "y": 1800,
        "wires": [
            [
                "14fd1ecf6e17d3c3"
            ]
        ]
    },
    {
        "id": "f3aa31b745aa88b8",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "e2e99964236f8675",
        "name": "State -> OFF",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"off\"}",
        "payloadType": "json",
        "x": 560,
        "y": 1870,
        "wires": [
            [
                "14fd1ecf6e17d3c3"
            ]
        ]
    },
    {
        "id": "43a4f2d07be30783",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "e2e99964236f8675",
        "name": "Save SmartPlug State",
        "func": "if (msg.payload && msg.payload.state) {\n    global.set('cookerState', msg.payload.state);\n    node.status({fill: msg.payload.state === 'on' ? 'green' : 'red', shape: 'dot', text: `Plug ${msg.payload.state}`});\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 1840,
        "wires": [
            [
                "func_cooker"
            ]
        ]
    },
    {
        "id": "58d6581bc5500dc9",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "e2e99964236f8675",
        "name": "Smartplug debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 1740,
        "wires": []
    },
    {
        "id": "14fd1ecf6e17d3c3",
        "type": "openApi-red",
        "z": "4f4855f52107b72b",
        "g": "e2e99964236f8675",
        "name": "Cooker webhook",
        "configUrlNode": "742282c109ee77de",
        "apiTag": "SmartPlug",
        "keepAuth": false,
        "operationData": {
            "id": "setCookerPlugState",
            "hasOperationId": true,
            "path": "/smartplug/cooker/webhook",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "text": "",
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "activeFilter": "",
                "type": "editor:Request body",
                "parameters": {
                    "state": {
                        "name": "state",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "msg",
                        "value": "payload.state"
                    }
                },
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 2,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "Cooker Smart Plug state successfully changed"
            },
            {
                "code": "400",
                "text": "Invalid state specified"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 850,
        "y": 1840,
        "wires": [
            [
                "43a4f2d07be30783"
            ],
            [
                "58d6581bc5500dc9"
            ]
        ]
    },
    {
        "id": "ebcda5c59f9a16f1",
        "type": "http in",
        "z": "4f4855f52107b72b",
        "g": "d2748fb7d73cced7",
        "name": "[POST] Smartplug Webhook",
        "url": "/smartplug/cooker/webhook",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 1280,
        "y": 2240,
        "wires": [
            [
                "c4e7455fb216592d"
            ]
        ]
    },
    {
        "id": "c4e7455fb216592d",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "d2748fb7d73cced7",
        "name": "Handle Webhook State",
        "func": "// Parse desired state\nlet newState = (msg.payload.state || '').toLowerCase();\n\nif (!['on', 'off'].includes(newState)) {\n    msg.statusCode = 400;\n    msg.payload = { error: 'Invalid state. Use \"on\" or \"off\".' };\n    return msg;\n}\n\n// Save new state\nglobal.set('smartplug.state', newState);\nflow.set('smartplug_state', newState);\n\n\nmsg.statusCode = 200;\nmsg.payload = {\n    message: `Smart plug turned ${newState}`,\n    state: newState,\n    timestamp: new Date().toISOString()\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1540,
        "y": 2240,
        "wires": [
            [
                "79b596b657bb6429"
            ]
        ]
    },
    {
        "id": "79b596b657bb6429",
        "type": "http response",
        "z": "4f4855f52107b72b",
        "g": "d2748fb7d73cced7",
        "name": "Response (POST)",
        "statusCode": "",
        "headers": {
            "content-type": "application/json"
        },
        "x": 1780,
        "y": 2240,
        "wires": []
    },
    {
        "id": "1e8883acb1fd6cae",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "d2748fb7d73cced7",
        "name": "webhook endpoint for cooker",
        "info": "",
        "x": 1280,
        "y": 2180,
        "wires": []
    },
    {
        "id": "f7310e18baa39bd1",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "6578bf7b191c43b7",
        "name": "Enviroment variables",
        "info": "",
        "x": 720,
        "y": 900,
        "wires": []
    },
    {
        "id": "8a54f719f26ad8aa",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "45e26e30f704ad47",
        "name": "Smartplug for laundry",
        "info": "",
        "x": 560,
        "y": 1460,
        "wires": []
    },
    {
        "id": "67c5da6c604320b8",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "45e26e30f704ad47",
        "name": "State -> ON",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"on\"}",
        "payloadType": "json",
        "x": 570,
        "y": 1520,
        "wires": [
            [
                "3c3f82bfebc2ba37"
            ]
        ]
    },
    {
        "id": "11e4fbb90c6f9d1a",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "45e26e30f704ad47",
        "name": "State -> OFF",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"off\"}",
        "payloadType": "json",
        "x": 560,
        "y": 1590,
        "wires": [
            [
                "3c3f82bfebc2ba37"
            ]
        ]
    },
    {
        "id": "3474c5bf1ab29ecd",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "45e26e30f704ad47",
        "name": "Save SmartPlug State",
        "func": "if (msg.payload && msg.payload.state) {\n    global.set('laundryState', msg.payload.state);\n    node.status({fill: msg.payload.state === 'on' ? 'green' : 'red', shape: 'dot', text: `Plug ${msg.payload.state}`});\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 1560,
        "wires": [
            [
                "func_laundry_telemetry"
            ]
        ]
    },
    {
        "id": "f2a1daf9ebd965d6",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "45e26e30f704ad47",
        "name": "Smartplug debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 1460,
        "wires": []
    },
    {
        "id": "a3b4653f0cf6ae5d",
        "type": "http in",
        "z": "4f4855f52107b72b",
        "g": "fe7c6d62782a61e9",
        "name": "[POST] Smartplug laundry",
        "url": "/smartplug/laundry/webhook",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 2110,
        "y": 2240,
        "wires": [
            [
                "e94a1310f11d28ae"
            ]
        ]
    },
    {
        "id": "e94a1310f11d28ae",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "fe7c6d62782a61e9",
        "name": "Handle Webhook State",
        "func": "// Parse desired state\nlet newState = (msg.payload.state || '').toLowerCase();\n\nif (!['on', 'off'].includes(newState)) {\n    msg.statusCode = 400;\n    msg.payload = { error: 'Invalid state. Use \"on\" or \"off\".' };\n    return msg;\n}\n\n// Save new state\nglobal.set('smartplug.state', newState);\nflow.set('smartplug_state', newState);\n\n\nmsg.statusCode = 200;\nmsg.payload = {\n    message: `Smart plug turned ${newState}`,\n    state: newState,\n    timestamp: new Date().toISOString()\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2390,
        "y": 2240,
        "wires": [
            [
                "c6af873c12f6835f"
            ]
        ]
    },
    {
        "id": "c6af873c12f6835f",
        "type": "http response",
        "z": "4f4855f52107b72b",
        "g": "fe7c6d62782a61e9",
        "name": "Response (POST)",
        "statusCode": "",
        "headers": {},
        "x": 2670,
        "y": 2240,
        "wires": []
    },
    {
        "id": "7277ba557dca3273",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "fe7c6d62782a61e9",
        "name": "",
        "info": "",
        "x": 2060,
        "y": 2180,
        "wires": []
    },
    {
        "id": "3c3f82bfebc2ba37",
        "type": "openApi-red",
        "z": "4f4855f52107b72b",
        "g": "45e26e30f704ad47",
        "name": "",
        "configUrlNode": "a33f75c91933dc08",
        "apiTag": "Laundry",
        "keepAuth": false,
        "operationData": {
            "id": "setLaundryState",
            "hasOperationId": true,
            "path": "/smartplug/laundry/webhook",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "text": "",
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "activeFilter": "",
                "type": "editor:Request body",
                "parameters": {
                    "state": {
                        "name": "state",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "msg",
                        "value": "payload.state"
                    }
                },
                "selectedSchema": {
                    "name": "Request body"
                },
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 2,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "Laundry plug state successfully changed"
            },
            {
                "code": "400",
                "text": "Invalid state specified"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 820,
        "y": 1520,
        "wires": [
            [
                "3474c5bf1ab29ecd",
                "f2a1daf9ebd965d6"
            ],
            []
        ]
    },
    {
        "id": "6028a3ed46cca3d4",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "9be3feeb419a7b53",
        "name": "Webhooks Init",
        "info": "",
        "x": 390,
        "y": 2080,
        "wires": []
    },
    {
        "id": "4003081ec19ca6d6",
        "type": "http in",
        "z": "4f4855f52107b72b",
        "g": "abefde1276346b1c",
        "name": "[POST] Smartplug Webhook",
        "url": "/smartplug/lights/webhook",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 440,
        "y": 2460,
        "wires": [
            [
                "4deeabc6a75aae45"
            ]
        ]
    },
    {
        "id": "670d73bf79ea2a0d",
        "type": "http response",
        "z": "4f4855f52107b72b",
        "g": "abefde1276346b1c",
        "name": "Response (POST)",
        "statusCode": "",
        "headers": {},
        "x": 990,
        "y": 2460,
        "wires": []
    },
    {
        "id": "4deeabc6a75aae45",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "abefde1276346b1c",
        "name": "Handle Webhook State",
        "func": "// Parse desired state\nlet newState = (msg.payload.state || '').toLowerCase();\n\nif (!['on', 'off'].includes(newState)) {\n    msg.statusCode = 400;\n    msg.payload = { error: 'Invalid state. Use \"on\" or \"off\".' };\n    return msg;\n}\n\n// Save new state\nglobal.set('smartplug.state', newState);\nflow.set('smartplug_state', newState);\n\n\nmsg.statusCode = 200;\nmsg.payload = {\n    message: `Smart plug turned ${newState}`,\n    state: newState,\n    timestamp: new Date().toISOString()\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 2460,
        "wires": [
            [
                "670d73bf79ea2a0d"
            ]
        ]
    },
    {
        "id": "7cb36fb185a2217e",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "abefde1276346b1c",
        "name": "webhook endpoint for thermostat",
        "info": "",
        "x": 450,
        "y": 2400,
        "wires": []
    },
    {
        "id": "8fe7947781d8abaa",
        "type": "http in",
        "z": "4f4855f52107b72b",
        "g": "0d443770ff71eb54",
        "name": "[POST] Smartplug Webhook",
        "url": "/smartplug/ac/webhook",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 1360,
        "y": 2460,
        "wires": [
            [
                "883f36bae22e7492"
            ]
        ]
    },
    {
        "id": "e4d27f662a46cc39",
        "type": "http response",
        "z": "4f4855f52107b72b",
        "g": "0d443770ff71eb54",
        "name": "Response (POST)",
        "statusCode": "",
        "headers": {},
        "x": 1930,
        "y": 2460,
        "wires": []
    },
    {
        "id": "883f36bae22e7492",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "0d443770ff71eb54",
        "name": "Handle Webhook State",
        "func": "// Parse desired state\nlet newState = (msg.payload.state || '').toLowerCase();\n\nif (!['on', 'off'].includes(newState)) {\n    msg.statusCode = 400;\n    msg.payload = { error: 'Invalid state. Use \"on\" or \"off\".' };\n    return msg;\n}\n\n// Save new state\nglobal.set('smartplug.state', newState);\nflow.set('smartplug_state', newState);\n\n\nmsg.statusCode = 200;\nmsg.payload = {\n    message: `Smart plug turned ${newState}`,\n    state: newState,\n    timestamp: new Date().toISOString()\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1650,
        "y": 2460,
        "wires": [
            [
                "e4d27f662a46cc39"
            ]
        ]
    },
    {
        "id": "5fcd41c00a481bb9",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "0d443770ff71eb54",
        "name": "webhook endpoint for AC",
        "info": "",
        "x": 1350,
        "y": 2400,
        "wires": []
    },
    {
        "id": "c4d08d0f89251bfb",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "19609f77c4ba5897",
        "name": "Thermostat Device",
        "info": "",
        "x": 2150,
        "y": 180,
        "wires": []
    },
    {
        "id": "c966bb323b7cb3b5",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "c99ee48a54796f90",
        "name": "AC Device",
        "info": "",
        "x": 2120,
        "y": 360,
        "wires": []
    },
    {
        "id": "750e70a11320f07b",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "lights_group",
        "name": "Lights",
        "info": "",
        "x": 2110,
        "y": 540,
        "wires": []
    },
    {
        "id": "047e02ede737fd4b",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "fridge_group",
        "name": "Fridge Device",
        "info": "",
        "x": 2130,
        "y": 720,
        "wires": []
    },
    {
        "id": "7acf5abf8245e211",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "launder_group",
        "name": "Laundry Device",
        "info": "",
        "x": 2140,
        "y": 940,
        "wires": []
    },
    {
        "id": "f34984d5e6f1804a",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "dehumidifier_group",
        "name": "Dehimidifier Device",
        "info": "",
        "x": 2150,
        "y": 1140,
        "wires": []
    },
    {
        "id": "b8808b578daac992",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "cooker_group",
        "name": "Cooker Device",
        "info": "",
        "x": 2140,
        "y": 1340,
        "wires": []
    },
    {
        "id": "eed1f93db727e728",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "9c58429dd67aded0",
        "name": "Smartplug for laundry",
        "info": "",
        "x": 560,
        "y": 1180,
        "wires": []
    },
    {
        "id": "638a5cf47e62722e",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "9c58429dd67aded0",
        "name": "State -> ON",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"on\"}",
        "payloadType": "json",
        "x": 570,
        "y": 1240,
        "wires": [
            [
                "42a38b50701f7a16"
            ]
        ]
    },
    {
        "id": "8f8ef71dd8a15893",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "9c58429dd67aded0",
        "name": "State -> OFF",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"off\"}",
        "payloadType": "json",
        "x": 560,
        "y": 1310,
        "wires": [
            [
                "42a38b50701f7a16"
            ]
        ]
    },
    {
        "id": "e6fe9b42f4d79edf",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "9c58429dd67aded0",
        "name": "Save SmartPlug State",
        "func": "if (msg.payload && msg.payload.state) {\n    global.set('lightState', msg.payload.state);\n    node.status({fill: msg.payload.state === 'on' ? 'green' : 'red', shape: 'dot', text: `Plug ${msg.payload.state}`});\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 1280,
        "wires": [
            [
                "func_lights"
            ]
        ]
    },
    {
        "id": "4434127a410944ad",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "9c58429dd67aded0",
        "name": "Smartplug debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 1180,
        "wires": []
    },
    {
        "id": "42a38b50701f7a16",
        "type": "openApi-red",
        "z": "4f4855f52107b72b",
        "g": "9c58429dd67aded0",
        "name": "",
        "configUrlNode": "f63fb066d1c65936",
        "apiTag": "SmartPlug",
        "keepAuth": false,
        "operationData": {
            "id": "setLightsPlugState",
            "hasOperationId": true,
            "path": "/smartplug/lights/webhook",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "text": "",
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "activeFilter": "",
                "type": "editor:Request body",
                "parameters": {
                    "state": {
                        "name": "state",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "msg",
                        "value": "payload.state"
                    }
                },
                "selectedSchema": {
                    "name": "Request body"
                },
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 2,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "Smart Lights plug state successfully changed"
            },
            {
                "code": "400",
                "text": "Invalid state specified"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 870,
        "y": 1260,
        "wires": [
            [
                "e6fe9b42f4d79edf",
                "4434127a410944ad"
            ],
            []
        ]
    },
    {
        "id": "e6d51b72905c0448",
        "type": "comment",
        "z": "4f4855f52107b72b",
        "g": "d72e67c06e6e6132",
        "name": "Smartplug for thermostat",
        "info": "",
        "x": 550,
        "y": 480,
        "wires": []
    },
    {
        "id": "a7e74769d12738d5",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "d72e67c06e6e6132",
        "name": "State -> ON",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"on\"}",
        "payloadType": "json",
        "x": 550,
        "y": 540,
        "wires": [
            [
                "df8beacd24a634c0"
            ]
        ]
    },
    {
        "id": "beea24a1850466d6",
        "type": "inject",
        "z": "4f4855f52107b72b",
        "g": "d72e67c06e6e6132",
        "name": "State -> OFF",
        "props": [
            {
                "p": "payload"
            }
        ],
        "payload": "{\"state\":\"off\"}",
        "payloadType": "json",
        "x": 540,
        "y": 610,
        "wires": [
            [
                "df8beacd24a634c0"
            ]
        ]
    },
    {
        "id": "a66a27203f3dea31",
        "type": "function",
        "z": "4f4855f52107b72b",
        "g": "d72e67c06e6e6132",
        "name": "Save SmartPlug State",
        "func": "if (msg.payload && msg.payload.state) {\n    global.set('acState', msg.payload.state);\n    node.status({fill: msg.payload.state === 'on' ? 'green' : 'red', shape: 'dot', text: `Plug ${msg.payload.state}`});\n}\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 580,
        "wires": [
            [
                "07d92834eb8e47f5"
            ]
        ]
    },
    {
        "id": "4cc30fd54c279296",
        "type": "debug",
        "z": "4f4855f52107b72b",
        "g": "d72e67c06e6e6132",
        "name": "Smartplug debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 500,
        "wires": []
    },
    {
        "id": "df8beacd24a634c0",
        "type": "openApi-red",
        "z": "4f4855f52107b72b",
        "g": "d72e67c06e6e6132",
        "name": "",
        "configUrlNode": "",
        "apiTag": "",
        "keepAuth": false,
        "operationData": {},
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {},
        "parameters": {},
        "requestContentType": "",
        "responseContentType": "",
        "outputs": 1,
        "responseOutputLabels": [
            {
                "code": "default",
                "text": "default"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 840,
        "y": 540,
        "wires": [
            [
                "a66a27203f3dea31"
            ]
        ]
    },
    {
        "id": "home1",
        "type": "subflow:subflow_smarthome",
        "z": "tab_neighborhood",
        "name": "Home 1",
        "env": [
            {
                "name": "homeId",
                "value": "1",
                "type": "num"
            }
        ],
        "x": 180,
        "y": 100,
        "wires": []
    },
    {
        "id": "home2",
        "type": "subflow:subflow_smarthome",
        "z": "tab_neighborhood",
        "name": "Home 2",
        "env": [
            {
                "name": "homeId",
                "value": 2,
                "type": "num"
            }
        ],
        "x": 180,
        "y": 160,
        "wires": []
    },
    {
        "id": "home3",
        "type": "subflow:subflow_smarthome",
        "z": "tab_neighborhood",
        "name": "Home 3",
        "env": [
            {
                "name": "homeId",
                "value": 3,
                "type": "num"
            }
        ],
        "x": 180,
        "y": 220,
        "wires": []
    },
    {
        "id": "home4",
        "type": "subflow:subflow_smarthome",
        "z": "tab_neighborhood",
        "name": "Home 4",
        "env": [
            {
                "name": "homeId",
                "value": 4,
                "type": "num"
            }
        ],
        "x": 180,
        "y": 280,
        "wires": []
    },
    {
        "id": "home5",
        "type": "subflow:subflow_smarthome",
        "z": "tab_neighborhood",
        "name": "Home 5",
        "env": [
            {
                "name": "homeId",
                "value": 5,
                "type": "num"
            }
        ],
        "x": 180,
        "y": 340,
        "wires": []
    },
    {
        "id": "join_energy",
        "type": "join",
        "z": "tab_neighborhood",
        "name": "Join All Homes",
        "mode": "auto",
        "build": "array",
        "property": "payload",
        "propertyType": "msg",
        "useparts": true,
        "x": 420,
        "y": 220,
        "wires": [
            [
                "func_sum_energy"
            ]
        ]
    },
    {
        "id": "func_sum_energy",
        "type": "function",
        "z": "tab_neighborhood",
        "name": "Sum Neighborhood Energy",
        "func": "let total = 0;\nmsg.payload.forEach(h => total += h.energy);\nmsg.payload = {\n    totalEnergy: parseFloat(total.toFixed(2)),\n    homes: msg.payload\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 660,
        "y": 220,
        "wires": [
            [
                "ui_gauge_total",
                "ui_chart_total",
                "debug_total"
            ]
        ]
    },
    {
        "id": "ui_gauge_total",
        "type": "ui_gauge",
        "z": "tab_neighborhood",
        "name": "Total Neighborhood Energy",
        "group": "ui_group_neighborhood",
        "order": 1,
        "width": 6,
        "height": 3,
        "gtype": "gage",
        "title": "Neighborhood Energy",
        "label": "kWh",
        "format": "{{value}}",
        "min": 0,
        "max": 100,
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 960,
        "y": 180,
        "wires": []
    },
    {
        "id": "ui_chart_total",
        "type": "ui_chart",
        "z": "tab_neighborhood",
        "name": "Energy Chart",
        "group": "ui_group_neighborhood",
        "order": 2,
        "width": 6,
        "height": 4,
        "label": "Total Energy Consumption",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "",
        "removeOlder": "60",
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4"
        ],
        "outputs": 1,
        "x": 960,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "debug_total",
        "type": "debug",
        "z": "tab_neighborhood",
        "name": "Neighborhood Energy Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 960,
        "y": 320,
        "wires": []
    },
    {
        "id": "29ecc1fac3a4320e",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 320,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "107645194616a8ca",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 640,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "0d2c1663f6e31596",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 500,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "5af42ad4f7fd0f05",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 400,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "bc0701a833b10095",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 720,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "a9fa148e12057d4e",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 800,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "f37ee414653fa21c",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 880,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "34a56f4dd3d55128",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 1060,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "e2e5188838e6c473",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 1160,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "b5e04b5106c6ae5c",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 960,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "7d9087f020742686",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 580,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "8fd741c30903017a",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 260,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "0a250920574c3fae",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 160,
        "wires": [
            [
                "d3452e860595db6a",
                "a8f2a848ead5120c"
            ]
        ]
    },
    {
        "id": "04c71f28755de573",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 1240,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "458bbb78eb180ebe",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 1320,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "d69b0ae9bc7827a7",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 1400,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "d94641d871bd96cc",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 1480,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "8f3c72f622ea929e",
        "type": "subflow:7ecc82fdd5fcacdb",
        "z": "240e9c78e5c49674",
        "name": "",
        "x": 710,
        "y": 1560,
        "wires": [
            [
                "d3452e860595db6a"
            ]
        ]
    },
    {
        "id": "d3452e860595db6a",
        "type": "function",
        "z": "240e9c78e5c49674",
        "name": "function 1",
        "func": "\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 600,
        "wires": [
            [
                "3dcebda3e55c1f61"
            ]
        ]
    },
    {
        "id": "3dcebda3e55c1f61",
        "type": "debug",
        "z": "240e9c78e5c49674",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1540,
        "y": 600,
        "wires": []
    },
    {
        "id": "a8f2a848ead5120c",
        "type": "debug",
        "z": "240e9c78e5c49674",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1090,
        "y": 120,
        "wires": []
    },
    {
        "id": "a333501da61f1a20",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2490,
        "y": 1060,
        "wires": [
            [
                "36419d94851ffc79",
                "e7df93230a432dd1"
            ]
        ]
    },
    {
        "id": "36419d94851ffc79",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2850,
        "y": 1000,
        "wires": []
    },
    {
        "id": "4f02e55eef678fb0",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "eee7e011301bcbf4",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 600,
        "wires": [
            [
                "5d9d34e6bebf221b"
            ]
        ]
    },
    {
        "id": "5d9d34e6bebf221b",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "eee7e011301bcbf4",
        "name": "AC AsyncAPI",
        "x": 1670,
        "y": 600,
        "wires": [
            [
                "842a04c7b042a437",
                "a333501da61f1a20",
                "002094cb10cdbc6f"
            ]
        ]
    },
    {
        "id": "842a04c7b042a437",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "eee7e011301bcbf4",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1910,
        "y": 620,
        "wires": []
    },
    {
        "id": "b5978c10396e9d4b",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "26b88c19ed42739c",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 760,
        "wires": [
            [
                "8b68ed9d9c292207"
            ]
        ]
    },
    {
        "id": "8b68ed9d9c292207",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "26b88c19ed42739c",
        "name": "Lights AsyncAPI",
        "x": 1680,
        "y": 760,
        "wires": [
            [
                "e5a2a869ee6c7f78",
                "a333501da61f1a20",
                "002094cb10cdbc6f"
            ]
        ]
    },
    {
        "id": "e5a2a869ee6c7f78",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "26b88c19ed42739c",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1910,
        "y": 760,
        "wires": []
    },
    {
        "id": "33f212696921261a",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "3e55092870925e77",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1430,
        "y": 960,
        "wires": [
            [
                "2b3702210cfd0fbf"
            ]
        ]
    },
    {
        "id": "2b3702210cfd0fbf",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "3e55092870925e77",
        "name": "Fridge AsyncAPI",
        "x": 1680,
        "y": 960,
        "wires": [
            [
                "4d6947596cc265f4",
                "a333501da61f1a20",
                "002094cb10cdbc6f"
            ]
        ]
    },
    {
        "id": "4d6947596cc265f4",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "3e55092870925e77",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1940,
        "y": 960,
        "wires": []
    },
    {
        "id": "6f31a6c8c2513da5",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "097d89aa59629f73",
        "name": "Launder AsyncAPI",
        "x": 1670,
        "y": 1160,
        "wires": [
            [
                "ee168de373833dc7",
                "a333501da61f1a20",
                "002094cb10cdbc6f"
            ]
        ]
    },
    {
        "id": "ee168de373833dc7",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "097d89aa59629f73",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1940,
        "y": 1180,
        "wires": []
    },
    {
        "id": "9f3c7911a1fc7bca",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "097d89aa59629f73",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1450,
        "y": 1160,
        "wires": [
            [
                "6f31a6c8c2513da5"
            ]
        ]
    },
    {
        "id": "526f83f5d6fb5cc2",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "0cf32fc590938082",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 1380,
        "wires": [
            [
                "a9d32f4ef81a7219"
            ]
        ]
    },
    {
        "id": "a9d32f4ef81a7219",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "0cf32fc590938082",
        "name": "Dehumidifier AsyncAPI",
        "x": 1690,
        "y": 1380,
        "wires": [
            [
                "dd2c8d449ee544d7",
                "a333501da61f1a20",
                "002094cb10cdbc6f"
            ]
        ]
    },
    {
        "id": "dd2c8d449ee544d7",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "0cf32fc590938082",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 2000,
        "y": 1360,
        "wires": []
    },
    {
        "id": "b2f07029b50cd13e",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "bdfb3a1e88b25177",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1430,
        "y": 1560,
        "wires": [
            [
                "e26a96508f610791"
            ]
        ]
    },
    {
        "id": "e26a96508f610791",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "bdfb3a1e88b25177",
        "name": "Cooker AsyncAPI",
        "x": 1680,
        "y": 1560,
        "wires": [
            [
                "3aefce1db0f6306d",
                "a333501da61f1a20",
                "002094cb10cdbc6f"
            ]
        ]
    },
    {
        "id": "3aefce1db0f6306d",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "bdfb3a1e88b25177",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1940,
        "y": 1560,
        "wires": []
    },
    {
        "id": "291018ba1e012610",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "7db00f702c02067a",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2050,
        "y": 400,
        "wires": []
    },
    {
        "id": "3e675a13b663b200",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "7db00f702c02067a",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 420,
        "wires": [
            [
                "60f928be6b67b38b"
            ]
        ]
    },
    {
        "id": "60f928be6b67b38b",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "7db00f702c02067a",
        "name": " Thermostat AsyncAPI",
        "x": 1760,
        "y": 420,
        "wires": [
            [
                "291018ba1e012610",
                "a333501da61f1a20",
                "002094cb10cdbc6f"
            ]
        ]
    },
    {
        "id": "8fc2037f9b700b26",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "name": "SMARTHOME",
        "info": "",
        "x": 1280,
        "y": 220,
        "wires": []
    },
    {
        "id": "c31b2c9b810c7117",
        "type": "ui_template",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 2640,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "002094cb10cdbc6f",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2490,
        "y": 680,
        "wires": [
            [
                "c31b2c9b810c7117",
                "a55d2f0cd76a1492"
            ]
        ]
    },
    {
        "id": "a55d2f0cd76a1492",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "1fa49e80804ba4e9",
        "name": "Merged payloads",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2670,
        "y": 580,
        "wires": []
    },
    {
        "id": "9535a63863ea686d",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2570,
        "y": 2620,
        "wires": [
            [
                "a504b794e919ec6d",
                "e7df93230a432dd1"
            ]
        ]
    },
    {
        "id": "a504b794e919ec6d",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2870,
        "y": 2560,
        "wires": []
    },
    {
        "id": "53eb72be1698e319",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "ac2f13c2c3e301ab",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 2160,
        "wires": [
            [
                "0ac5bf7ebab88a61"
            ]
        ]
    },
    {
        "id": "0ac5bf7ebab88a61",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "ac2f13c2c3e301ab",
        "name": "AC AsyncAPI",
        "x": 1650,
        "y": 2160,
        "wires": [
            [
                "84452318c5fa6f88",
                "9535a63863ea686d",
                "05d8c5165e8b442d"
            ]
        ]
    },
    {
        "id": "84452318c5fa6f88",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "ac2f13c2c3e301ab",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1890,
        "y": 2180,
        "wires": []
    },
    {
        "id": "00a3e31d2ab3a53f",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "3d515a5aae85406d",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 2360,
        "wires": [
            [
                "d7e52fc62cc63298"
            ]
        ]
    },
    {
        "id": "d7e52fc62cc63298",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "3d515a5aae85406d",
        "name": "Lights AsyncAPI",
        "x": 1660,
        "y": 2360,
        "wires": [
            [
                "aade082b6a758113",
                "9535a63863ea686d",
                "05d8c5165e8b442d"
            ]
        ]
    },
    {
        "id": "aade082b6a758113",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "3d515a5aae85406d",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1890,
        "y": 2360,
        "wires": []
    },
    {
        "id": "a7df41d26f49ee99",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "32437cd10b7bd0da",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 2560,
        "wires": [
            [
                "db3682ec501d1b29"
            ]
        ]
    },
    {
        "id": "db3682ec501d1b29",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "32437cd10b7bd0da",
        "name": "Fridge AsyncAPI",
        "x": 1660,
        "y": 2560,
        "wires": [
            [
                "9ff8bcf82022fb2d",
                "9535a63863ea686d",
                "05d8c5165e8b442d"
            ]
        ]
    },
    {
        "id": "9ff8bcf82022fb2d",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "32437cd10b7bd0da",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1920,
        "y": 2560,
        "wires": []
    },
    {
        "id": "cd0e08a99563e93a",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "082a42bca6946324",
        "name": "Launder AsyncAPI",
        "x": 1650,
        "y": 2760,
        "wires": [
            [
                "57ee205d5681354e",
                "9535a63863ea686d",
                "05d8c5165e8b442d"
            ]
        ]
    },
    {
        "id": "57ee205d5681354e",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "082a42bca6946324",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1920,
        "y": 2780,
        "wires": []
    },
    {
        "id": "07681baecbc334e9",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "082a42bca6946324",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1430,
        "y": 2760,
        "wires": [
            [
                "cd0e08a99563e93a"
            ]
        ]
    },
    {
        "id": "3e577da3fb9e2779",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "880c6ae6fea682e1",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 2980,
        "wires": [
            [
                "a1e81fcfdd236b29"
            ]
        ]
    },
    {
        "id": "a1e81fcfdd236b29",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "880c6ae6fea682e1",
        "name": "Dehumidifier AsyncAPI",
        "x": 1670,
        "y": 2980,
        "wires": [
            [
                "d2f3b72e4edd3e00",
                "9535a63863ea686d",
                "05d8c5165e8b442d"
            ]
        ]
    },
    {
        "id": "d2f3b72e4edd3e00",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "880c6ae6fea682e1",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1980,
        "y": 2960,
        "wires": []
    },
    {
        "id": "85e9cf0b3f60b71d",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "31ec45d1fb751eb3",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 3160,
        "wires": [
            [
                "d3f6f727425fffc3"
            ]
        ]
    },
    {
        "id": "d3f6f727425fffc3",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "31ec45d1fb751eb3",
        "name": "Cooker AsyncAPI",
        "x": 1660,
        "y": 3160,
        "wires": [
            [
                "320adf65c4d6a3b6",
                "9535a63863ea686d",
                "05d8c5165e8b442d"
            ]
        ]
    },
    {
        "id": "320adf65c4d6a3b6",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "31ec45d1fb751eb3",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1920,
        "y": 3160,
        "wires": []
    },
    {
        "id": "84ee18b5ffb4b565",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "b3493c382db8b25f",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2050,
        "y": 1940,
        "wires": []
    },
    {
        "id": "48d27a913ca24a1f",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "b3493c382db8b25f",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 1960,
        "wires": [
            [
                "46a07f2f3646b1dc"
            ]
        ]
    },
    {
        "id": "46a07f2f3646b1dc",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "b3493c382db8b25f",
        "name": " Thermostat AsyncAPI",
        "x": 1760,
        "y": 1960,
        "wires": [
            [
                "84ee18b5ffb4b565",
                "9535a63863ea686d",
                "05d8c5165e8b442d"
            ]
        ]
    },
    {
        "id": "812c83bc679f15c2",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "name": "SMARTHOME",
        "info": "",
        "x": 1280,
        "y": 1800,
        "wires": []
    },
    {
        "id": "846382baf4b09b40",
        "type": "ui_template",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 2700,
        "y": 2320,
        "wires": [
            []
        ]
    },
    {
        "id": "05d8c5165e8b442d",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2550,
        "y": 2240,
        "wires": [
            [
                "846382baf4b09b40",
                "61b7f3f101e7e154"
            ]
        ]
    },
    {
        "id": "61b7f3f101e7e154",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "79db7029138e3991",
        "name": "Merged payloads",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2730,
        "y": 2140,
        "wires": []
    },
    {
        "id": "1681804901a381b0",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2550,
        "y": 4320,
        "wires": [
            [
                "578c52f835943667",
                "e7df93230a432dd1"
            ]
        ]
    },
    {
        "id": "578c52f835943667",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2870,
        "y": 4320,
        "wires": []
    },
    {
        "id": "ee23f591e84f6803",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "6ce0f618029e7642",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 3860,
        "wires": [
            [
                "a3f7adc61781260e"
            ]
        ]
    },
    {
        "id": "a3f7adc61781260e",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "6ce0f618029e7642",
        "name": "AC AsyncAPI",
        "x": 1630,
        "y": 3860,
        "wires": [
            [
                "cb33cff4026dd43c",
                "1681804901a381b0",
                "3c64695a52caf9aa"
            ]
        ]
    },
    {
        "id": "cb33cff4026dd43c",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "6ce0f618029e7642",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1870,
        "y": 3880,
        "wires": []
    },
    {
        "id": "e86cb7437ca2e8bb",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "3c5d3892f9c9f62b",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 4060,
        "wires": [
            [
                "161fef0711849fc1"
            ]
        ]
    },
    {
        "id": "161fef0711849fc1",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "3c5d3892f9c9f62b",
        "name": "Lights AsyncAPI",
        "x": 1640,
        "y": 4060,
        "wires": [
            [
                "f82f61e4e9a5c1b4",
                "1681804901a381b0",
                "3c64695a52caf9aa"
            ]
        ]
    },
    {
        "id": "f82f61e4e9a5c1b4",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "3c5d3892f9c9f62b",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1870,
        "y": 4060,
        "wires": []
    },
    {
        "id": "cfe5e04ab15f4758",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "922d1f1672d20315",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 4260,
        "wires": [
            [
                "12c2b147261a1c1d"
            ]
        ]
    },
    {
        "id": "12c2b147261a1c1d",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "922d1f1672d20315",
        "name": "Fridge AsyncAPI",
        "x": 1640,
        "y": 4260,
        "wires": [
            [
                "65199cf0527220df",
                "1681804901a381b0",
                "3c64695a52caf9aa"
            ]
        ]
    },
    {
        "id": "65199cf0527220df",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "922d1f1672d20315",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1900,
        "y": 4260,
        "wires": []
    },
    {
        "id": "b0ad22a7e58497a0",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "849497dbf1e186d2",
        "name": "Launder AsyncAPI",
        "x": 1630,
        "y": 4460,
        "wires": [
            [
                "9362a28e3923fd48",
                "1681804901a381b0",
                "3c64695a52caf9aa"
            ]
        ]
    },
    {
        "id": "9362a28e3923fd48",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "849497dbf1e186d2",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1900,
        "y": 4480,
        "wires": []
    },
    {
        "id": "692c360c42b0fd11",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "849497dbf1e186d2",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 4460,
        "wires": [
            [
                "b0ad22a7e58497a0"
            ]
        ]
    },
    {
        "id": "7a1b7c5d6c172e16",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "e4b3ec069e277d2c",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 4680,
        "wires": [
            [
                "41bdaebb2e9855e5"
            ]
        ]
    },
    {
        "id": "41bdaebb2e9855e5",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "e4b3ec069e277d2c",
        "name": "Dehumidifier AsyncAPI",
        "x": 1650,
        "y": 4680,
        "wires": [
            [
                "9318458be405ec0f",
                "1681804901a381b0",
                "3c64695a52caf9aa"
            ]
        ]
    },
    {
        "id": "9318458be405ec0f",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "e4b3ec069e277d2c",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1960,
        "y": 4660,
        "wires": []
    },
    {
        "id": "e440d9774ed58920",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "3cb00bc451a203fd",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 4860,
        "wires": [
            [
                "4a942e4bc7a5a1a8"
            ]
        ]
    },
    {
        "id": "4a942e4bc7a5a1a8",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "3cb00bc451a203fd",
        "name": "Cooker AsyncAPI",
        "x": 1640,
        "y": 4860,
        "wires": [
            [
                "f9b4056d34ff6e79",
                "1681804901a381b0",
                "3c64695a52caf9aa"
            ]
        ]
    },
    {
        "id": "f9b4056d34ff6e79",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "3cb00bc451a203fd",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1900,
        "y": 4860,
        "wires": []
    },
    {
        "id": "fb834d281616ef0d",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "65b3fbe9a3140f5c",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 3640,
        "wires": []
    },
    {
        "id": "a8bc925b719ae023",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "65b3fbe9a3140f5c",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 3660,
        "wires": [
            [
                "3ba185ed0e40da35"
            ]
        ]
    },
    {
        "id": "3ba185ed0e40da35",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "65b3fbe9a3140f5c",
        "name": " Thermostat AsyncAPI",
        "x": 1740,
        "y": 3660,
        "wires": [
            [
                "fb834d281616ef0d",
                "1681804901a381b0",
                "3c64695a52caf9aa"
            ]
        ]
    },
    {
        "id": "516213cc26f07d35",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "name": "SMARTHOME",
        "info": "",
        "x": 1280,
        "y": 3520,
        "wires": []
    },
    {
        "id": "0cb8a893cf72feb4",
        "type": "ui_template",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 2760,
        "y": 4080,
        "wires": [
            []
        ]
    },
    {
        "id": "3c64695a52caf9aa",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2530,
        "y": 3940,
        "wires": [
            [
                "0cb8a893cf72feb4",
                "144944a855089db2"
            ]
        ]
    },
    {
        "id": "144944a855089db2",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "cc269adf6e1ba45b",
        "name": "Merged payloads",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2790,
        "y": 3900,
        "wires": []
    },
    {
        "id": "fab067ed35ac5296",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2530,
        "y": 5920,
        "wires": [
            [
                "cd35ce574ffbb7cf",
                "e7df93230a432dd1"
            ]
        ]
    },
    {
        "id": "cd35ce574ffbb7cf",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2870,
        "y": 5880,
        "wires": []
    },
    {
        "id": "aedf1365b9d5bcbb",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "e9f6b0a8c2b5862a",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 5480,
        "wires": [
            [
                "ef2111baf49172bf"
            ]
        ]
    },
    {
        "id": "ef2111baf49172bf",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "e9f6b0a8c2b5862a",
        "name": "AC AsyncAPI",
        "x": 1630,
        "y": 5480,
        "wires": [
            [
                "eb5793bb3b236c0c",
                "fab067ed35ac5296",
                "a9dbe535eb7af705"
            ]
        ]
    },
    {
        "id": "eb5793bb3b236c0c",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "e9f6b0a8c2b5862a",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1870,
        "y": 5500,
        "wires": []
    },
    {
        "id": "6e1e2973d32ab79f",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "1caac1c1e09790f8",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 5680,
        "wires": [
            [
                "18348cd9cc858c69"
            ]
        ]
    },
    {
        "id": "18348cd9cc858c69",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "1caac1c1e09790f8",
        "name": "Lights AsyncAPI",
        "x": 1640,
        "y": 5680,
        "wires": [
            [
                "6f95c067896b64a7",
                "fab067ed35ac5296",
                "a9dbe535eb7af705"
            ]
        ]
    },
    {
        "id": "6f95c067896b64a7",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "1caac1c1e09790f8",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1870,
        "y": 5680,
        "wires": []
    },
    {
        "id": "25c6fb4e3336640a",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "f1b862118a532714",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 5880,
        "wires": [
            [
                "3523e3f2b625db79"
            ]
        ]
    },
    {
        "id": "3523e3f2b625db79",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "f1b862118a532714",
        "name": "Fridge AsyncAPI",
        "x": 1640,
        "y": 5880,
        "wires": [
            [
                "a6d6579ab8206e5e",
                "fab067ed35ac5296",
                "a9dbe535eb7af705"
            ]
        ]
    },
    {
        "id": "a6d6579ab8206e5e",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "f1b862118a532714",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1900,
        "y": 5880,
        "wires": []
    },
    {
        "id": "53772252812fbcab",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "e4f2b3e6e6fcc8e6",
        "name": "Launder AsyncAPI",
        "x": 1630,
        "y": 6080,
        "wires": [
            [
                "59a566d47b36f65e",
                "fab067ed35ac5296",
                "a9dbe535eb7af705"
            ]
        ]
    },
    {
        "id": "59a566d47b36f65e",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "e4f2b3e6e6fcc8e6",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1900,
        "y": 6100,
        "wires": []
    },
    {
        "id": "5f0554b2b5db9155",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "e4f2b3e6e6fcc8e6",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1410,
        "y": 6080,
        "wires": [
            [
                "53772252812fbcab"
            ]
        ]
    },
    {
        "id": "b719b1746d2ebc88",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "d429d4b0b2c99a27",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 6300,
        "wires": [
            [
                "0fd6f53989ffc648"
            ]
        ]
    },
    {
        "id": "0fd6f53989ffc648",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "d429d4b0b2c99a27",
        "name": "Dehumidifier AsyncAPI",
        "x": 1650,
        "y": 6300,
        "wires": [
            [
                "6fb7020373362d13",
                "fab067ed35ac5296",
                "a9dbe535eb7af705"
            ]
        ]
    },
    {
        "id": "6fb7020373362d13",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "d429d4b0b2c99a27",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1960,
        "y": 6280,
        "wires": []
    },
    {
        "id": "4d0a0e13f3aa0305",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "3ffb0f9cf0efe378",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 6480,
        "wires": [
            [
                "ad4ce6803ae59aa4"
            ]
        ]
    },
    {
        "id": "ad4ce6803ae59aa4",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "3ffb0f9cf0efe378",
        "name": "Cooker AsyncAPI",
        "x": 1640,
        "y": 6480,
        "wires": [
            [
                "9061aded936a7acb",
                "fab067ed35ac5296",
                "a9dbe535eb7af705"
            ]
        ]
    },
    {
        "id": "9061aded936a7acb",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "3ffb0f9cf0efe378",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 1900,
        "y": 6480,
        "wires": []
    },
    {
        "id": "e0e9f45127be2564",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "3fbe6fc9eceb3834",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 5260,
        "wires": []
    },
    {
        "id": "f096aaaa790496cf",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "3fbe6fc9eceb3834",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 5280,
        "wires": [
            [
                "728426c6d9a7ff54"
            ]
        ]
    },
    {
        "id": "728426c6d9a7ff54",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "3fbe6fc9eceb3834",
        "name": " Thermostat AsyncAPI",
        "x": 1740,
        "y": 5280,
        "wires": [
            [
                "e0e9f45127be2564",
                "fab067ed35ac5296",
                "a9dbe535eb7af705"
            ]
        ]
    },
    {
        "id": "3024c8c2b2d68e28",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "name": "SMARTHOME",
        "info": "",
        "x": 1280,
        "y": 5140,
        "wires": []
    },
    {
        "id": "46407e9ca663ecdc",
        "type": "ui_template",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 2680,
        "y": 5640,
        "wires": [
            []
        ]
    },
    {
        "id": "a9dbe535eb7af705",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2530,
        "y": 5560,
        "wires": [
            [
                "46407e9ca663ecdc",
                "ae3ff85c06a7f1c5"
            ]
        ]
    },
    {
        "id": "ae3ff85c06a7f1c5",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "1c4ecb18566c5e16",
        "name": "Merged payloads",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2710,
        "y": 5460,
        "wires": []
    },
    {
        "id": "97f1c3c79d186707",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4970,
        "y": 1000,
        "wires": [
            [
                "415491f56995be24",
                "8ed8748c874031f9"
            ]
        ]
    },
    {
        "id": "415491f56995be24",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5210,
        "y": 940,
        "wires": []
    },
    {
        "id": "6c6335ecc06dfc1b",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "f4dcd5c5e7f6d210",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3800,
        "y": 540,
        "wires": [
            [
                "95a68b78fc45cccb"
            ]
        ]
    },
    {
        "id": "95a68b78fc45cccb",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "f4dcd5c5e7f6d210",
        "name": "AC AsyncAPI",
        "x": 4050,
        "y": 540,
        "wires": [
            [
                "170a5f9a7f66fca0",
                "97f1c3c79d186707",
                "0ee13980dcec1636"
            ]
        ]
    },
    {
        "id": "170a5f9a7f66fca0",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "f4dcd5c5e7f6d210",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4290,
        "y": 560,
        "wires": []
    },
    {
        "id": "9764435b19f67e4c",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "a1dda5463abe78d7",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3800,
        "y": 740,
        "wires": [
            [
                "1cc84ee986555227"
            ]
        ]
    },
    {
        "id": "1cc84ee986555227",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "a1dda5463abe78d7",
        "name": "Lights AsyncAPI",
        "x": 4060,
        "y": 740,
        "wires": [
            [
                "c5612a882ced3c16",
                "97f1c3c79d186707",
                "0ee13980dcec1636"
            ]
        ]
    },
    {
        "id": "c5612a882ced3c16",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "a1dda5463abe78d7",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4290,
        "y": 740,
        "wires": []
    },
    {
        "id": "b90a3bf6c51b0cc6",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "458efb9d8bca6613",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3810,
        "y": 940,
        "wires": [
            [
                "5be61b5693fc9722"
            ]
        ]
    },
    {
        "id": "5be61b5693fc9722",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "458efb9d8bca6613",
        "name": "Fridge AsyncAPI",
        "x": 4060,
        "y": 940,
        "wires": [
            [
                "c77f6df550f965eb",
                "97f1c3c79d186707",
                "0ee13980dcec1636"
            ]
        ]
    },
    {
        "id": "c77f6df550f965eb",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "458efb9d8bca6613",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4320,
        "y": 940,
        "wires": []
    },
    {
        "id": "75ec20037659034e",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "3fd9bcb960b68688",
        "name": "Launder AsyncAPI",
        "x": 4050,
        "y": 1140,
        "wires": [
            [
                "a8bfd7d6a275867b",
                "97f1c3c79d186707",
                "0ee13980dcec1636"
            ]
        ]
    },
    {
        "id": "a8bfd7d6a275867b",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "3fd9bcb960b68688",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4320,
        "y": 1160,
        "wires": []
    },
    {
        "id": "42e368e15af97dcd",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "3fd9bcb960b68688",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3830,
        "y": 1140,
        "wires": [
            [
                "75ec20037659034e"
            ]
        ]
    },
    {
        "id": "e4e918777412d058",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "db8fdfd522e52070",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3820,
        "y": 1360,
        "wires": [
            [
                "905d909648576db5"
            ]
        ]
    },
    {
        "id": "905d909648576db5",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "db8fdfd522e52070",
        "name": "Dehumidifier AsyncAPI",
        "x": 4070,
        "y": 1360,
        "wires": [
            [
                "29291f381788ae9c",
                "97f1c3c79d186707",
                "0ee13980dcec1636"
            ]
        ]
    },
    {
        "id": "29291f381788ae9c",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "db8fdfd522e52070",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4380,
        "y": 1340,
        "wires": []
    },
    {
        "id": "b696d52e5412d4be",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "5ce92f73a77643dc",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3810,
        "y": 1540,
        "wires": [
            [
                "0cddcae669ec4976"
            ]
        ]
    },
    {
        "id": "0cddcae669ec4976",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "5ce92f73a77643dc",
        "name": "Cooker AsyncAPI",
        "x": 4060,
        "y": 1540,
        "wires": [
            [
                "b13024facfd019e7",
                "97f1c3c79d186707",
                "0ee13980dcec1636"
            ]
        ]
    },
    {
        "id": "b13024facfd019e7",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "5ce92f73a77643dc",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4320,
        "y": 1540,
        "wires": []
    },
    {
        "id": "d2baeaca4a7d571d",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "24be558fbaa900c1",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 4490,
        "y": 300,
        "wires": []
    },
    {
        "id": "89bf4834bc84ee48",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "24be558fbaa900c1",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3800,
        "y": 320,
        "wires": [
            [
                "7015e750817ef422"
            ]
        ]
    },
    {
        "id": "7015e750817ef422",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "24be558fbaa900c1",
        "name": " Thermostat AsyncAPI",
        "x": 4140,
        "y": 320,
        "wires": [
            [
                "d2baeaca4a7d571d",
                "97f1c3c79d186707",
                "0ee13980dcec1636"
            ]
        ]
    },
    {
        "id": "3e914227798322aa",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "name": "SMARTHOME",
        "info": "",
        "x": 3720,
        "y": 200,
        "wires": []
    },
    {
        "id": "7c318acebf4239bf",
        "type": "ui_template",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 5100,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "0ee13980dcec1636",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4950,
        "y": 620,
        "wires": [
            [
                "7c318acebf4239bf",
                "9d60ed3188d1cfbe"
            ]
        ]
    },
    {
        "id": "9d60ed3188d1cfbe",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "476064ef6b868dcb",
        "name": "Merged payloads",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5130,
        "y": 520,
        "wires": []
    },
    {
        "id": "ad96f8a53eaca621",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5010,
        "y": 2580,
        "wires": [
            [
                "d2361f27cfae6a45",
                "8ed8748c874031f9"
            ]
        ]
    },
    {
        "id": "d2361f27cfae6a45",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5210,
        "y": 2520,
        "wires": []
    },
    {
        "id": "b03c5837abac29a0",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "b6354af38600854d",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3840,
        "y": 2120,
        "wires": [
            [
                "cb6ef4d3e30787f1"
            ]
        ]
    },
    {
        "id": "cb6ef4d3e30787f1",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "b6354af38600854d",
        "name": "AC AsyncAPI",
        "x": 4090,
        "y": 2120,
        "wires": [
            [
                "0751796c713e767a",
                "ad96f8a53eaca621",
                "c2c1b26c18e7d430"
            ]
        ]
    },
    {
        "id": "0751796c713e767a",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "b6354af38600854d",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4330,
        "y": 2140,
        "wires": []
    },
    {
        "id": "ba1aea899432865a",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "b536857a542d3e5a",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3840,
        "y": 2320,
        "wires": [
            [
                "e54c78d79e6b0fb6"
            ]
        ]
    },
    {
        "id": "e54c78d79e6b0fb6",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "b536857a542d3e5a",
        "name": "Lights AsyncAPI",
        "x": 4100,
        "y": 2320,
        "wires": [
            [
                "3aea3eb13373bd0f",
                "ad96f8a53eaca621",
                "c2c1b26c18e7d430"
            ]
        ]
    },
    {
        "id": "3aea3eb13373bd0f",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "b536857a542d3e5a",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4330,
        "y": 2320,
        "wires": []
    },
    {
        "id": "a9071186935d7c08",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "4062807e01f61076",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3850,
        "y": 2520,
        "wires": [
            [
                "d9aca3090a6222f3"
            ]
        ]
    },
    {
        "id": "d9aca3090a6222f3",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "4062807e01f61076",
        "name": "Fridge AsyncAPI",
        "x": 4100,
        "y": 2520,
        "wires": [
            [
                "c00c7b59eca1392a",
                "ad96f8a53eaca621",
                "c2c1b26c18e7d430"
            ]
        ]
    },
    {
        "id": "c00c7b59eca1392a",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "4062807e01f61076",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4360,
        "y": 2520,
        "wires": []
    },
    {
        "id": "b84f5293acb12a87",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "074f8abeede051d8",
        "name": "Launder AsyncAPI",
        "x": 4090,
        "y": 2720,
        "wires": [
            [
                "ffcb745d1a4e0e3e",
                "ad96f8a53eaca621",
                "c2c1b26c18e7d430"
            ]
        ]
    },
    {
        "id": "ffcb745d1a4e0e3e",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "074f8abeede051d8",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4360,
        "y": 2740,
        "wires": []
    },
    {
        "id": "6404e6e05c8854b1",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "074f8abeede051d8",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3870,
        "y": 2720,
        "wires": [
            [
                "b84f5293acb12a87"
            ]
        ]
    },
    {
        "id": "1d8f8a53c9eb4273",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "139dc5f6ea2ba69f",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3860,
        "y": 2940,
        "wires": [
            [
                "d5b02b94111d0d74"
            ]
        ]
    },
    {
        "id": "d5b02b94111d0d74",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "139dc5f6ea2ba69f",
        "name": "Dehumidifier AsyncAPI",
        "x": 4110,
        "y": 2940,
        "wires": [
            [
                "ec1be4becf001c3b",
                "ad96f8a53eaca621",
                "c2c1b26c18e7d430"
            ]
        ]
    },
    {
        "id": "ec1be4becf001c3b",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "139dc5f6ea2ba69f",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4420,
        "y": 2920,
        "wires": []
    },
    {
        "id": "f9d3021c446134cd",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "b1cb30e4b9d7ad5b",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3890,
        "y": 3160,
        "wires": [
            [
                "9ad7656d0ed6b591"
            ]
        ]
    },
    {
        "id": "9ad7656d0ed6b591",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "b1cb30e4b9d7ad5b",
        "name": "Cooker AsyncAPI",
        "x": 4140,
        "y": 3160,
        "wires": [
            [
                "d6bf2e866ebae2ea",
                "ad96f8a53eaca621",
                "c2c1b26c18e7d430"
            ]
        ]
    },
    {
        "id": "d6bf2e866ebae2ea",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "b1cb30e4b9d7ad5b",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4400,
        "y": 3160,
        "wires": []
    },
    {
        "id": "18d6289f541cde43",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "f3b23842e98bd52a",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 4490,
        "y": 1900,
        "wires": []
    },
    {
        "id": "65ecb36353a61463",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "f3b23842e98bd52a",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3860,
        "y": 1920,
        "wires": [
            [
                "d225112b2619e8d4"
            ]
        ]
    },
    {
        "id": "d225112b2619e8d4",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "f3b23842e98bd52a",
        "name": " Thermostat AsyncAPI",
        "x": 4200,
        "y": 1920,
        "wires": [
            [
                "18d6289f541cde43",
                "ad96f8a53eaca621",
                "c2c1b26c18e7d430"
            ]
        ]
    },
    {
        "id": "6ceb4f0284f028fd",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "name": "SMARTHOME",
        "info": "",
        "x": 3720,
        "y": 1800,
        "wires": []
    },
    {
        "id": "991b79fba54dd530",
        "type": "ui_template",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 5140,
        "y": 2280,
        "wires": [
            []
        ]
    },
    {
        "id": "c2c1b26c18e7d430",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4990,
        "y": 2200,
        "wires": [
            [
                "991b79fba54dd530",
                "01c9bbfdb259f9a9"
            ]
        ]
    },
    {
        "id": "01c9bbfdb259f9a9",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "1304969aadebd79a",
        "name": "Merged payloads",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5170,
        "y": 2100,
        "wires": []
    },
    {
        "id": "dfd8a7fd6e69c461",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5030,
        "y": 4360,
        "wires": [
            [
                "4df98a23dc305fd9",
                "8ed8748c874031f9"
            ]
        ]
    },
    {
        "id": "4df98a23dc305fd9",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5210,
        "y": 4260,
        "wires": []
    },
    {
        "id": "fcd0f3b7b57b5bca",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "ea7c5f2f5b3aabf6",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3860,
        "y": 3900,
        "wires": [
            [
                "8fe9c415de272582"
            ]
        ]
    },
    {
        "id": "8fe9c415de272582",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "ea7c5f2f5b3aabf6",
        "name": "AC AsyncAPI",
        "x": 4110,
        "y": 3900,
        "wires": [
            [
                "2ecc63e5677ee090",
                "dfd8a7fd6e69c461",
                "525dd032994486a2"
            ]
        ]
    },
    {
        "id": "2ecc63e5677ee090",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "ea7c5f2f5b3aabf6",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4350,
        "y": 3920,
        "wires": []
    },
    {
        "id": "be1bb0650a31a1aa",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "2c0779ed8316824f",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3860,
        "y": 4100,
        "wires": [
            [
                "d3f25665ce7cfcfe"
            ]
        ]
    },
    {
        "id": "d3f25665ce7cfcfe",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "2c0779ed8316824f",
        "name": "Lights AsyncAPI",
        "x": 4120,
        "y": 4100,
        "wires": [
            [
                "711d81536a1ec1eb",
                "dfd8a7fd6e69c461",
                "525dd032994486a2"
            ]
        ]
    },
    {
        "id": "711d81536a1ec1eb",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "2c0779ed8316824f",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4350,
        "y": 4100,
        "wires": []
    },
    {
        "id": "89840683aba16d92",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "458704ca8ab19d67",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3870,
        "y": 4300,
        "wires": [
            [
                "0d9fa60dc2296aad"
            ]
        ]
    },
    {
        "id": "0d9fa60dc2296aad",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "458704ca8ab19d67",
        "name": "Fridge AsyncAPI",
        "x": 4120,
        "y": 4300,
        "wires": [
            [
                "e18b0bfeb87c82f2",
                "dfd8a7fd6e69c461",
                "525dd032994486a2"
            ]
        ]
    },
    {
        "id": "e18b0bfeb87c82f2",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "458704ca8ab19d67",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4380,
        "y": 4300,
        "wires": []
    },
    {
        "id": "d1a985180d5f8fcc",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "4c656af60f49ba91",
        "name": "Launder AsyncAPI",
        "x": 4110,
        "y": 4500,
        "wires": [
            [
                "f1433765f47226f9",
                "dfd8a7fd6e69c461",
                "525dd032994486a2"
            ]
        ]
    },
    {
        "id": "f1433765f47226f9",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "4c656af60f49ba91",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4380,
        "y": 4520,
        "wires": []
    },
    {
        "id": "c3c9ac05b9510a42",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "4c656af60f49ba91",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3890,
        "y": 4500,
        "wires": [
            [
                "d1a985180d5f8fcc"
            ]
        ]
    },
    {
        "id": "85dd61feea2f242c",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "a24ba65ac3a50d74",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3880,
        "y": 4720,
        "wires": [
            [
                "eea349a527bc4116"
            ]
        ]
    },
    {
        "id": "eea349a527bc4116",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "a24ba65ac3a50d74",
        "name": "Dehumidifier AsyncAPI",
        "x": 4130,
        "y": 4720,
        "wires": [
            [
                "df03e6c3a6804f27",
                "dfd8a7fd6e69c461",
                "525dd032994486a2"
            ]
        ]
    },
    {
        "id": "df03e6c3a6804f27",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "a24ba65ac3a50d74",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4440,
        "y": 4700,
        "wires": []
    },
    {
        "id": "cae3f3494f39d28f",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "fd4c21bd62c0bd0b",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3790,
        "y": 4840,
        "wires": [
            [
                "7bf404de98463c2c"
            ]
        ]
    },
    {
        "id": "7bf404de98463c2c",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "fd4c21bd62c0bd0b",
        "name": "Cooker AsyncAPI",
        "x": 4040,
        "y": 4840,
        "wires": [
            [
                "558bb2fbadafa4e0",
                "dfd8a7fd6e69c461",
                "525dd032994486a2"
            ]
        ]
    },
    {
        "id": "558bb2fbadafa4e0",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "fd4c21bd62c0bd0b",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4280,
        "y": 4860,
        "wires": []
    },
    {
        "id": "419367a60f814a06",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "9fbf388851f74602",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 4490,
        "y": 3660,
        "wires": []
    },
    {
        "id": "51b8b10909086b0a",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "9fbf388851f74602",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3860,
        "y": 3680,
        "wires": [
            [
                "5fd20c670685859f"
            ]
        ]
    },
    {
        "id": "5fd20c670685859f",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "9fbf388851f74602",
        "name": " Thermostat AsyncAPI",
        "x": 4200,
        "y": 3680,
        "wires": [
            [
                "419367a60f814a06",
                "dfd8a7fd6e69c461",
                "525dd032994486a2"
            ]
        ]
    },
    {
        "id": "99416f52ef62612d",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "name": "SMARTHOME",
        "info": "",
        "x": 3740,
        "y": 3520,
        "wires": []
    },
    {
        "id": "e84ec87274df2ab4",
        "type": "ui_template",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 5160,
        "y": 4060,
        "wires": [
            []
        ]
    },
    {
        "id": "525dd032994486a2",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5010,
        "y": 3980,
        "wires": [
            [
                "e84ec87274df2ab4",
                "a9b11364d1d88e37"
            ]
        ]
    },
    {
        "id": "a9b11364d1d88e37",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "0e9437d90d297cb3",
        "name": "Merged payloads",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5190,
        "y": 3880,
        "wires": []
    },
    {
        "id": "7f9c5448391e2292",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "name": "Total Energy Calculator",
        "func": "// Get previous total from flow or global context\nlet total = flow.get('energy.total') || 0;\n\n// Add new energy from this payload\nlet deviceEnergy = msg.payload.energyUsed || 0;\ntotal += deviceEnergy;\n\n// Round to 2 decimal places\ntotal = parseFloat(total.toFixed(2));\n\n// Save updated total\nflow.set('energy.total', total);\nglobal.set('energy.total', total); // optional\n\n// Prepare payload for ui_chart\nmsg.payload = {\n    series: [\"Total Energy\"],\n    data: [[total]],\n    labels: [new Date().toLocaleTimeString()]\n};\n\n// Also send total for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4870,
        "y": 5960,
        "wires": [
            [
                "a7070e2d6b982f5c",
                "8ed8748c874031f9"
            ]
        ]
    },
    {
        "id": "a7070e2d6b982f5c",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "name": "Total Energy Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "totalEnergy",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5170,
        "y": 5900,
        "wires": []
    },
    {
        "id": "d767c2a73547db9d",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "64c546f8982846d9",
        "name": "AC Telemetry",
        "func": "// Environment values\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\n\n// Random setpoint between 1630C\nlet setpoint = Math.floor(16 + Math.random() * (30 - 16 + 1));\n\n// Random drift\nlet current = envTemp;\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine AC mode\nlet mode = 'idle';\nlet fanSpeed = 'low';\n\nif (current > setpoint + 1) {\n    mode = 'cool';\n    fanSpeed = 'high';\n} else if (current < setpoint - 1) {\n    mode = 'fan';\n    fanSpeed = 'medium';\n}\n\n// Energy tracking\nlet energy = flow.get('energy.ac') || 0;\nconst acPower = 1200;  // W\nconst fanPower = 100;  // W\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n} else if (mode === 'fan') {\n    energy += wattToKwh(fanPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.ac', energy);\nflow.set('current_ac_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"ac\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    setpoint: setpoint,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3760,
        "y": 5500,
        "wires": [
            [
                "5b46130ca6a26f0d"
            ]
        ]
    },
    {
        "id": "5b46130ca6a26f0d",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "64c546f8982846d9",
        "name": "AC AsyncAPI",
        "x": 4010,
        "y": 5500,
        "wires": [
            [
                "9aa9c84c88d2802f",
                "7f9c5448391e2292",
                "9e29310b33fbe444"
            ]
        ]
    },
    {
        "id": "9aa9c84c88d2802f",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "64c546f8982846d9",
        "name": "AC Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4250,
        "y": 5520,
        "wires": []
    },
    {
        "id": "a994865b84aa0451",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "8aa8306c04403ab7",
        "name": "Lights Telemetry",
        "func": "// Get environment info\nlet envTemp = parseFloat(msg.payload.temperature);\nlet envHumidity = msg.payload.humidity;\nlet envLight = msg.payload.lightIntensity;\n\n// Threshold for turning on lights (0-100)\nconst lightThreshold = 30;\n\n// Determine light state based on room intensity\nlet state = envLight < lightThreshold ? \"ON\" : \"OFF\";\n\n// Random brightness if ON, otherwise 0\nlet brightness = state === \"ON\" ? Math.floor(50 + Math.random() * 51) : 0; // 50-100%\nconst colors = [\"#FFFFFF\", \"#FFAA00\", \"#00FFAA\", \"#AA00FF\"];\nlet color = colors[Math.floor(Math.random() * colors.length)];\nlet colorTemperature = Math.floor(2700 + Math.random() * (6500 - 2700));\nconst modes = [\"normal\", \"reading\", \"nightlight\", \"ambient\", \"effect\"];\nlet mode = modes[Math.floor(Math.random() * modes.length)];\nlet effect = mode === \"effect\" ? [\"rainbow\", \"pulse\", \"candle\"][Math.floor(Math.random() * 3)] : \"\";\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Energy tracking\nlet energy = flow.get('energy.light') || 0;\nconst power = state === \"ON\" ? 8 + Math.random() * 2 : 0;\nenergy += (power / 1000) * (tickSeconds / 3600);\nenergy = parseFloat(energy.toFixed(3));\nflow.set('energy.light', energy);\n\n// Telemetry output\nmsg.payload = {\n    state,\n    brightness,\n    color,\n    colorTemperature,\n    mode,\n    effect,\n    energyUsed: energy,\n    voltage: 230,\n    power: parseFloat(power.toFixed(2)),\n    environmentTemp: envTemp,\n    environmentHumidity: envHumidity,\n    environmentLight: envLight,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3760,
        "y": 5700,
        "wires": [
            [
                "7d7000d727b37a9c"
            ]
        ]
    },
    {
        "id": "7d7000d727b37a9c",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "8aa8306c04403ab7",
        "name": "Lights AsyncAPI",
        "x": 4020,
        "y": 5700,
        "wires": [
            [
                "1379537f0b89f35e",
                "7f9c5448391e2292",
                "9e29310b33fbe444"
            ]
        ]
    },
    {
        "id": "1379537f0b89f35e",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "8aa8306c04403ab7",
        "name": "Lights Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4250,
        "y": 5700,
        "wires": []
    },
    {
        "id": "c72018496d42cd30",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "ef8250ec88c42c1d",
        "name": "Fridge Telemetry",
        "func": "// === Fridge Telemetry Simulation ===\n\n// Desired temps (user setpoints)\nconst fridgeSet = flow.get(\"fridge.setTemp\") || 4;    // C\nconst freezerSet = flow.get(\"freezer.setTemp\") || -18; // C\n\n// Current temps (with drift around setpoint)\nlet fridgeTemp = flow.get(\"fridge.currentTemp\") || fridgeSet + (Math.random() * 2 - 1);\nlet freezerTemp = flow.get(\"freezer.currentTemp\") || freezerSet + (Math.random() * 2 - 1);\n\n// Random drift\nfridgeTemp += (Math.random() * 0.4 - 0.2);\nfreezerTemp += (Math.random() * 0.6 - 0.3);\n\n// --- Simulation scaling ---\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 1 * scale;\n\n// Compressor state logic\nlet compressor = \"OFF\";\nif (fridgeTemp > fridgeSet + 1 || freezerTemp > freezerSet + 1) {\n    compressor = \"ON\";\n    fridgeTemp -= 0.3 * scale;   // cooling effect scales\n    freezerTemp -= 0.5 * scale;\n}\n\n// Energy usage tracking\nlet energy = flow.get(\"energy.fridge\") || 0;\nconst compressorPower = 150; // W typical fridge draw\nconst idlePower = 5;         // W electronics/LEDs\n\nfunction wattToKwh(power, sec) {\n    return (power / 1000) * (sec / 3600);\n}\n\nif (compressor === \"ON\") {\n    energy += wattToKwh(compressorPower, tickSeconds);\n} else {\n    energy += wattToKwh(idlePower, tickSeconds);\n}\n\nflow.set(\"energy.fridge\", energy);\n\n// Door status simulation (10% chance door is open)\nlet doorStatus = \"closed\";\nif (Math.random() < 0.1) {\n    doorStatus = Math.random() > 0.5 ? \"fridge_open\" : \"freezer_open\";\n}\n\n// Save temps for next tick\nflow.set(\"fridge.currentTemp\", fridgeTemp);\nflow.set(\"freezer.currentTemp\", freezerTemp);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"fridge\",\n    power: compressor,\n    mode: \"normal\",\n    fridgeTemp: parseFloat(fridgeTemp.toFixed(1)),\n    freezerTemp: parseFloat(freezerTemp.toFixed(1)),\n    doorStatus: doorStatus,\n    humidityControl: [\"low\", \"medium\", \"high\"][Math.floor(Math.random() * 3)],\n    energyUsed: parseFloat(energy.toFixed(3)),\n    alarms: doorStatus !== \"closed\" ? [\"door_open\"] : [],\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3770,
        "y": 5900,
        "wires": [
            [
                "3c9e54f68af0bbee"
            ]
        ]
    },
    {
        "id": "3c9e54f68af0bbee",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "ef8250ec88c42c1d",
        "name": "Fridge AsyncAPI",
        "x": 4020,
        "y": 5900,
        "wires": [
            [
                "9b6007085de4352e",
                "7f9c5448391e2292",
                "9e29310b33fbe444"
            ]
        ]
    },
    {
        "id": "9b6007085de4352e",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "ef8250ec88c42c1d",
        "name": "Fridge Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4280,
        "y": 5900,
        "wires": []
    },
    {
        "id": "f1406c22b031651f",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "bb478d62121a3402",
        "name": "Launder AsyncAPI",
        "x": 4010,
        "y": 6100,
        "wires": [
            [
                "3dbceb95792006a6",
                "7f9c5448391e2292",
                "9e29310b33fbe444"
            ]
        ]
    },
    {
        "id": "3dbceb95792006a6",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "bb478d62121a3402",
        "name": "Launder Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4280,
        "y": 6120,
        "wires": []
    },
    {
        "id": "9c46ddbd6587d60f",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "bb478d62121a3402",
        "name": "Laundry Telemetry",
        "func": "// --- Washing machine telemetry simulator ---\n\n// Persist cycle state across ticks\nlet cyclePhase = flow.get('laundry.phase') || \"idle\";\nlet remainingTime = flow.get('laundry.remainingTime') || 0;\nlet running = flow.get('laundry.running') || false;\nlet energy = flow.get('laundry.energy') || 0;\nlet waterUsed = flow.get('laundry.waterUsed') || 0;\n\n// Simulation scale\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickSeconds = 60 * scale; // scale time in seconds\n\n// Randomly decide if machine is turned on\nlet powerStates = [\"ON\", \"OFF\", \"STANDBY\"];\nlet power = powerStates[Math.floor(Math.random() * powerStates.length)];\n\n// If machine is ON and idle, start a new cycle sometimes\nif (power === \"ON\" && !running && Math.random() < 0.05) {\n    running = true;\n    const modes = [\"eco\", \"normal\", \"quick\", \"heavy\", \"delicate\", \"wool\", \"rinse\", \"spin\", \"dry\"];\n    let mode = modes[Math.floor(Math.random() * modes.length)];\n    flow.set('laundry.mode', mode);\n\n    // Random cycle length based on mode\n    let cycleLengths = {\n        eco: 120,\n        normal: 90,\n        quick: 30,\n        heavy: 150,\n        delicate: 60,\n        wool: 70,\n        rinse: 20,\n        spin: 15,\n        dry: 80\n    };\n    remainingTime = cycleLengths[mode];\n    cyclePhase = \"filling\";\n}\n\n// Progress cycle if running\nif (running && power === \"ON\") {\n    remainingTime = Math.max(0, remainingTime - 1 * scale); // scaled progression\n\n    // Phase progression\n    if (remainingTime <= 0) {\n        running = false;\n        cyclePhase = \"completed\";\n    } else if (remainingTime > 60) {\n        cyclePhase = \"washing\";\n    } else if (remainingTime > 30) {\n        cyclePhase = \"rinsing\";\n    } else if (remainingTime > 10) {\n        cyclePhase = \"spinning\";\n    } else {\n        cyclePhase = \"drying\";\n    }\n\n    // Energy & water usage simulation\n    let powerWatts = 0;\n    if (cyclePhase === \"washing\") powerWatts = 500;\n    if (cyclePhase === \"rinsing\") powerWatts = 300;\n    if (cyclePhase === \"spinning\") powerWatts = 800;\n    if (cyclePhase === \"drying\") powerWatts = 2000;\n\n    function wattToKwh(powerWatts, seconds) {\n        return (powerWatts / 1000) * (seconds / 3600);\n    }\n\n    energy += wattToKwh(powerWatts, tickSeconds);\n    if ([\"filling\", \"washing\", \"rinsing\"].includes(cyclePhase)) {\n        waterUsed += Math.random() * 0.5 * scale; // scale water usage\n    }\n}\n\n// Simulated values\nlet mode = flow.get('laundry.mode') || \"idle\";\nlet waterTemp = (cyclePhase === \"washing\") ? 40 + Math.random() * 20 : 25;\nlet spinSpeed = (cyclePhase === \"spinning\") ? 800 + Math.floor(Math.random() * 400) : 0;\nlet loadWeight = 5 + Math.random() * 3; // 5-8 kg load\n\n// Door status\nlet doorStatus = (running || cyclePhase === \"completed\") ? \"locked\" : (Math.random() < 0.8 ? \"closed\" : \"open\");\n\n// Save state\nflow.set('laundry.phase', cyclePhase);\nflow.set('laundry.remainingTime', remainingTime);\nflow.set('laundry.running', running);\nflow.set('laundry.energy', energy);\nflow.set('laundry.waterUsed', waterUsed);\n\n// Output payload\nmsg.payload = {\n    device: \"laundry\",\n    power,\n    running,\n    mode,\n    cyclePhase,\n    waterTemp: parseFloat(waterTemp.toFixed(1)),\n    spinSpeed,\n    remainingTime,\n    loadWeight: parseFloat(loadWeight.toFixed(1)),\n    waterUsed: parseFloat(waterUsed.toFixed(2)),\n    energyUsed: parseFloat(energy.toFixed(3)),\n    doorStatus\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3790,
        "y": 6100,
        "wires": [
            [
                "f1406c22b031651f"
            ]
        ]
    },
    {
        "id": "0eb307de2a08f572",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "c5220e32833dbbf1",
        "name": "Dehumidifier Telemetry",
        "func": "// --- Dehumidifier Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst power = Math.random() > 0.5 ? \"ON\" : \"OFF\";\n\n// Modes and fan speeds\nconst modes = [\"auto\", \"manual\"];\nconst mode = modes[Math.floor(Math.random() * modes.length)];\n\nconst fanSpeeds = [\"low\", \"medium\", \"high\"];\nconst fanSpeed = power === \"ON\" ? fanSpeeds[Math.floor(Math.random() * fanSpeeds.length)] : \"low\";\n\n// Random humidity values\nconst environmentHumidity = 30 + Math.floor(Math.random() * 50); // current room humidity\nconst humidityRemoved = power === \"ON\" ? parseFloat((Math.random() * 5).toFixed(2)) : 0; // %RH removed\n\n// Tank level simulation\nconst tankLevel = Math.min(100, Math.max(0, (flow.get('dehumidifier.tankLevel') || 0) + (humidityRemoved / 2)));\nflow.set('dehumidifier.tankLevel', tankLevel);\n\n// Energy tracking\nlet energy = flow.get('energy.dehumidifier') || 0;\nconst powerWatts = 200; // average dehumidifier power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (power === \"ON\") {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.dehumidifier', energy);\n\n// Telemetry payload\nmsg.payload = {\n    device: \"dehumidifier\",\n    power: power,\n    mode: mode,\n    fanSpeed: fanSpeed,\n    tankLevel: parseFloat(tankLevel.toFixed(1)),\n    humidityRemoved: humidityRemoved,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    environmentHumidity: environmentHumidity\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3780,
        "y": 6320,
        "wires": [
            [
                "b91580c4611b56f9"
            ]
        ]
    },
    {
        "id": "b91580c4611b56f9",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "c5220e32833dbbf1",
        "name": "Dehumidifier AsyncAPI",
        "x": 4030,
        "y": 6320,
        "wires": [
            [
                "09cdfd7705549c26",
                "7f9c5448391e2292",
                "9e29310b33fbe444"
            ]
        ]
    },
    {
        "id": "09cdfd7705549c26",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "c5220e32833dbbf1",
        "name": "Dehumidifier Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4340,
        "y": 6300,
        "wires": []
    },
    {
        "id": "c996f1ef27b8efda",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "86fd8e011843ed5e",
        "name": "Cooker Telemetry",
        "func": "// --- Cooker/Oven Telemetry Simulator ---\n\n// Simulation scale factor\nconst scale = global.get(\"simulationScale\") || 1;\n\n// Random running state\nconst running = Math.random() > 0.5;\n\n// Cooking modes\nconst modes = ['idle','bake','grill','roast','steam'];\nconst mode = running ? modes[Math.floor(Math.random() * (modes.length - 1)) + 1] : 'idle';\n\n// Timer and temperature\nconst timer = running ? Math.floor(Math.random() * 60) : 0;          // minutes remaining\nconst currentTemp = running ? 100 + Math.floor(Math.random() * 150) : 25; // current oven temp\nconst setTemp = running ? currentTemp + Math.floor(Math.random() * 20) : 0; // target temp\n\n// Energy tracking\nlet energy = flow.get('energy.cooker') || 0;\nconst powerWatts = 1500; // average cooker power\nconst tickSeconds = 60 * scale;\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (running) {\n    energy += wattToKwh(powerWatts, tickSeconds);\n}\n\nflow.set('energy.cooker', energy);\n\n// Telemetry payload matching your schema\nmsg.payload = {\n    device: \"cooker\",\n    power: running ? \"ON\" : \"OFF\",\n    mode: mode,\n    setTemp: setTemp,\n    currentTemp: currentTemp,\n    timer: timer,\n    energyUsed: parseFloat(energy.toFixed(3))\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3790,
        "y": 6480,
        "wires": [
            [
                "a21d83268b8ddea1"
            ]
        ]
    },
    {
        "id": "a21d83268b8ddea1",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "86fd8e011843ed5e",
        "name": "Cooker AsyncAPI",
        "x": 4040,
        "y": 6480,
        "wires": [
            [
                "806df53aa1a6e276",
                "7f9c5448391e2292",
                "9e29310b33fbe444"
            ]
        ]
    },
    {
        "id": "806df53aa1a6e276",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "86fd8e011843ed5e",
        "name": "Cooker Debug",
        "active": false,
        "tosidebar": true,
        "complete": "payload",
        "x": 4300,
        "y": 6480,
        "wires": []
    },
    {
        "id": "87df2992b512e6bf",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "ec0d24c794e69dae",
        "name": "Thermostat Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 4410,
        "y": 5280,
        "wires": []
    },
    {
        "id": "5bdb778de4b4af86",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "ec0d24c794e69dae",
        "name": "Thermostat Telemetry",
        "func": "// Read environment values from input\nlet envTemp = parseFloat(msg.payload.temperature); // environment temperature\nlet envHumidity = msg.payload.humidity;\n\n// Desired temperature\nconst desired = Math.floor(20 + Math.random() * 11);\n\n// Start at environment temperature\nlet current = envTemp;\n\n// Random drift within 0.5C\ncurrent += (Math.random() * 1 - 0.5);\n\n// Determine HVAC mode\nlet mode = 'idle';\nif (current < desired - 2) {\n    mode = 'heat';\n    current += 0.5; // heating effect\n} else if (current > desired + 2) {\n    mode = 'cool';\n    current -= 0.5; // cooling effect\n}\n\n// Energy tracking\nlet energy = flow.get('energy.thermostat') || 0;\nconst heaterPower = 2000; // W\nconst acPower = 1200;     // W\n\n// Get simulation scale (default = 1)\nconst scale = global.get(\"simulationScale\") || 1;\nconst tickDuration = 1 * scale;  // seconds per tick\n\nfunction wattToKwh(powerWatts, seconds) {\n    return (powerWatts / 1000) * (seconds / 3600);\n}\n\nif (mode === 'heat') {\n    energy += wattToKwh(heaterPower, tickDuration);\n} else if (mode === 'cool') {\n    energy += wattToKwh(acPower, tickDuration);\n}\n\n// Save state\nflow.set('energy.thermostat', energy);\nflow.set('current_temp', current);\n\n// Output telemetry\nmsg.payload = {\n    device: \"thermostat\",\n    temperature: envTemp,\n    humidity: envHumidity,\n    mode: mode,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: \"C\"\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3780,
        "y": 5300,
        "wires": [
            [
                "a96c3ad9d927ff1f"
            ]
        ]
    },
    {
        "id": "a96c3ad9d927ff1f",
        "type": "async-api-red",
        "z": "2a4e2856b37c3f19",
        "g": "ec0d24c794e69dae",
        "name": " Thermostat AsyncAPI",
        "x": 4120,
        "y": 5300,
        "wires": [
            [
                "87df2992b512e6bf",
                "7f9c5448391e2292",
                "9e29310b33fbe444"
            ]
        ]
    },
    {
        "id": "d8a069cca5d5dc85",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "name": "SMARTHOME",
        "info": "",
        "x": 3720,
        "y": 5140,
        "wires": []
    },
    {
        "id": "e7cbb140fa8a4f60",
        "type": "ui_template",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "group": "8c896da163d208f1",
        "name": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n    html,\n    body,\n    .nr-dashboard-template {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Remove huge stretching */\n    md-card {\n        min-height: auto;\n        min-width: auto;\n    }\n\n    /* Flexbox container for all cards */\n    .device-card-container {\n        display: flex;\n        flex-wrap: wrap;\n        /* wrap into rows */\n        gap: 15px;\n        /* space between cards */\n        padding: 10px;\n        justify-content: flex-start;\n        /* align left */\n        align-items: stretch;\n        /* equal height per row */\n    }\n\n    .device-card {\n        background-color: #f4f4f4;\n        border-radius: 10px;\n        padding: 15px;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        font-family: Arial, sans-serif;\n        box-sizing: border-box;\n        width: 20em;\n        /* fixed width per card */\n        min-height: 160px;\n        /* consistent height */\n        display: flex;\n        flex-direction: column;\n        justify-content: flex-start;\n    }\n\n    .device-card h3 {\n        margin-top: 0;\n        font-size: 1.1em;\n        margin-bottom: 10px;\n    }\n\n    .device-card p {\n        margin: 4px 0;\n        font-size: 0.9em;\n    }\n</style>\n\n<div class=\"device-card-container\">\n    <div class=\"device-card\" ng-repeat=\"(key, device) in msg.payload\"\n        ng-if=\"device.device && device.device !== 'Undefined'\">\n        <h3>{{ device.device }}</h3>\n        <p ng-if=\"device.temperature !== undefined\">Temp: {{ device.temperature }} C</p>\n        <p ng-if=\"device.humidity !== undefined\">Humidity: {{ device.humidity }}%</p>\n        <p ng-if=\"device.mode !== undefined\">Mode: {{ device.mode }}</p>\n        <p ng-if=\"device.fanSpeed !== undefined\">Fan: {{ device.fanSpeed }}</p>\n        <p ng-if=\"device.energyUsed !== undefined\">Energy: {{ device.energyUsed }}</p>\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 5060,
        "y": 5660,
        "wires": [
            []
        ]
    },
    {
        "id": "9e29310b33fbe444",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "name": "Merge all device payloads",
        "func": "// Initialize merged payload in flow context if it doesn't exist\nlet merged = flow.get('mergedPayload') || {};\n\n// Use the device name from the incoming payload as the key\nmerged[msg.payload.device] = msg.payload;\n\n// Save updated merged payload back to flow context\nflow.set('mergedPayload', merged);\n\n// Optionally send the merged object as msg.payload to the UI template\nmsg.payload = merged;\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4910,
        "y": 5580,
        "wires": [
            [
                "e7cbb140fa8a4f60",
                "e936466af33466bc"
            ]
        ]
    },
    {
        "id": "e936466af33466bc",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "0b55e8532164a7d0",
        "name": "Merged payloads",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 5090,
        "y": 5480,
        "wires": []
    },
    {
        "id": "b8d520884debc901",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "90d155064c160075",
        "name": "Environment Generator",
        "func": "// --- Simulation Scale ---\n// Only set once (if not already set)\nif (!global.get(\"simulationScale\")) {\n    global.set(\"simulationScale\", 60);\n    // 1s = 1 minute\n    // change to 3600 for 1s = 1 hour\n}\n\n// --- Environment State ---\nconst desired = flow.get('desired_temp') || 22;\nlet current = flow.get('current_temp') || (desired + (Math.random() * 4 - 2));\n\n// Random drift\ncurrent += (Math.random() * 1 - 0.5);\n\n// Calculate humidity\nlet humidity = 40 + Math.floor(Math.random() * 20);\n\n// Simulate room light intensity (0 = dark, 100 = very bright)\nlet lightIntensity = Math.floor(Math.random() * 101);\n\n// Save globally for all devices\nflow.set('env.temperature', current);\nflow.set('env.humidity', humidity);\nflow.set('env.lightIntensity', lightIntensity);\nflow.set('current_temp', current);\n\n// Output payload\nmsg.payload = {\n    environment: true,\n    temperature: current.toFixed(1),\n    humidity: humidity,\n    lightIntensity: lightIntensity,\n    unit: \"C\",\n    simulationScale: global.get(\"simulationScale\") // include scale for visibility\n};\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 3340,
        "wires": [
            [
                "9312e5d3654db867",
                "3e675a13b663b200",
                "4f02e55eef678fb0",
                "b5978c10396e9d4b",
                "33f212696921261a",
                "9f3c7911a1fc7bca",
                "526f83f5d6fb5cc2",
                "b2f07029b50cd13e",
                "48d27a913ca24a1f",
                "53eb72be1698e319",
                "00a3e31d2ab3a53f",
                "a7df41d26f49ee99",
                "07681baecbc334e9",
                "3e577da3fb9e2779",
                "85e9cf0b3f60b71d",
                "a8bc925b719ae023",
                "ee23f591e84f6803",
                "e86cb7437ca2e8bb",
                "cfe5e04ab15f4758",
                "692c360c42b0fd11",
                "7a1b7c5d6c172e16",
                "e440d9774ed58920",
                "f096aaaa790496cf",
                "aedf1365b9d5bcbb",
                "6e1e2973d32ab79f",
                "25c6fb4e3336640a",
                "5f0554b2b5db9155",
                "b719b1746d2ebc88",
                "4d0a0e13f3aa0305",
                "8cd46bbb7896c85b"
            ]
        ]
    },
    {
        "id": "9312e5d3654db867",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "90d155064c160075",
        "name": "Route Env Data",
        "func": "// Split Environment Generator data\nconst out = [];\n\nif (msg.payload.environment) {\n    out.push({ topic: \"temperature\", payload: Number(msg.payload.temperature) });\n    out.push({ topic: \"humidity\", payload: Number(msg.payload.humidity) });\n    out.push({ topic: \"light\", payload: Number(msg.payload.lightIntensity) });\n}\n\nreturn [out];",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 3520,
        "wires": [
            [
                "f31afbe78a2d9456",
                "ec0996a7a1172bf5",
                "777c9b53a48c2aa0",
                "c59f503f1475e555"
            ]
        ]
    },
    {
        "id": "f31afbe78a2d9456",
        "type": "ui_chart",
        "z": "2a4e2856b37c3f19",
        "g": "90d155064c160075",
        "name": "Temperature Chart",
        "group": "8c896da163d208f1",
        "order": 1,
        "width": "6",
        "height": 4,
        "label": "Temperature (C)",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "Waiting for data...",
        "dot": false,
        "ymin": "15",
        "ymax": "35",
        "removeOlder": "1",
        "removeOlderPoints": "100",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#ff7f0e",
            "#1f77b4",
            "#2ca02c",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000",
            "#000000"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 730,
        "y": 3560,
        "wires": [
            []
        ]
    },
    {
        "id": "ec0996a7a1172bf5",
        "type": "ui_gauge",
        "z": "2a4e2856b37c3f19",
        "g": "90d155064c160075",
        "name": "Temperature Gauge",
        "group": "env_group",
        "order": 2,
        "width": 6,
        "height": 4,
        "gtype": "gage",
        "title": "Temperature",
        "label": "C",
        "format": "{{value}}",
        "min": "0",
        "max": "40",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 700,
        "y": 3640,
        "wires": []
    },
    {
        "id": "777c9b53a48c2aa0",
        "type": "ui_gauge",
        "z": "2a4e2856b37c3f19",
        "g": "90d155064c160075",
        "name": "Humidity Gauge",
        "group": "env_group",
        "order": 3,
        "width": 6,
        "height": 4,
        "gtype": "gage",
        "title": "Humidity",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#00b5e9",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 600,
        "y": 3700,
        "wires": []
    },
    {
        "id": "c59f503f1475e555",
        "type": "ui_slider",
        "z": "2a4e2856b37c3f19",
        "g": "90d155064c160075",
        "name": "Light Intensity",
        "label": "Light Intensity",
        "group": "env_group",
        "order": 4,
        "width": 12,
        "height": 1,
        "passthru": true,
        "outs": "all",
        "topic": "",
        "min": "0",
        "max": "100",
        "step": 1,
        "x": 520,
        "y": 3820,
        "wires": [
            []
        ]
    },
    {
        "id": "cb41cc528a414b41",
        "type": "inject",
        "z": "2a4e2856b37c3f19",
        "g": "90d155064c160075",
        "name": "Sim Clock Trigger",
        "props": [],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": "0.1",
        "topic": "",
        "x": 290,
        "y": 3300,
        "wires": [
            [
                "b8d520884debc901"
            ]
        ]
    },
    {
        "id": "f16731579128fd4d",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "90d155064c160075",
        "name": "Enviroment params",
        "info": "",
        "x": 270,
        "y": 3200,
        "wires": []
    },
    {
        "id": "e7df93230a432dd1",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "name": "function 2",
        "func": "// Retrieve stored values from context (or init as empty object)\nlet energies = context.get(\"energies\") || {};\n\n// Save the latest totalEnergy value keyed by topic\nenergies[msg.topic] = msg.totalEnergy;\n\n// Store updated values back in context\ncontext.set(\"energies\", energies);\n\n// Calculate the sum of all inputs\nlet total = Object.values(energies).reduce((a, b) => a + b, 0);\n\n// Also send totalEnergy for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2960,
        "y": 3380,
        "wires": [
            [
                "05cfc4cd6ea0ec69"
            ]
        ]
    },
    {
        "id": "8ed8748c874031f9",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "name": "function 3",
        "func": "// Retrieve stored values from context (or init as empty object)\nlet energies = context.get(\"energies\") || {};\n\n// Save the latest totalEnergy value keyed by topic\nenergies[msg.topic] = msg.totalEnergy;\n\n// Store updated values back in context\ncontext.set(\"energies\", energies);\n\n// Calculate the sum of all inputs\nlet total = Object.values(energies).reduce((a, b) => a + b, 0);\n\n\n// Also send totalEnergy for debug node\nmsg.totalEnergy = `${total} KWh`;\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5920,
        "y": 3520,
        "wires": [
            [
                "05cfc4cd6ea0ec69"
            ]
        ]
    },
    {
        "id": "05cfc4cd6ea0ec69",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "g": "399c3e8574bf37c6",
        "name": "function 4",
        "func": "// Retrieve stored values from context (or init empty object)\nlet energies = context.get(\"energies\") || {};\n\n// Store the latest totalEnergy keyed by topic (unique per input Function node)\nenergies[msg.topic] = parseFloat(msg.totalEnergy); // convert string to number if needed\n\n// Save back to context\ncontext.set(\"energies\", energies);\n\n// Calculate the sum of all totalEnergy values\nlet total = Object.values(energies).reduce((a, b) => a + b, 0);\n\n// Output for chart or debug\nmsg.payload = total;                   // numeric total for chart nodes\nmsg.totalEnergySum = `${total} KWh`;  // human-readable for debug node\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 6320,
        "y": 3360,
        "wires": [
            [
                "7af3daa6a12c4536"
            ]
        ]
    },
    {
        "id": "7af3daa6a12c4536",
        "type": "debug",
        "z": "2a4e2856b37c3f19",
        "g": "399c3e8574bf37c6",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 6580,
        "y": 3360,
        "wires": []
    },
    {
        "id": "8cd46bbb7896c85b",
        "type": "function",
        "z": "2a4e2856b37c3f19",
        "name": "function 5",
        "func": "\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3000,
        "y": 3320,
        "wires": [
            [
                "89bf4834bc84ee48",
                "f9d3021c446134cd",
                "1d8f8a53c9eb4273",
                "6404e6e05c8854b1",
                "a9071186935d7c08",
                "ba1aea899432865a",
                "b03c5837abac29a0",
                "65ecb36353a61463",
                "b696d52e5412d4be",
                "e4e918777412d058",
                "42e368e15af97dcd",
                "b90a3bf6c51b0cc6",
                "9764435b19f67e4c",
                "6c6335ecc06dfc1b",
                "51b8b10909086b0a",
                "fcd0f3b7b57b5bca",
                "be1bb0650a31a1aa",
                "89840683aba16d92",
                "c3c9ac05b9510a42",
                "85dd61feea2f242c",
                "cae3f3494f39d28f",
                "5bdb778de4b4af86",
                "d767c2a73547db9d",
                "a994865b84aa0451",
                "c72018496d42cd30",
                "9c46ddbd6587d60f",
                "0eb307de2a08f572",
                "c996f1ef27b8efda"
            ]
        ]
    },
    {
        "id": "d2ec12da30974627",
        "type": "comment",
        "z": "2a4e2856b37c3f19",
        "g": "399c3e8574bf37c6",
        "name": "Total enegy ",
        "info": "",
        "x": 6330,
        "y": 3280,
        "wires": []
    },
    {
        "id": "0623d3f2732f194c",
        "type": "debug",
        "z": "438d596005491859",
        "g": "7f7a81c81fb18909",
        "name": "Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 360,
        "wires": []
    },
    {
        "id": "474ac194c8bbc512",
        "type": "openApi-red",
        "z": "438d596005491859",
        "g": "7f7a81c81fb18909",
        "name": "",
        "configUrlNode": "92fb21b02d9a57e6",
        "apiTag": "SmartPlug",
        "keepAuth": false,
        "operationData": {
            "id": "setSmartPlugState",
            "hasOperationId": true,
            "path": "/smartplug/webhook",
            "method": "post"
        },
        "outputStyle": "each response",
        "errorHandling": "throw exception",
        "internalErrors": {
            "text": "",
            "source": ""
        },
        "parameters": {
            "requestBody": {
                "name": "Request body",
                "required": true,
                "isActive": true,
                "activeFilter": "",
                "type": "editor:Request body",
                "parameters": {
                    "state": {
                        "name": "state",
                        "isActive": true,
                        "activeFilter": "",
                        "required": true,
                        "type": "msg",
                        "value": "payload.state"
                    }
                },
                "collapsed": false
            }
        },
        "requestContentType": "application/json",
        "responseContentType": "application/json",
        "outputs": 2,
        "responseOutputLabels": [
            {
                "code": "200",
                "text": "Smart Plug state successfully changed"
            },
            {
                "code": "400",
                "text": "Invalid state specified"
            }
        ],
        "responseAsPayload": false,
        "debugMode": false,
        "headers": [],
        "_version": "2.2.0",
        "x": 950,
        "y": 360,
        "wires": [
            [
                "0623d3f2732f194c"
            ],
            []
        ]
    },
    {
        "id": "1396224ee5de4b8d",
        "type": "http in",
        "z": "438d596005491859",
        "g": "3e5336b3c932e13c",
        "name": "[POST] Smartplug Webhook",
        "url": "/smartplug/webhook",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 700,
        "y": 540,
        "wires": [
            [
                "ac4c005192cf780a"
            ]
        ]
    },
    {
        "id": "ac4c005192cf780a",
        "type": "function",
        "z": "438d596005491859",
        "g": "3e5336b3c932e13c",
        "name": "Handle Webhook State",
        "func": "// Parse desired state\nlet newState = (msg.payload.state || '').toLowerCase();\n\nif (!['on', 'off'].includes(newState)) {\n    msg.statusCode = 400;\n    msg.payload = { error: 'Invalid state. Use \"on\" or \"off\".' };\n    return msg;\n}\n\n// Save new state\nglobal.set('smartplug.state', newState);\nflow.set('smartplug_state', newState);\n\n\nmsg.statusCode = 200;\nmsg.payload = {\n    message: `Smart plug turned ${newState}`,\n    state: newState,\n    timestamp: new Date().toISOString()\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 540,
        "wires": [
            [
                "9e0c9391f9b4250a"
            ]
        ]
    },
    {
        "id": "9e0c9391f9b4250a",
        "type": "http response",
        "z": "438d596005491859",
        "g": "3e5336b3c932e13c",
        "name": "Response (POST)",
        "statusCode": "",
        "headers": {
            "content-type": "application/json"
        },
        "x": 1200,
        "y": 540,
        "wires": []
    },
    {
        "id": "a0774d5b5c031c59",
        "type": "inject",
        "z": "438d596005491859",
        "g": "7f7a81c81fb18909",
        "name": "Trigger webhook",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"state\":\"on\"}",
        "payloadType": "json",
        "x": 720,
        "y": 360,
        "wires": [
            [
                "474ac194c8bbc512"
            ]
        ]
    },
    {
        "id": "43333b017ce7e0ff",
        "type": "comment",
        "z": "438d596005491859",
        "g": "3e5336b3c932e13c",
        "name": "Init webhook endpoint",
        "info": "",
        "x": 680,
        "y": 480,
        "wires": []
    },
    {
        "id": "dc0d300ba5c12af3",
        "type": "comment",
        "z": "438d596005491859",
        "g": "7f7a81c81fb18909",
        "name": "Smartplug ",
        "info": "",
        "x": 680,
        "y": 300,
        "wires": []
    },
    {
        "id": "f1a2d740b68acbd5",
        "type": "http in",
        "z": "a1c0e100f11a4f9b",
        "name": "[GET] Smartplug Status",
        "url": "/smartplug",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 160,
        "wires": [
            [
                "7d2e0ec5b51d7f25"
            ]
        ]
    },
    {
        "id": "7d2e0ec5b51d7f25",
        "type": "function",
        "z": "a1c0e100f11a4f9b",
        "name": "Get Smartplug State",
        "func": "// Get current state and energy from context\nlet state = flow.get('smartplug_state') || 'off';\nlet energy = global.get('smartplug.energy') || 0;\n\nmsg.payload = {\n    device: 'smartplug',\n    state: state,\n    energyUsed: parseFloat(energy.toFixed(3)),\n    unit: 'kWh',\n    timestamp: new Date().toISOString()\n};\nmsg.statusCode = 200;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 160,
        "wires": [
            [
                "3a3c3e93e38c5a7f"
            ]
        ]
    },
    {
        "id": "3a3c3e93e38c5a7f",
        "type": "http response",
        "z": "a1c0e100f11a4f9b",
        "name": "Response (GET)",
        "statusCode": "",
        "headers": {
            "content-type": "application/json"
        },
        "x": 760,
        "y": 160,
        "wires": []
    },
    {
        "id": "b8d0e89f6baceb2c",
        "type": "http in",
        "z": "a1c0e100f11a4f9b",
        "name": "[POST] Smartplug Webhook",
        "url": "/smartplug/webhook",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 300,
        "wires": [
            [
                "be8e188d1b45f6d8"
            ]
        ]
    },
    {
        "id": "be8e188d1b45f6d8",
        "type": "function",
        "z": "a1c0e100f11a4f9b",
        "name": "Handle Webhook State",
        "func": "// Parse desired state\nlet newState = (msg.payload.state || '').toLowerCase();\n\nif (!['on', 'off'].includes(newState)) {\n    msg.statusCode = 400;\n    msg.payload = { error: 'Invalid state. Use \"on\" or \"off\".' };\n    return msg;\n}\n\n// Save new state\nglobal.set('smartplug.state', newState);\nflow.set('smartplug_state', newState);\n\n// Simulate energy usage accumulation\nlet energy = global.get('smartplug.energy') || 0;\n\nglobal.set('smartplug.energy', energy);\n\nmsg.statusCode = 200;\nmsg.payload = {\n    message: `Smart plug turned ${newState}`,\n    state: newState,\n    timestamp: new Date().toISOString()\n};\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 300,
        "wires": [
            [
                "de6eb1739f1ab3c9"
            ]
        ]
    },
    {
        "id": "de6eb1739f1ab3c9",
        "type": "http response",
        "z": "a1c0e100f11a4f9b",
        "name": "Response (POST)",
        "statusCode": "",
        "headers": {
            "content-type": "application/json"
        },
        "x": 760,
        "y": 300,
        "wires": []
    }
]