asyncapi: 3.0.0
info:
  title: SmartHome Automation API
  version: '1.2.0'
  description: >
    AsyncAPI 3.0.0 spec for smart home automation using Node-RED and async-api-red.
    All device telemetry messages now include `energyUsed` for consistent energy tracking.

defaultContentType: application/json

servers:
  mqttBroker:
    host: 172.17.0.1:1883
    protocol: mqtt
    description: Local MQTT broker

channels:

  thermostatState:
    address: home/thermostat/state
    messages:
      thermostatStateMessage:
        $ref: '#/components/messages/ThermostatState'

  acState:
    address: home/ac/state
    messages:
      acStateMessage:
        $ref: '#/components/messages/ACState'

  lightsState:
    address: home/lights/state
    messages:
      lightStateMessage:
        $ref: '#/components/messages/LightState'

  fridgeState:
    address: home/fridge/state
    messages:
      fridgeStateMessage:
        $ref: '#/components/messages/FridgeState'


  launderState:
    address: home/launder/state
    messages:
      launderStateMessage:
        $ref: '#/components/messages/LaunderState'


  dehumidifierState:
    address: home/dehumidifier/state
    messages:
      dehumidifierStateMessage:
        $ref: '#/components/messages/DehumidifierState'


  cookerState:
    address: home/cooker/state
    messages:
      cookerStateMessage:
        $ref: '#/components/messages/CookerState'

operations:

  thermostatTelemetry:
    action: send
    channel:
      $ref: '#/channels/thermostatState'
    messages:
      - $ref: '#/channels/thermostatState/messages/thermostatStateMessage'


  acTelemetry:
    action: send
    channel:
      $ref: '#/channels/acState'
    messages:
      - $ref: '#/channels/acState/messages/acStateMessage'

  controlLights:
    action: send
    channel:
      $ref: '#/channels/lightsState'
    messages:
      - $ref: '#/channels/lightsState/messages/lightStateMessage'

  fridgeTelemetry:
    action: send
    channel:
      $ref: '#/channels/fridgeState'
    messages:
      - $ref: '#/channels/fridgeState/messages/fridgeStateMessage'


  launderTelemetry:
    action: send
    channel:
      $ref: '#/channels/launderState'
    messages:
      - $ref: '#/channels/launderState/messages/launderStateMessage'


  dehumidifierTelemetry:
    action: send
    channel:
      $ref: '#/channels/dehumidifierState'
    messages:
      - $ref: '#/channels/dehumidifierState/messages/dehumidifierStateMessage'


  cookerTelemetry:
    action: send
    channel:
      $ref: '#/channels/cookerState'
    messages:
      - $ref: '#/channels/cookerState/messages/cookerStateMessage'

components:
  messages:
    ThermostatState:
      name: ThermostatState
      summary: Current thermostat status
      contentType: application/json
      payload:
        type: object
        properties:
          temperature:
            type: number
          humidity:
            type: number
          mode:
            type: string
            enum: [ heat, cool, idle ]
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
          unit:
            type: string
            enum: [ C, F ]

    ACState:
      name: ACState
      summary: Current AC status and telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          mode:
            type: string
            description: Current operating mode of the AC
            enum: [ cooling, heating, fan, idle, off ]
          temperature:
            type: number
            description: Current measured room temperature
            example: 23.5
          setpoint:
            type: number
            description: Target temperature set by user or system
            example: 24
          humidity:
            type: number
            description: Current room humidity in percent
            example: 45
          unit:
            type: string
            description: Unit for temperature values
            example: C
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
            example: 12.34

    LightState:
      name: LightState
      summary: Light telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          state:
            type: string
            description: Current power state of the light
            enum: [ ON, OFF ]
          brightness:
            type: integer
            minimum: 0
            maximum: 100
            description: Brightness level as percentage
          color:
            type: string
            description: Hex or RGB color value (e.g., "#FFAA00" or "rgb(255,170,0)")
            example: "#FFFFFF"
          colorTemperature:
            type: integer
            description: Color temperature in Kelvin (e.g., 2700 warm white – 6500 cool white)
            minimum: 1500
            maximum: 9000
            example: 4000
          mode:
            type: string
            description: Current light mode
            enum: [ normal, reading, nightlight, ambient, effect ]
          effect:
            type: string
            description: Active effect (if any, e.g., "rainbow", "pulse", "candle")
            example: "candle"
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
            example: 5.23
          voltage:
            type: number
            description: Operating voltage in Volts
            example: 230



    FridgeState:
      name: FridgeState
      summary: Fridge telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          power:
            type: string
            description: Power state of the fridge
            enum: [ ON, OFF ]
          mode:
            type: string
            description: Operating mode
            enum: [ eco, normal, turbo, vacation ]
          fridgeTemp:
            type: number
            description: Target temperature for fridge compartment in °C
            example: 4
          freezerTemp:
            type: number
            description: Target temperature for freezer compartment in °C
            example: -18
          doorStatus:
            type: string
            description: Whether fridge or freezer door is open
            enum: [ closed, fridge_open, freezer_open, both_open ]
          humidityControl:
            type: string
            description: Humidity control for vegetable/fruit drawers
            enum: [ low, medium, high ]
          alarms:
            type: array
            description: Active alarms or alerts
            items:
              type: string
              example: [ "door_open", "high_temp", "filter_expired" ]

    LaunderState:
      name: LaunderState
      summary: Laundry machine telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          power:
            type: string
            description: Power state of the machine
            enum: [ ON, OFF, STANDBY ]
          mode:
            type: string
            description: Selected washing program
            enum: [ eco, normal, quick, heavy, delicate, wool, rinse, spin, dry ]
          cyclePhase:
            type: string
            description: Current cycle phase
            enum: [ filling, washing, rinsing, spinning, drying, completed, idle ]
          waterTemp:
            type: number
            description: Current water temperature in °C
            example: 40
          spinSpeed:
            type: integer
            description: Spin speed in RPM
            example: 1200
          remainingTime:
            type: integer
            description: Estimated remaining time in minutes
            example: 45
          loadWeight:
            type: number
            description: Estimated laundry load weight in kg
            example: 6.5
          waterUsed:
            type: number
            description: Cumulative water used in liters
            example: 35.2
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
            example: 1.23
          doorStatus:
            type: string
            description: Current door state
            enum: [ open, closed, locked ]


    DehumidifierState:
      name: DehumidifierState
      summary: Smart dehumidifier telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          device:
            type: string
            example: "dehumidifier"
          power:
            type: string
            enum: [ ON, OFF ]
          mode:
            type: string
            enum: [ auto, manual ]
          fanSpeed:
            type: string
            enum: [ low, medium, high ]
          tankLevel:
            type: number
            description: Water tank fill level in %
            example: 45
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
            example: 0.12
          humidity:
            type: number
            description: Current room humidity %
            example: 55



    CookerState:
      name: CookerState
      summary: Smart cooker/oven telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          device:
            type: string
            example: "cooker"
          power:
            type: string
            enum: [ ON, OFF ]
          mode:
            type: string
            enum: [ idle, bake, grill, roast, steam ]
          setTemp:
            type: number
            description: Target temperature in Celsius
            example: 200
          currentTemp:
            type: number
            description: Current oven temperature
            example: 180
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
            example: 0.45

