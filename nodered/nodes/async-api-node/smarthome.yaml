asyncapi: 3.0.0
info:
  title: SmartHome Automation API
  version: '1.2.0'
  description: >
    AsyncAPI 3.0.0 spec for smart home automation using Node-RED and async-api-red.
    All device telemetry messages now include `energyUsed` for consistent energy tracking.

defaultContentType: application/json

servers:
  mqttBroker:
    host: 172.17.0.1:1883
    protocol: mqtt
    description: Local MQTT broker

channels:

  thermostatState:
    address: home/thermostat/state
    messages:
      thermostatStateMessage:
        $ref: '#/components/messages/ThermostatState'

  acState:
    address: home/ac/state
    messages:
      acStateMessage:
        $ref: '#/components/messages/ACState'

  lightsState:
    address: home/lights/state
    messages:
      lightStateMessage:
        $ref: '#/components/messages/LightState'

  doorLock:
    address: home/door/lock
    messages:
      doorLockMessage:
        $ref: '#/components/messages/DoorLock'

  doorState:
    address: home/door/state
    messages:
      doorStateMessage:
        $ref: '#/components/messages/DoorState'

  coffeeStart:
    address: home/coffee/start
    messages:
      coffeeStartMessage:
        $ref: '#/components/messages/CoffeeStart'

  coffeeState:
    address: home/coffee/state
    messages:
      coffeeStateMessage:
        $ref: '#/components/messages/CoffeeState'

  fridgeControl:
    address: home/fridge/control
    messages:
      fridgeControlMessage:
        $ref: '#/components/messages/FridgeControl'

  fridgeState:
    address: home/fridge/state
    messages:
      fridgeStateMessage:
        $ref: '#/components/messages/FridgeState'

  launderControl:
    address: home/launder/control
    messages:
      launderControlMessage:
        $ref: '#/components/messages/LaunderControl'

  launderState:
    address: home/launder/state
    messages:
      launderStateMessage:
        $ref: '#/components/messages/LaunderState'

  dehumidifierControl:
    address: home/dehumidifier/control
    messages:
      dehumidifierControlMessage:
        $ref: '#/components/messages/DehumidifierControl'

  dehumidifierState:
    address: home/dehumidifier/state
    messages:
      dehumidifierStateMessage:
        $ref: '#/components/messages/DehumidifierState'

  cookerControl:
    address: home/cooker/control
    messages:
      cookerControlMessage:
        $ref: '#/components/messages/CookerControl'

  cookerState:
    address: home/cooker/state
    messages:
      cookerStateMessage:
        $ref: '#/components/messages/CookerState'

operations:

  thermostatTelemetry:
    action: send
    channel:
      $ref: '#/channels/thermostatState'
    messages:
      - $ref: '#/channels/thermostatState/messages/thermostatStateMessage'


  acTelemetry:
    action: send
    channel:
      $ref: '#/channels/acState'
    messages:
      - $ref: '#/channels/acState/messages/acStateMessage'

  controlLights:
    action: send
    channel:
      $ref: '#/channels/lightsState'
    messages:
      - $ref: '#/channels/lightsState/messages/lightStateMessage'

  controlDoorLock:
    action: send
    channel:
      $ref: '#/channels/doorLock'
    messages:
      - $ref: '#/channels/doorLock/messages/doorLockMessage'

  doorTelemetry:
    action: receive
    channel:
      $ref: '#/channels/doorState'
    messages:
      - $ref: '#/channels/doorState/messages/doorStateMessage'

  startCoffeeMachine:
    action: send
    channel:
      $ref: '#/channels/coffeeStart'
    messages:
      - $ref: '#/channels/coffeeStart/messages/coffeeStartMessage'

  coffeeTelemetry:
    action: receive
    channel:
      $ref: '#/channels/coffeeState'
    messages:
      - $ref: '#/channels/coffeeState/messages/coffeeStateMessage'

  controlFridge:
    action: send
    channel:
      $ref: '#/channels/fridgeControl'
    messages:
      - $ref: '#/channels/fridgeControl/messages/fridgeControlMessage'

  fridgeTelemetry:
    action: receive
    channel:
      $ref: '#/channels/fridgeState'
    messages:
      - $ref: '#/channels/fridgeState/messages/fridgeStateMessage'

  controlLaunder:
    action: send
    channel:
      $ref: '#/channels/launderControl'
    messages:
      - $ref: '#/channels/launderControl/messages/launderControlMessage'

  launderTelemetry:
    action: receive
    channel:
      $ref: '#/channels/launderState'
    messages:
      - $ref: '#/channels/launderState/messages/launderStateMessage'

  controlDehumidifier:
    action: send
    channel:
      $ref: '#/channels/dehumidifierControl'
    messages:
      - $ref: '#/channels/dehumidifierControl/messages/dehumidifierControlMessage'

  dehumidifierTelemetry:
    action: receive
    channel:
      $ref: '#/channels/dehumidifierState'
    messages:
      - $ref: '#/channels/dehumidifierState/messages/dehumidifierStateMessage'

  controlCooker:
    action: send
    channel:
      $ref: '#/channels/cookerControl'
    messages:
      - $ref: '#/channels/cookerControl/messages/cookerControlMessage'

  cookerTelemetry:
    action: receive
    channel:
      $ref: '#/channels/cookerState'
    messages:
      - $ref: '#/channels/cookerState/messages/cookerStateMessage'

components:
  messages:
    ThermostatState:
      name: ThermostatState
      summary: Current thermostat status
      contentType: application/json
      payload:
        type: object
        properties:
          temperature:
            type: number
          humidity:
            type: integer
          mode:
            type: string
            enum: [ heat, cool, idle ]
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
          unit:
            type: string
            enum: [ C, F ]

    ACState:
      name: ACState
      summary: Current AC status and telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          mode:
            type: string
            description: Current operating mode of the AC
            enum: [ cooling, heating, fan, idle, off ]
          temperature:
            type: number
            description: Current measured room temperature
            example: 23.5
          setpoint:
            type: number
            description: Target temperature set by user or system
            example: 24
          humidity:
            type: number
            description: Current room humidity in percent
            example: 45
          fanSpeed:
            type: string
            description: Fan speed setting
            enum: [ low, medium, high ]
          unit:
            type: string
            description: Unit for temperature values
            example: C
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
            example: 12.34
          timestamp:
            type: string
            format: date-time
            description: ISO 8601 timestamp of the measurement
            example: "2025-09-10T12:30:00Z"

    LightState:
      name: LightState
      summary: Light telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          state:
            type: string
            description: Current power state of the light
            enum: [ ON, OFF ]
          brightness:
            type: integer
            minimum: 0
            maximum: 100
            description: Brightness level as percentage
          color:
            type: string
            description: Hex or RGB color value (e.g., "#FFAA00" or "rgb(255,170,0)")
            example: "#FFFFFF"
          colorTemperature:
            type: integer
            description: Color temperature in Kelvin (e.g., 2700 warm white â€“ 6500 cool white)
            minimum: 1500
            maximum: 9000
            example: 4000
          mode:
            type: string
            description: Current light mode
            enum: [ normal, reading, nightlight, ambient, effect ]
          effect:
            type: string
            description: Active effect (if any, e.g., "rainbow", "pulse", "candle")
            example: "candle"
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
            example: 5.23
          voltage:
            type: number
            description: Operating voltage in Volts
            example: 230
          power:
            type: number
            description: Current power draw in Watts
            example: 8.5

    DoorLock:
      name: DoorLock
      summary: Lock or unlock door
      contentType: application/json
      payload:
        type: object
        properties:
          locked:
            type: boolean

    DoorState:
      name: DoorState
      summary: Current door status
      contentType: application/json
      payload:
        type: object
        properties:
          locked:
            type: boolean
          battery:
            type: integer
            description: Battery percentage
          energyUsed:
            type: number
            description: Cumulative energy used in kWh

    CoffeeStart:
      name: CoffeeStart
      summary: Start brewing coffee
      contentType: application/json
      payload:
        type: object
        properties:
          strength:
            type: string
            enum: [ light, medium, strong ]
          size:
            type: string
            enum: [ small, medium, large ]

    CoffeeState:
      name: CoffeeState
      summary: Coffee machine status
      contentType: application/json
      payload:
        type: object
        properties:
          brewing:
            type: boolean
          remainingTime:
            type: integer
          lastBrew:
            type: string
            format: date-time
          energyUsed:
            type: number
            description: Cumulative energy used in kWh

    FridgeControl:
      name: FridgeControl
      summary: Control smart fridge
      contentType: application/json
      payload:
        type: object
        properties:
          power:
            type: string
            enum: [ ON, OFF ]
          mode:
            type: string
            enum: [ eco, normal, turbo ]
          fridgeTemp:
            type: integer
          freezerTemp:
            type: integer

    FridgeState:
      name: FridgeState
      summary: Fridge telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          power:
            type: string
            enum: [ ON, OFF ]
          mode:
            type: string
          fridgeTemp:
            type: integer
          freezerTemp:
            type: integer
          doorOpen:
            type: boolean
          energyUsed:
            type: number
            description: Cumulative energy used in kWh

    LaunderControl:
      name: LaunderControl
      summary: Control smart washing machine
      contentType: application/json
      payload:
        type: object
        properties:
          command:
            type: string
            enum: [ start, stop, pause ]
          mode:
            type: string
            enum: [ quick, delicate, heavy, normal ]
          duration:
            type: integer

    LaunderState:
      name: LaunderState
      summary: Laundry machine telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          running:
            type: boolean
          mode:
            type: string
          remainingTime:
            type: integer
          energyUsed:
            type: number
            description: Cumulative energy used in kWh

    DehumidifierControl:
      name: DehumidifierControl
      summary: Control smart dehumidifier
      contentType: application/json
      payload:
        type: object
        properties:
          power:
            type: string
            enum: [ ON, OFF ]
          targetHumidity:
            type: integer
            minimum: 30
            maximum: 80

    DehumidifierState:
      name: DehumidifierState
      summary: Dehumidifier telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          power:
            type: string
            enum: [ ON, OFF ]
          currentHumidity:
            type: integer
          targetHumidity:
            type: integer
          energyUsed:
            type: number
            description: Cumulative energy used in kWh

    CookerControl:
      name: CookerControl
      summary: Start cooking process
      contentType: application/json
      payload:
        type: object
        properties:
          command:
            type: string
            enum: [ start, stop ]
          mode:
            type: string
            enum: [ boil, steam, fry, bake ]
          duration:
            type: integer
          temperature:
            type: integer
            minimum: 50
            maximum: 300

    CookerState:
      name: CookerState
      summary: Cooker telemetry
      contentType: application/json
      payload:
        type: object
        properties:
          running:
            type: boolean
          mode:
            type: string
          remainingTime:
            type: integer
          temperature:
            type: integer
          energyUsed:
            type: number
            description: Cumulative energy used in kWh
