asyncapi: 3.0.0
info:
  title: SmartHome Automation API
  version: '1.0.0'
  description: AsyncAPI 3.0.0 spec for smart home automation using Node-RED and async-api-red.

defaultContentType: application/json

servers:
  mqttBroker:
    host: 172.17.0.1:1883
    protocol: mqtt
    description: Local MQTT broker

channels:
  homeThermostatSet:
    address: /home/thermostat/set
    messages:
      setThermostatMessage:
        $ref: '#/components/messages/ThermostatSet'

  homeACPower:
    address: /home/ac/power
    messages:
      setACStateMessage:
        $ref: '#/components/messages/ACPower'

  homeLightsState:
    address: /home/lights/state
    messages:
      controlLightsMessage:
        $ref: '#/components/messages/LightState'

  homeDoorLock:
    address: /home/door/lock
    messages:
      controlDoorLockMessage:
        $ref: '#/components/messages/DoorLock'

operations:
  setThermostat:
    action: send
    channel:
      $ref: '#/channels/homeThermostatSet'
    messages:
      - $ref: '#/channels/homeThermostatSet/messages/setThermostatMessage'

  setACState:
    action: send
    channel:
      $ref: '#/channels/homeACPower'
    messages:
      - $ref: '#/channels/homeACPower/messages/setACStateMessage'

  controlLights:
    action: send
    channel:
      $ref: '#/channels/homeLightsState'
    messages:
      - $ref: '#/channels/homeLightsState/messages/controlLightsMessage'

  controlDoorLock:
    action: send
    channel:
      $ref: '#/channels/homeDoorLock'
    messages:
      - $ref: '#/channels/homeDoorLock/messages/controlDoorLockMessage'

components:
  messages:
    ThermostatSet:
      name: ThermostatSet
      summary: Set thermostat temperature
      contentType: application/json
      payload:
        type: object
        properties:
          temperature:
            type: integer
            description: Desired temperature
          unit:
            type: string
            enum: [C, F]
            description: Temperature unit

    ACPower:
      name: ACPower
      summary: Turn AC ON/OFF
      contentType: application/json
      payload:
        type: object
        properties:
          state:
            type: string
            enum: [ON, OFF]
            description: AC power state

    LightState:
      name: LightState
      summary: Set light state
      contentType: application/json
      payload:
        type: object
        properties:
          state:
            type: string
            enum: [ON, OFF]
            description: Light state

    DoorLock:
      name: DoorLock
      summary: Lock or unlock door
      contentType: application/json
      payload:
        type: object
        properties:
          locked:
            type: boolean
            description: Lock status
