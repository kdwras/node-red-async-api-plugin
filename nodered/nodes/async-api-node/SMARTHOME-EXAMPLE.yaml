asyncapi: 3.0.0
info:
  title: SmartHome Automation API
  version: '1.0.0'
  description: AsyncAPI 3.0.0 spec for smart home automation using Node-RED and async-api-red.

defaultContentType: application/json

servers:
  mqttBroker:
    host: 172.17.0.1:1883
    protocol: mqtt
    description: Local MQTT broker

channels:
  thermostatSet:
    address: home/thermostatet
    messages:
      thermostatSetMessage:
        $ref: '#/components/messages/ThermostatSet'

  acPower:
    address: home/ac/power
    messages:
      acPowerMessage:
        $ref: '#/components/messages/ACPower'

  lightsState:
    address: home/lights/state
    messages:
      lightStateMessage:
        $ref: '#/components/messages/LightState'

  doorLock:
    address: home/door/lock
    messages:
      doorLockMessage:
        $ref: '#/components/messages/DoorLock'

  coffeeStart:
    address: home/coffee/start
    messages:
      coffeeStartMessage:
        $ref: '#/components/messages/CoffeeStart'
  fridgeControl:
    address: home/fridge/control
    messages:
      fridgeControlMessage:
        $ref: '#/components/messages/FridgeControl'

  launderControl:
    address: home/launder/control
    messages:
      launderControlMessage:
        $ref: '#/components/messages/LaunderControl'

  dehumidifierControl:
    address: home/dehumidifier/control
    messages:
      dehumidifierControlMessage:
        $ref: '#/components/messages/DehumidifierControl'

  cookerControl:
    address: home/cooker/control
    messages:
      cookerControlMessage:
        $ref: '#/components/messages/CookerControl'

operations:
  setThermostat:
    action: send
    channel:
      $ref: '#/channels/thermostatSet'
    messages:
      - $ref: '#/channels/thermostatSet/messages/thermostatSetMessage'

  setACState:
    action: send
    channel:
      $ref: '#/channels/acPower'
    messages:
      - $ref: '#/channels/acPower/messages/acPowerMessage'

  controlLights:
    action: send
    channel:
      $ref: '#/channels/lightsState'
    messages:
      - $ref: '#/channels/lightsState/messages/lightStateMessage'

  controlDoorLock:
    action: send
    channel:
      $ref: '#/channels/doorLock'
    messages:
      - $ref: '#/channels/doorLock/messages/doorLockMessage'

  startCoffeeMachine:
    action: send
    channel:
      $ref: '#/channels/coffeeStart'
    messages:
      - $ref: '#/channels/coffeeStart/messages/coffeeStartMessage'
  controlFridge:
    action: send
    channel:
      $ref: '#/channels/fridgeControl'
    messages:
      - $ref: '#/channels/fridgeControl/messages/fridgeControlMessage'

  controlLaunder:
    action: send
    channel:
      $ref: '#/channels/launderControl'
    messages:
      - $ref: '#/channels/launderControl/messages/launderControlMessage'

  controlDehumidifier:
    action: send
    channel:
      $ref: '#/channels/dehumidifierControl'
    messages:
      - $ref: '#/channels/dehumidifierControl/messages/dehumidifierControlMessage'

  controlCooker:
    action: send
    channel:
      $ref: '#/channels/cookerControl'
    messages:
      - $ref: '#/channels/cookerControl/messages/cookerControlMessage'

components:
  messages:
    ThermostatSet:
      name: ThermostatSet
      summary: Set thermostat temperature
      contentType: application/json
      payload:
        type: object
        properties:
          temperature:
            type: integer
            description: Desired temperature
          unit:
            type: string
            enum: [ C, F ]
            description: Temperature unit

    ACPower:
      name: ACPower
      summary: Turn AC ON/OFF
      contentType: application/json
      payload:
        type: object
        properties:
          state:
            type: string
            enum: [ ON, OFF ]
            description: AC power state

    LightState:
      name: LightState
      summary: Set light state
      contentType: application/json
      payload:
        type: object
        properties:
          state:
            type: string
            enum: [ ON, OFF ]
            description: Light state
          brightness:
            type: integer
            minimum: 0
            maximum: 100
            description: Brightness level

    DoorLock:
      name: DoorLock
      summary: Lock or unlock door
      contentType: application/json
      payload:
        type: object
        properties:
          locked:
            type: boolean
            description: Lock status

    CoffeeStart:
      name: CoffeeStart
      summary: Start brewing coffee
      contentType: application/json
      payload:
        type: object
        properties:
          strength:
            type: string
            enum: [ light, medium, strong ]
          size:
            type: string
            enum: [ small, medium, large ]
    FridgeControl:
      name: FridgeControl
      summary: Control smart fridge
      contentType: application/json
      payload:
        type: object
        properties:
          power:
            type: string
            enum: [ ON, OFF ]
            description: Power state
          mode:
            type: string
            enum: [ eco, normal, turbo ]
            description: Operating mode
          fridgeTemp:
            type: integer
            description: Fridge compartment temperature (°C)
          freezerTemp:
            type: integer
            description: Freezer compartment temperature (°C)

    LaunderControl:
      name: LaunderControl
      summary: Control smart washing machine
      contentType: application/json
      payload:
        type: object
        properties:
          command:
            type: string
            enum: [ start, stop, pause ]
            description: Control command
          mode:
            type: string
            enum: [ quick, delicate, heavy, normal ]
            description: Washing mode
          duration:
            type: integer
            description: Estimated duration in minutes

    DehumidifierControl:
      name: DehumidifierControl
      summary: Control smart dehumidifier
      contentType: application/json
      payload:
        type: object
        properties:
          power:
            type: string
            enum: [ ON, OFF ]
            description: Power state
          targetHumidity:
            type: integer
            minimum: 30
            maximum: 80
            description: Desired humidity percentage

    CookerControl:
      name: CookerControl
      summary: Start cooking process
      contentType: application/json
      payload:
        type: object
        properties:
          command:
            type: string
            enum: [ start, stop ]
            description: Start or stop cooking
          mode:
            type: string
            enum: [ boil, steam, fry, bake ]
            description: Cooking method
          duration:
            type: integer
            description: Cooking duration in minutes
          temperature:
            type: integer
            minimum: 50
            maximum: 300
            description: Cooking temperature in Celsius
